<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="仕事ではJava 11を扱うことが多いのですが、正直、自分の書いたコードを振り返ってみると、Java 9から新しく追加されたメソッドはあまり使っ"><title>9からの新メソッドめぐり</title><link rel=canonical href=https://retheviper.github.io/posts/java-new-methods-from-9-to-11/><link rel=stylesheet href=/scss/style.min.fbb68fe51fb77bdd639dccfe1c7b590d2330cf8b81da91f1585b35c3d07fbac8.css><meta property="og:title" content="9からの新メソッドめぐり"><meta property="og:description" content="仕事ではJava 11を扱うことが多いのですが、正直、自分の書いたコードを振り返ってみると、Java 9から新しく追加されたメソッドはあまり使っ"><meta property="og:url" content="https://retheviper.github.io/posts/java-new-methods-from-9-to-11/"><meta property="og:site_name" content="Korean-man in Tokyo"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="java"><meta property="article:tag" content="stream"><meta property="article:tag" content="collection"><meta property="article:tag" content="optional"><meta property="article:tag" content="string"><meta property="article:published_time" content="2020-12-30T00:00:00+00:00"><meta property="article:modified_time" content="2020-12-30T00:00:00+00:00"><meta property="og:image" content="https://retheviper.github.io/images/java.jpg"><meta name=twitter:title content="9からの新メソッドめぐり"><meta name=twitter:description content="仕事ではJava 11を扱うことが多いのですが、正直、自分の書いたコードを振り返ってみると、Java 9から新しく追加されたメソッドはあまり使っ"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://retheviper.github.io/images/java.jpg"><link rel=apple-touch-icon sizes=57x57 href=/favicon/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/favicon/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/favicon/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/favicon/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/favicon/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/favicon/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/favicon/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/favicon/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/favicon/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/favicon/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><link rel=manifest href=/favicon/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/favicon/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><script async src="https://www.googletagmanager.com/gtag/js?id=G-BYJBEJB6DX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BYJBEJB6DX",{anonymize_ip:!1})}</script></head><body class="article-page has-toc"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/java-new-methods-from-9-to-11/><img src=/../../images/java.jpg loading=lazy alt="Featured image of post 9からの新メソッドめぐり"></a></div><div class=article-details><header class=article-category><a href=/categories/java/ style=background-color:#2a9d8f;color:#fff>java</a></header><h2 class=article-title><a href=/posts/java-new-methods-from-9-to-11/>9からの新メソッドめぐり</a></h2><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Dec 30, 2020</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>13 minute read</time></div></footer></div></header><section class=article-content><p>仕事ではJava 11を扱うことが多いのですが、正直、自分の書いたコードを振り返ってみると、Java 9から新しく追加されたメソッドはあまり使ってないのが現実です。しかし、これら新しいメソッドたちは冗長さを隠してくれるシンタックスシュガーとして存在するだけでなく、性能や機能面でより優れているものもあるので、いますぐ使わないとしても目は通しておきたいものが多いなと思っています。</p><p>2021年は次のLTSバージョンとなる17の登場が予告されている時点なので、今更な感はありますが、そろそろ私もSEになってから2年になるので、今回は今年、自分が書いたコードへの反省を含め、Java 9〜11まで新しく追加されたメソッドたちの中から、良さそうな(よく使えそうな)ものを選別してみました。そして今回のポストは、そう選別したメソッドの簡単な紹介となります。</p><p>多くの場合、これらのメソッドを使える環境だとしたらJava 11を導入しているはずなのであまり意味はないのかもしれませんが、それぞれのメソッド名の右に、該当メソッドがどのバージョンから導入されたかを記入していますので参考にしてください。</p><h2 id=stream>Stream</h2><p>StreamこそJava 8のキモではないかと思います。そしてJava 9では、そのStreamの問題を色々と改善したり、より簡単に使えるようなメソッドを用意しています。なので、既存のforループにしか慣れてない人でも、簡単に入門できるようになったのではないかと思います。</p><h3 id=iterate-9>Iterate (9)</h3><p><code>iterate()</code>というメソッド名だけではすぐに意味がわからない場合もあると思いますが、このメソッドは伝統的なFor文と同じような構文でStreamでの処理を書くことができるようになります。つまり、「初期化・ループの継続条件・カウンタ変数の更新」を書くことで、Streaｍの要素数を決めることができるという意味です。例えば、以下のような書き方ができます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#6272a4>// 0~9までを出力
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>Stream<span style=color:#ff79c6>.</span><span style=color:#50fa7b>iterate</span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>0</span><span style=color:#ff79c6>,</span> i <span style=color:#ff79c6>-&gt;</span> i <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>10</span><span style=color:#ff79c6>,</span> i <span style=color:#ff79c6>-&gt;</span> i <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span><span style=color:#ff79c6>).</span><span style=color:#50fa7b>forEach</span><span style=color:#ff79c6>(</span>System<span style=color:#ff79c6>.</span><span style=color:#50fa7b>out</span><span style=color:#ff79c6>::</span>println<span style=color:#ff79c6>);</span>
</span></span></code></pre></div><p>これはつまり、以下のコードと同じ意味を持ちます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ff79c6>for</span> <span style=color:#ff79c6>(</span><span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span><span style=color:#ff79c6>;</span> i <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>10</span><span style=color:#ff79c6>;</span> i<span style=color:#ff79c6>++)</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>    System<span style=color:#ff79c6>.</span><span style=color:#50fa7b>out</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>println</span><span style=color:#ff79c6>(</span>i<span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>}</span>
</span></span></code></pre></div><p>ただ、<code>iterate()</code>で指定できる初期化の値が数字という制限はないので(<code>T</code>です)、以下のようなこともできます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#6272a4>// Aで三角形を出力
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>Stream<span style=color:#ff79c6>.</span><span style=color:#50fa7b>iterate</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;A&#34;</span><span style=color:#ff79c6>,</span> s <span style=color:#ff79c6>-&gt;</span> s<span style=color:#ff79c6>.</span><span style=color:#50fa7b>length</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>10</span><span style=color:#ff79c6>,</span> s <span style=color:#ff79c6>-&gt;</span> s <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;A&#34;</span><span style=color:#ff79c6>).</span><span style=color:#50fa7b>forEach</span><span style=color:#ff79c6>(</span>System<span style=color:#ff79c6>.</span><span style=color:#50fa7b>out</span><span style=color:#ff79c6>::</span>println<span style=color:#ff79c6>);</span>
</span></span></code></pre></div><p>また、ループの継続条件を指定しないこともできます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#6272a4>// Aで三角形を出力
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>Stream<span style=color:#ff79c6>.</span><span style=color:#50fa7b>iterate</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;A&#34;</span><span style=color:#ff79c6>,</span> s <span style=color:#ff79c6>-&gt;</span> s <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;A&#34;</span><span style=color:#ff79c6>).</span><span style=color:#50fa7b>forEach</span><span style=color:#ff79c6>(</span>System<span style=color:#ff79c6>.</span><span style=color:#50fa7b>out</span><span style=color:#ff79c6>::</span>println<span style=color:#ff79c6>);</span>
</span></span></code></pre></div><p>継続条件を指定しないと、無限ループになってしまうのでは？と思われそうですね。確かにそうですが、同じくJava 9でStreamの要素数の上限を指定できる新しいメソッドが追加されています。次に紹介するものがそれです。</p><h3 id=takewhile-9>takeWhile (9)</h3><p>以前、Streamの問題として「途中でやめられない」と書きましたが、Java 9から導入された<code>takeWhile()</code>メソッドを使うと、途中で処理を終了するようなことができるようになりました。既存にあった<code>limit()</code>の場合は、「指定された回数分」という限界がありましたが、こちらはPredicate型の条件を指定できるというところが違います。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#6272a4>// AAAAAAAAAまで出力する
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>Stream<span style=color:#ff79c6>.</span><span style=color:#50fa7b>iterate</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;A&#34;</span><span style=color:#ff79c6>,</span> s <span style=color:#ff79c6>-&gt;</span> s <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;A&#34;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>takeWhile</span><span style=color:#ff79c6>(</span>s <span style=color:#ff79c6>-&gt;</span> s<span style=color:#ff79c6>.</span><span style=color:#50fa7b>length</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>10</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>forEach</span><span style=color:#ff79c6>(</span>System<span style=color:#ff79c6>.</span><span style=color:#50fa7b>out</span><span style=color:#ff79c6>::</span>println<span style=color:#ff79c6>);</span>
</span></span></code></pre></div><p>なので、<code>iterate()</code>の継続条件を書いてない場合には<code>takeWhile()</code>を使ってどの条件で処理が終わるかを明示した方が良いですね。</p><h3 id=dropwhile-9>dropWhile (9)</h3><p><code>dropWhile()</code>は、その名からも推測できますが、<code>takeWhile()</code>と真逆の機能をするメソッドです。このメソッドはStreamから与えられた条件と一致する要素を除いて、残りの要素を返却します。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#6272a4>// AAAAAから出力する
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>Stream<span style=color:#ff79c6>.</span><span style=color:#50fa7b>iterate</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;A&#34;</span><span style=color:#ff79c6>,</span> s <span style=color:#ff79c6>-&gt;</span> s<span style=color:#ff79c6>.</span><span style=color:#50fa7b>length</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>10</span><span style=color:#ff79c6>,</span> s <span style=color:#ff79c6>-&gt;</span> s <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;A&#34;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>dropWhile</span><span style=color:#ff79c6>(</span>s <span style=color:#ff79c6>-&gt;</span> <span style=color:#ff79c6>!</span>s<span style=color:#ff79c6>.</span><span style=color:#50fa7b>contains</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;AAAAA&#34;</span><span style=color:#ff79c6>))</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>forEach</span><span style=color:#ff79c6>(</span>System<span style=color:#ff79c6>.</span><span style=color:#50fa7b>out</span><span style=color:#ff79c6>::</span>println<span style=color:#ff79c6>);</span>
</span></span></code></pre></div><h3 id=ofnullable-9>ofNullable (9)</h3><p>Java 1.8のStreamでは、Null要素を追加するためにはまずその要素がNullかどうかをチェックして、Nullの場合に<code>Stream.empty()</code>を呼ぶような形にする必要がありました。いつものJavaのNullチェックですね。例えば以下のようなものです。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#6272a4>// 要素のNullチェックを含むStreamのCollect
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>keyList<span style=color:#ff79c6>.</span><span style=color:#50fa7b>stream</span><span style=color:#ff79c6>()</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>flatMap</span><span style=color:#ff79c6>(</span>k <span style=color:#ff79c6>-&gt;</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>        Object value <span style=color:#ff79c6>=</span> map<span style=color:#ff79c6>.</span><span style=color:#50fa7b>get</span><span style=color:#ff79c6>(</span>k<span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> value <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>null</span> <span style=color:#ff79c6>?</span> Stream<span style=color:#ff79c6>.</span><span style=color:#50fa7b>of</span><span style=color:#ff79c6>(</span>value<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>:</span> Stream<span style=color:#ff79c6>.</span><span style=color:#50fa7b>empty</span><span style=color:#ff79c6>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>})</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>collect</span><span style=color:#ff79c6>(</span>Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>toList</span><span style=color:#ff79c6>());</span>
</span></span></code></pre></div><p>これを、Java 9ではより簡単なコードで書くことができます。<code>Optional</code>の<code>ofNullable()</code>とあまり変わらない感覚ですね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>keyList<span style=color:#ff79c6>.</span><span style=color:#50fa7b>stream</span><span style=color:#ff79c6>()</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>.</span><span style=color:#50fa7b>flatMap</span><span style=color:#ff79c6>(</span>k <span style=color:#ff79c6>-&gt;</span> Stream<span style=color:#ff79c6>.</span><span style=color:#50fa7b>ofNullable</span><span style=color:#ff79c6>(</span>map<span style=color:#ff79c6>.</span><span style=color:#50fa7b>get</span><span style=color:#ff79c6>(</span>k<span style=color:#ff79c6>)))</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>.</span><span style=color:#50fa7b>collect</span><span style=color:#ff79c6>(</span>Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>toList</span><span style=color:#ff79c6>());</span>
</span></span></code></pre></div><h2 id=collectors>Collectors</h2><p>Streamの要素を集約するためのCollectorを提供する<code>Collectors</code> APIですが、こちらの変化は主にシンタックスシュガーなものが多い印象です。主にStreamでしかできなかったことや、既存のCollectorsのみだとかなり長くなるコードを簡潔に書くことができるようになっています。</p><h3 id=filtering-9>filtering (9)</h3><p><code>Stream</code>の<code>filter()</code>と同じ処理を、<code>Collector</code>でもできるようになりました。どちらを使うかは好みの問題な気がしますが、<code>Collector</code>そのものを共通化するなどの処理ができそうな気はしますね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#6272a4>// 0~9までのリスト
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>List<span style=color:#ff79c6>&lt;</span>Integer<span style=color:#ff79c6>&gt;</span> numbers <span style=color:#ff79c6>=</span> Stream<span style=color:#ff79c6>.</span><span style=color:#50fa7b>iterate</span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>0</span><span style=color:#ff79c6>,</span> i <span style=color:#ff79c6>-&gt;</span> i <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>10</span><span style=color:#ff79c6>,</span> i <span style=color:#ff79c6>-&gt;</span> i <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span><span style=color:#ff79c6>).</span><span style=color:#50fa7b>collect</span><span style=color:#ff79c6>(</span>Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>toList</span><span style=color:#ff79c6>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Stream.filter()
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>numbers<span style=color:#ff79c6>.</span><span style=color:#50fa7b>stream</span><span style=color:#ff79c6>()</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>filter</span><span style=color:#ff79c6>(</span>e <span style=color:#ff79c6>-&gt;</span> e <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>5</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>collect</span><span style=color:#ff79c6>(</span>Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>toList</span><span style=color:#ff79c6>());</span> <span style=color:#6272a4>// 6, 7, 8, 9
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Collectors.filtering()
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>numbers<span style=color:#ff79c6>.</span><span style=color:#50fa7b>stream</span><span style=color:#ff79c6>()</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>collect</span><span style=color:#ff79c6>(</span>Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>filtering</span><span style=color:#ff79c6>(</span>e <span style=color:#ff79c6>-&gt;</span> e <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>5</span><span style=color:#ff79c6>,</span> Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>toList</span><span style=color:#ff79c6>()));</span>  <span style=color:#6272a4>// 6, 7, 8, 9
</span></span></span></code></pre></div><h3 id=flatmapping-9>flatMapping (9)</h3><p>これもまた名前から推測できると思いますが、<code>Collectors</code>でCollectionに変えるとき、要素のflatMappingをできるようにしてくれるようなものです。具体的には、以下のサンプルコードを参照してください。</p><p>例えば、以下のようなクラスがあるとします。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>Selling</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>   String clientName<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span>   List<span style=color:#ff79c6>&lt;</span>Product<span style=color:#ff79c6>&gt;</span> products<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>Product</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>   String name<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span>   <span style=color:#8be9fd>int</span> value<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>}</span>
</span></span></code></pre></div><p>そして、このSellingのリストを、「clientNameをKeyに、productsをValueにしたMapにしたい」場合はどうしたら良いでしょうか。例えば以下のような方法を考えられます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Map<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>,</span> List<span style=color:#ff79c6>&lt;</span>List<span style=color:#ff79c6>&lt;</span>Product<span style=color:#ff79c6>&gt;&gt;&gt;</span> result <span style=color:#ff79c6>=</span> operations<span style=color:#ff79c6>.</span><span style=color:#50fa7b>stream</span><span style=color:#ff79c6>()</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>.</span><span style=color:#50fa7b>collect</span><span style=color:#ff79c6>(</span>Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>groupingBy</span><span style=color:#ff79c6>(</span>Selling<span style=color:#ff79c6>::</span>getClientName<span style=color:#ff79c6>,</span> Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>mapping</span><span style=color:#ff79c6>(</span>Selling<span style=color:#ff79c6>::</span>getProducts<span style=color:#ff79c6>,</span> Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>toList</span><span style=color:#ff79c6>())));</span>
</span></span></code></pre></div><p>しかし、問題は、<code>List&lt;Product></code>をさらにListの中に入れてしまうことになります。これは本来の目的ともズレていて、無駄な処理が発生し、Valueを持ち出すときも不便なはずです。</p><p>これを<code>Map&lt;String, List&lt;Product>></code>の形に変えるとしたら、以下のような方法が使えます。自作のCollectorを作るのですね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Map<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>,</span> List<span style=color:#ff79c6>&lt;</span>Product<span style=color:#ff79c6>&gt;&gt;</span> result <span style=color:#ff79c6>=</span> operations<span style=color:#ff79c6>.</span><span style=color:#50fa7b>stream</span><span style=color:#ff79c6>()</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>collect</span><span style=color:#ff79c6>(</span>Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>groupingBy</span><span style=color:#ff79c6>(</span>Selling<span style=color:#ff79c6>::</span>getClientName<span style=color:#ff79c6>,</span> Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>mapping</span><span style=color:#ff79c6>(</span>Selling<span style=color:#ff79c6>::</span>getProducts<span style=color:#ff79c6>,</span>
</span></span><span style=display:flex><span>        Collector<span style=color:#ff79c6>.</span><span style=color:#50fa7b>of</span><span style=color:#ff79c6>(</span>ArrayList<span style=color:#ff79c6>::</span><span style=color:#ff79c6>new</span><span style=color:#ff79c6>,</span> List<span style=color:#ff79c6>::</span>addAll<span style=color:#ff79c6>,</span> <span style=color:#ff79c6>(</span>x<span style=color:#ff79c6>,</span> y<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>-&gt;</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>            x<span style=color:#ff79c6>.</span><span style=color:#50fa7b>addAll</span><span style=color:#ff79c6>(</span>y<span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> x<span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>}))));</span>
</span></span></code></pre></div><p>ただ、毎回このような自作Collectorを作るというのはあまり効率的ではない方法ではないかと思います。それに、自作のCollectorを普段から使ってない場合はコードだけみても少しわかりづらくもありますね。なので、ここは新しく追加された<code>flatMapping()</code>で変えてみると以下のようになります。より簡潔ですね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Map<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>,</span> List<span style=color:#ff79c6>&lt;</span>Product<span style=color:#ff79c6>&gt;&gt;</span> result <span style=color:#ff79c6>=</span> operations<span style=color:#ff79c6>.</span><span style=color:#50fa7b>stream</span><span style=color:#ff79c6>()</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>collect</span><span style=color:#ff79c6>(</span>Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>groupingBy</span><span style=color:#ff79c6>(</span>Selling<span style=color:#ff79c6>::</span>getClientName<span style=color:#ff79c6>,</span> Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>flatMapping</span><span style=color:#ff79c6>(</span>selling <span style=color:#ff79c6>-&gt;</span> selling<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getProducts</span><span style=color:#ff79c6>().</span><span style=color:#50fa7b>stream</span><span style=color:#ff79c6>(),</span> Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>toList</span><span style=color:#ff79c6>())));</span>
</span></span></code></pre></div><h3 id=tounmodifiable-10>toUnmodifiable (10)</h3><p>Java 10では<code>Collectors</code>に以下の三つのメソッドが追加されています。</p><ul><li><code>toUnmodifiableList()</code></li><li><code>toUnmodifiableSet()</code></li><li><code>toUnmodifiableMap()</code></li></ul><p>これらのメソッドを使うと、既存の<code>Collections</code>を呼ぶ必要なく、簡単に(もっと短いコードで)UnmodifiableなCollectionを作ることができます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#6272a4>// Collections.unmodifiableList
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>List<span style=color:#ff79c6>&lt;</span>Integer<span style=color:#ff79c6>&gt;</span> collectionsUnmodifiable <span style=color:#ff79c6>=</span> Collections<span style=color:#ff79c6>.</span><span style=color:#50fa7b>unmodifiableList</span><span style=color:#ff79c6>(</span>Stream<span style=color:#ff79c6>.</span><span style=color:#50fa7b>iterate</span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>0</span><span style=color:#ff79c6>,</span> i <span style=color:#ff79c6>-&gt;</span> i <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>10</span><span style=color:#ff79c6>,</span> i <span style=color:#ff79c6>-&gt;</span> i <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span><span style=color:#ff79c6>).</span><span style=color:#50fa7b>collect</span><span style=color:#ff79c6>(</span>Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>toList</span><span style=color:#ff79c6>()));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Collectors.toUnmodifiableList
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>List<span style=color:#ff79c6>&lt;</span>Integer<span style=color:#ff79c6>&gt;</span> collectionsUnmodifiable <span style=color:#ff79c6>=</span> Stream<span style=color:#ff79c6>.</span><span style=color:#50fa7b>iterate</span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>0</span><span style=color:#ff79c6>,</span> i <span style=color:#ff79c6>-&gt;</span> i <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>10</span><span style=color:#ff79c6>,</span> i <span style=color:#ff79c6>-&gt;</span> i <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span><span style=color:#ff79c6>).</span><span style=color:#50fa7b>collect</span><span style=color:#ff79c6>(</span>Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>toUnmodifiableList</span><span style=color:#ff79c6>());</span>
</span></span></code></pre></div><p>引数は、既存の<code>toList()</code>・<code>toSet()</code>・<code>toMap()</code>と同じなので(<code>toMap()</code>だけ、KeyとValueのマッピングを指定する必要がありますね)、既存のメソッドと同じ感覚で使うことができます。</p><h2 id=collections>Collections</h2><p>Collections APIの新しいメソッドは、かなり現代的な書き方を可能にします。Kotlinのような言語がJavaの冗長さを回避するための工夫をしているのであれば、Java側に新しく追加されたメソッドはそれをさらにJavaに似合うような形で受け入れたような印象です。(というか、それしか方法はなかったかもしれませんが…)</p><h3 id=factory-method-9>Factory Method (9)</h3><p>Java 9では、<a class=link href=https://ja.wikipedia.org/wiki/Factory_Method_%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3 target=_blank rel=noopener>ファクトリーメソッド</a>でCollectionの作成ができるようになりました。使い方としては、既存の<code>Arrays.asList()</code>と似ているような感覚です。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#6272a4>// Listの作成
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>List<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> list <span style=color:#ff79c6>=</span> List<span style=color:#ff79c6>.</span><span style=color:#50fa7b>of</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;A&#34;</span><span style=color:#ff79c6>,</span> <span style=color:#f1fa8c>&#34;B&#34;</span><span style=color:#ff79c6>,</span> <span style=color:#f1fa8c>&#34;C&#34;</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Setの作成
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>Set<span style=color:#ff79c6>&lt;</span>Integer<span style=color:#ff79c6>&gt;</span> set <span style=color:#ff79c6>=</span> Set<span style=color:#ff79c6>.</span><span style=color:#50fa7b>of</span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>1</span><span style=color:#ff79c6>,</span> <span style=color:#bd93f9>2</span><span style=color:#ff79c6>,</span> <span style=color:#bd93f9>3</span><span style=color:#ff79c6>);</span>
</span></span></code></pre></div><p>Mapの場合は、KeyとValueを順番に並ぶことでインスタンスを作成できますが、エントリーを定義することもできます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#6272a4>// KeyとValueのセットで定義する
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>Map<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>,</span> String<span style=color:#ff79c6>&gt;</span> map <span style=color:#ff79c6>=</span> Map<span style=color:#ff79c6>.</span><span style=color:#50fa7b>of</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;foo&#34;</span><span style=color:#ff79c6>,</span> <span style=color:#f1fa8c>&#34;a&#34;</span><span style=color:#ff79c6>,</span> <span style=color:#f1fa8c>&#34;bar&#34;</span><span style=color:#ff79c6>,</span> <span style=color:#f1fa8c>&#34;b&#34;</span><span style=color:#ff79c6>,</span> <span style=color:#f1fa8c>&#34;baz&#34;</span><span style=color:#ff79c6>,</span> <span style=color:#f1fa8c>&#34;c&#34;</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// エントリーを定義する
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>Map<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>,</span> String<span style=color:#ff79c6>&gt;</span> map <span style=color:#ff79c6>=</span> Map<span style=color:#ff79c6>.</span><span style=color:#50fa7b>ofEntries</span><span style=color:#ff79c6>(</span>
</span></span><span style=display:flex><span>  Map<span style=color:#ff79c6>.</span><span style=color:#50fa7b>entry</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;foo&#34;</span><span style=color:#ff79c6>,</span> <span style=color:#f1fa8c>&#34;a&#34;</span><span style=color:#ff79c6>),</span>
</span></span><span style=display:flex><span>  Map<span style=color:#ff79c6>.</span><span style=color:#50fa7b>entry</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;bar&#34;</span><span style=color:#ff79c6>,</span> <span style=color:#f1fa8c>&#34;b&#34;</span><span style=color:#ff79c6>),</span>
</span></span><span style=display:flex><span>  Map<span style=color:#ff79c6>.</span><span style=color:#50fa7b>entry</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;baz&#34;</span><span style=color:#ff79c6>,</span> <span style=color:#f1fa8c>&#34;c&#34;</span><span style=color:#ff79c6>));</span>
</span></span></code></pre></div><p>これらのファクトリーメソッドで作成したCollectionの特徴は、最初からUnmodifiableなオブジェクトになるということです。なので、例えばアプリケーションの起動時にフィールドに定数をCollectionとして定義する、という場合に使えます。つまり、以下のような既存のコードを代替できるようなものです。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#6272a4>// もっとも基本的な方式
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>Set<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> set <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> HashSet<span style=color:#ff79c6>&lt;&gt;();</span>
</span></span><span style=display:flex><span>set<span style=color:#ff79c6>.</span><span style=color:#50fa7b>add</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;foo&#34;</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span>set<span style=color:#ff79c6>.</span><span style=color:#50fa7b>add</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;bar&#34;</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span>set<span style=color:#ff79c6>.</span><span style=color:#50fa7b>add</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;baz&#34;</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span>set <span style=color:#ff79c6>=</span> Collections<span style=color:#ff79c6>.</span><span style=color:#50fa7b>unmodifiableSet</span><span style=color:#ff79c6>(</span>set<span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Double-brace initialization 
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>Set<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> set <span style=color:#ff79c6>=</span> Collections<span style=color:#ff79c6>.</span><span style=color:#50fa7b>unmodifiableSet</span><span style=color:#ff79c6>(</span><span style=color:#ff79c6>new</span> HashSet<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;()</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>        add<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;foo&#34;</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span>        add<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;bar&#34;</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span>        add<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;baz&#34;</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>});</span>
</span></span></code></pre></div><p>また、このファクトリーメソッドで作ったCollectionは以下のような特徴を持ちますので、必要に応じて使うのが大事ですね。</p><ul><li>Immutable(Unmodifiable)になる</li><li>Null要素を指定できない</li><li>要素がSerializableだとCollectionもSerializableになる</li></ul><h4 id=copyof-10>copyOf (10)</h4><p>List, Set, Mapに<code>copyOf()</code>というメソッドが追加されています。引数にそれぞれのCollectionを渡すと、Unmodifiableなコピーすることができます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#6272a4>// コピー元のリスト
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>List<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> original <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// コピーする
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>List<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> copy <span style=color:#ff79c6>=</span> List<span style=color:#ff79c6>.</span><span style=color:#50fa7b>copyOf</span><span style=color:#ff79c6>(</span>original<span style=color:#ff79c6>);</span>
</span></span></code></pre></div><h2 id=optional>Optional</h2><p>Optionalは積極的に使われていますか？私の場合は、Streamが返すもの以外で、自分でOptionalを使う場合はあまりないです。色々制約が多いので、複雑なNullチェックが必要な場合ではないと使いづらい気もしますね。ただ、9と10で追加されたメソッドでかなり便利に使えるものとなったので、たまには良いのかもしれません。</p><h3 id=or-9>or (9)</h3><p>Optionalの中身がNullの場合に実行されるメソッドです。既存の<code>orElse()</code>や<code>orElseGet()</code>と何が違うかというと、こちらはOptionalの中身ではなく、またのOptionalを返すということです。引数としてはSupplierをとります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>String string <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span>Optional<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> optional <span style=color:#ff79c6>=</span> Optional<span style=color:#ff79c6>.</span><span style=color:#50fa7b>ofNullable</span><span style=color:#ff79c6>(</span>string<span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span>System<span style=color:#ff79c6>.</span><span style=color:#50fa7b>out</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>println</span><span style=color:#ff79c6>(</span>optional<span style=color:#ff79c6>.</span><span style=color:#50fa7b>or</span><span style=color:#ff79c6>(()</span> <span style=color:#ff79c6>-&gt;</span> Optional<span style=color:#ff79c6>.</span><span style=color:#50fa7b>of</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;default&#34;</span><span style=color:#ff79c6>)).</span><span style=color:#50fa7b>get</span><span style=color:#ff79c6>());</span> <span style=color:#6272a4>// &#34;default&#34;
</span></span></span></code></pre></div><h3 id=orelsethrow-10>orElseThrow (10)</h3><p>Optionalの中身がNullの場合は例外を投げる分岐です。NullのOptionalはもともと<code>NoSuchElementException</code>を投げますが、ビジネスロジックなどによりカスタマイズした例外を投げたい場合などはこちらを使えますね。引数としてはSupplierをとります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>String string <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>null</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span>Optional<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> optional <span style=color:#ff79c6>=</span> Optional<span style=color:#ff79c6>.</span><span style=color:#50fa7b>ofNullable</span><span style=color:#ff79c6>(</span>string<span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span>String throwing <span style=color:#ff79c6>=</span> optional<span style=color:#ff79c6>.</span><span style=color:#50fa7b>orElseThrow</span><span style=color:#ff79c6>(</span>RuntimeException<span style=color:#ff79c6>::</span><span style=color:#ff79c6>new</span><span style=color:#ff79c6>);</span> <span style=color:#6272a4>// RuntimeException
</span></span></span></code></pre></div><h3 id=ifpresentorelse-9>ifPresentOrElse (9)</h3><p>Optionalの中身がNullかどうかによって二つのアクションを指定して、分岐処理ができるようなメソッドです。第一引数としてはConsumerを指定することで中身がNullではない場合の処理を、第二引数としてはRunnableとして中身がNullだった場合の処理を書きます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Optional<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> hasValue <span style=color:#ff79c6>=</span> Optional<span style=color:#ff79c6>.</span><span style=color:#50fa7b>of</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;proper value&#34;</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span>hasValue<span style=color:#ff79c6>.</span><span style=color:#50fa7b>ifPresentOrElse</span><span style=color:#ff79c6>(</span>v <span style=color:#ff79c6>-&gt;</span> System<span style=color:#ff79c6>.</span><span style=color:#50fa7b>out</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>println</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;the value is &#34;</span> <span style=color:#ff79c6>+</span> v<span style=color:#ff79c6>),</span> <span style=color:#ff79c6>()</span> <span style=color:#ff79c6>-&gt;</span> System<span style=color:#ff79c6>.</span><span style=color:#50fa7b>out</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>println</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;there is no value&#34;</span><span style=color:#ff79c6>));</span> <span style=color:#6272a4>// the value is proper value
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>Optional<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> hasNoValue <span style=color:#ff79c6>=</span> Optional<span style=color:#ff79c6>.</span><span style=color:#50fa7b>empty</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span>hasNoValue<span style=color:#ff79c6>.</span><span style=color:#50fa7b>ifPresentOrElse</span><span style=color:#ff79c6>(</span>v <span style=color:#ff79c6>-&gt;</span> System<span style=color:#ff79c6>.</span><span style=color:#50fa7b>out</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>println</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;the value is &#34;</span> <span style=color:#ff79c6>+</span> v<span style=color:#ff79c6>),</span> <span style=color:#ff79c6>()</span> <span style=color:#ff79c6>-&gt;</span> System<span style=color:#ff79c6>.</span><span style=color:#50fa7b>out</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>println</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;there is no value&#34;</span><span style=color:#ff79c6>));</span> <span style=color:#6272a4>// there is no value
</span></span></span></code></pre></div><h3 id=stream-9>stream (9)</h3><p>Optionalを要素が一つか、Null(<code>Stream.empty()</code>)のSteamに変えるメソッドです。もともとStreamから要素を取得するときもOptionalになっていたので、このようなメソッドが追加されたのも当たり前といえば当たり前ですね。要素が多くて一つなのにStreamに変える意味があるかというと、他のStreamと結合ができたりもするので色々と活用できる余地はありそうです。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Optional<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> optional <span style=color:#ff79c6>=</span> Optional<span style=color:#ff79c6>.</span><span style=color:#50fa7b>of</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;value&#34;</span><span style=color:#ff79c6>);</span>
</span></span><span style=display:flex><span>Stream<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> stream <span style=color:#ff79c6>=</span> optional<span style=color:#ff79c6>.</span><span style=color:#50fa7b>stream</span><span style=color:#ff79c6>();</span>
</span></span></code></pre></div><h2 id=string>String</h2><p>String APIの場合は、主にJava 11でかなりの変化がありました。Webアプリケーションのみならず、最近のアプリケーションは文字列を扱う場合が多いので、このような変化はありがたいですね。</p><h3 id=repeat-11>repeat (11)</h3><p>指定した数値分、文字列を繰り返します。同じ文字列の単純な繰り返しだとすると、StringBuilderやStrinbBufferなしでも簡単に使えるこちらのメソッドの方が良いですね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>String a10 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;A&#34;</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>repeat</span><span style=color:#ff79c6>(</span><span style=color:#bd93f9>10</span><span style=color:#ff79c6>);</span> <span style=color:#6272a4>// &#34;AAAAAAAAAA&#34;
</span></span></span></code></pre></div><h3 id=strip-11>strip (11)</h3><p>文字列の前後の空白を除外するために、今までは<code>trim()</code>を使うケースが多かったのではと思いますが、Java 11からは<code>strip()</code>が追加され、<code>trim()</code>を代替できます。この二つが何が違うかというと、まずそれぞれのメソッドで定義している「空白」が違います。<code>trim()</code>はUnicodeを考慮してなかったため、半角スペースのみの対応となっていましたが、<code>strip()</code>はUnicodeで指定されたWhitespace全部を対象とするので、全角スペースや改行にも対応できます。どの文字がWhitespaceとして扱われるかは、<code>Character.isWhitespace()</code>のメソッドが基準となるので、<a class=link href=https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Character.html#isWhitespace%28char%29 target=_blank rel=noopener>そちらのJavaDoc</a>を参照してください。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>String stripped <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;\n  hello world  \u2005&#34;</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>strip</span><span style=color:#ff79c6>();</span> <span style=color:#6272a4>// &#34;hello world&#34;
</span></span></span></code></pre></div><p>また、<code>strip()</code>では前後の空白が全部削除されるのですが、文字列の前後を基準にして片方だけ削除したい場合は、前からだけを削除する<code>stripLeading()</code>や後ろからだけを削除する<code>stripTrailing()</code>も使えます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>String stripLeading <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;\n  hello world  \u2005&#34;</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>stripLeading</span><span style=color:#ff79c6>();</span> <span style=color:#6272a4>// &#34;hello world   &#34;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>String stripTrailing <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;\n  hello world  \u2005&#34;</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>stripTrailing</span><span style=color:#ff79c6>();</span> <span style=color:#6272a4>// &#34;\n  hello world&#34;
</span></span></span></code></pre></div><p>今までの説明だけでも十分<code>strip()</code>を使う理由はあると思いますが、実はもう一つがあります。性能です。性能という面では<code>strip()</code>の方が<code>trim()</code>より<a class=link href=https://stackoverflow.com/questions/53640184/why-is-string-strip-5-times-faster-than-string-trim-for-blank-string-in-java target=_blank rel=noopener>5倍も早い</a>と言われているので、なるべく<code>trim()</code>よりは<code>strip()</code>を使うべきですね。</p><h3 id=isblank-11>isBlank (11)</h3><p>すでに<code>isEmpty()</code>というメソッドがありますが、このメソッドと<code>isBlank()</code>の違いは、<code>trim()</code>と<code>strip()</code>の関係と似ています。同じく、<code>isEmpty()</code>と比べると<code>isBlank()</code>の方がUnicodeに対応しているのでより多くのケースのWhitespaceに対応できて、性能でも優れています。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8be9fd>boolean</span> isEmpty <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;\n    \u2005&#34;</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>isEmpty</span><span style=color:#ff79c6>();</span> <span style=color:#6272a4>// false
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>boolean</span> isBlank <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;\n    \u2005&#34;</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>isBlank</span><span style=color:#ff79c6>();</span> <span style=color:#6272a4>// true
</span></span></span></code></pre></div><h3 id=lines-11>lines (11)</h3><p>文字列に改行コード(<code>\n</code>・<code>\r</code>・<code>\r\n</code>)を基準に分けた<code>Stream&lt;String></code>を返却します。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>String multipleLine <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;first\nsecond\nthird&#34;</span><span style=color:#ff79c6>;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>long</span> lines <span style=color:#ff79c6>=</span> multipleLine<span style=color:#ff79c6>.</span><span style=color:#50fa7b>lines</span><span style=color:#ff79c6>().</span><span style=color:#50fa7b>filter</span><span style=color:#ff79c6>(</span>String<span style=color:#ff79c6>::</span>isBlank<span style=color:#ff79c6>).</span><span style=color:#50fa7b>count</span><span style=color:#ff79c6>();</span> <span style=color:#6272a4>// 3
</span></span></span></code></pre></div><h2 id=prediacte-not-11>Prediacte not (11)</h2><p>LambdaやMethod Referenceで定義したPredicateの結果がFalseかどうかを判断するためのメソッドです。単純にtrueの否定になるだけなのですが、このメソッドの引数はPredicateなので、LambdaやMethod Referenceを使ってより単純に表現できるのがメリットといえますね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#6272a4>// 否定の条件式を使う場合
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>list<span style=color:#ff79c6>.</span><span style=color:#50fa7b>stream</span><span style=color:#ff79c6>()</span>                       
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>filter</span><span style=color:#ff79c6>(</span>m <span style=color:#ff79c6>-&gt;</span> <span style=color:#ff79c6>!</span>m<span style=color:#ff79c6>.</span><span style=color:#50fa7b>isPrepared</span><span style=color:#ff79c6>())</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>collect</span><span style=color:#ff79c6>(</span>Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>toList</span><span style=color:#ff79c6>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Predicate.not()を使う場合
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>list<span style=color:#ff79c6>.</span><span style=color:#50fa7b>stream</span><span style=color:#ff79c6>()</span>                          
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>filter</span><span style=color:#ff79c6>(</span>Predicate<span style=color:#ff79c6>.</span><span style=color:#50fa7b>not</span><span style=color:#ff79c6>(</span>Man<span style=color:#ff79c6>::</span>isPrepared<span style=color:#ff79c6>))</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>collect</span><span style=color:#ff79c6>(</span>Collectors<span style=color:#ff79c6>.</span><span style=color:#50fa7b>toList</span><span style=color:#ff79c6>());</span>
</span></span></code></pre></div><h2 id=最後に>最後に</h2><p>2021年に次のLTSであるJava 17がリリースされると、今のJava 11を使う現場の場合は多くがJava 17に移行するのではないかと思います。12から16まで、さまざまなAPIや機能、JVMの改善などが含まれていて、すでに多くのブログなどで紹介されていますが、また既存のAPIにはどのような変化があるかまでは完全に把握していない状態です。なので、Java 17のリリースに合わせて、もう一度12〜17までの新しいメソッドの整理と紹介を行おうと思います。これだけでもかなり勉強になりますし、業務で使えそうなテクニックも増えていく感覚ですね。</p><p>また、今年のポスティングはこれで終了となります。色々と大変な一年だったのですが、なんとか年末を迎えることができましたね。その間、このブログにも多くの方々がいらしてくださいました。まだジュニアレベルでしかない駆け出しエンジニアのブログなのであまり情報取集には役立たないかもしれませんが、少しでも私の書いたポストを読んでくださりありがとうございます。来年からは、より面白く、より良い情報を収取してブログに載せたいですね。</p><p>では、また！</p></section><footer class=article-footer><section class=article-tags><a href=/tags/java/>java</a>
<a href=/tags/stream/>stream</a>
<a href=/tags/collection/>collection</a>
<a href=/tags/optional/>optional</a>
<a href=/tags/string/>string</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/posts/java-collection-loop/><div class=article-image><img src=/../../images/java.jpg loading=lazy data-key data-hash=/../../images/java.jpg></div><div class=article-details><h2 class=article-title>今更なループの話</h2></div></a></article><article class=has-image><a href=/posts/java-string-concat-and-split/><div class=article-image><img src=/../../images/java.jpg loading=lazy data-key data-hash=/../../images/java.jpg></div><div class=article-details><h2 class=article-title>今更な文字列操作の話</h2></div></a></article><article class=has-image><a href=/posts/java-compare-and-merge-lists/><div class=article-image><img src=/../../images/java.jpg loading=lazy data-key data-hash=/../../images/java.jpg></div><div class=article-details><h2 class=article-title>二つのListを結合する</h2></div></a></article><article class=has-image><a href=/posts/java-stream/><div class=article-image><img src=/../../images/java.jpg loading=lazy data-key data-hash=/../../images/java.jpg></div><div class=article-details><h2 class=article-title>Streamを正しく使う</h2></div></a></article><article class=has-image><a href=/posts/java-optional/><div class=article-image><img src=/../../images/java.jpg loading=lazy data-key data-hash=/../../images/java.jpg></div><div class=article-details><h2 class=article-title>Nullチェックの地獄から脱出したい</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2019 -
2023 Korean-man in Tokyo</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.7.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#stream>Stream</a><ol><li><a href=#iterate-9>Iterate (9)</a></li><li><a href=#takewhile-9>takeWhile (9)</a></li><li><a href=#dropwhile-9>dropWhile (9)</a></li><li><a href=#ofnullable-9>ofNullable (9)</a></li></ol></li><li><a href=#collectors>Collectors</a><ol><li><a href=#filtering-9>filtering (9)</a></li><li><a href=#flatmapping-9>flatMapping (9)</a></li><li><a href=#tounmodifiable-10>toUnmodifiable (10)</a></li></ol></li><li><a href=#collections>Collections</a><ol><li><a href=#factory-method-9>Factory Method (9)</a><ol><li><a href=#copyof-10>copyOf (10)</a></li></ol></li></ol></li><li><a href=#optional>Optional</a><ol><li><a href=#or-9>or (9)</a></li><li><a href=#orelsethrow-10>orElseThrow (10)</a></li><li><a href=#ifpresentorelse-9>ifPresentOrElse (9)</a></li><li><a href=#stream-9>stream (9)</a></li></ol></li><li><a href=#string>String</a><ol><li><a href=#repeat-11>repeat (11)</a></li><li><a href=#strip-11>strip (11)</a></li><li><a href=#isblank-11>isBlank (11)</a></li><li><a href=#lines-11>lines (11)</a></li></ol></li><li><a href=#prediacte-not-11>Prediacte not (11)</a></li><li><a href=#最後に>最後に</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>