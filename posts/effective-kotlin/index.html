<!doctype html><html lang=en-us>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="今回は久々に本を読んだのでそれに関する感想を少し書こうと思います。転職前は主にJavaを扱っていたため、Effective Javaを読み自分"><title>Effective Kotlinを読む</title>
<link rel=canonical href=https://retheviper.github.io/posts/effective-kotlin/>
<link rel=stylesheet href=/scss/style.min.1b3ac667198cb83edcc9c45e606a6f4dd6910b8ada6b74d7fd988f1b2dfd0c7c.css><meta property="og:title" content="Effective Kotlinを読む">
<meta property="og:description" content="今回は久々に本を読んだのでそれに関する感想を少し書こうと思います。転職前は主にJavaを扱っていたため、Effective Javaを読み自分">
<meta property="og:url" content="https://retheviper.github.io/posts/effective-kotlin/">
<meta property="og:site_name" content="Korean-man in Tokyo">
<meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="kotlin"><meta property="article:published_time" content="2022-02-20T00:00:00+00:00"><meta property="article:modified_time" content="2022-02-20T00:00:00+00:00"><meta property="og:image" content="https://retheviper.github.io/images/kotlin.jpg">
<meta name=twitter:title content="Effective Kotlinを読む">
<meta name=twitter:description content="今回は久々に本を読んだのでそれに関する感想を少し書こうと思います。転職前は主にJavaを扱っていたため、Effective Javaを読み自分"><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://retheviper.github.io/images/kotlin.jpg">
<link rel=apple-touch-icon sizes=57x57 href=/favicon/apple-icon-57x57.png>
<link rel=apple-touch-icon sizes=60x60 href=/favicon/apple-icon-60x60.png>
<link rel=apple-touch-icon sizes=72x72 href=/favicon/apple-icon-72x72.png>
<link rel=apple-touch-icon sizes=76x76 href=/favicon/apple-icon-76x76.png>
<link rel=apple-touch-icon sizes=114x114 href=/favicon/apple-icon-114x114.png>
<link rel=apple-touch-icon sizes=120x120 href=/favicon/apple-icon-120x120.png>
<link rel=apple-touch-icon sizes=144x144 href=/favicon/apple-icon-144x144.png>
<link rel=apple-touch-icon sizes=152x152 href=/favicon/apple-icon-152x152.png>
<link rel=apple-touch-icon sizes=180x180 href=/favicon/apple-icon-180x180.png>
<link rel=icon type=image/png sizes=192x192 href=/favicon/android-icon-192x192.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png>
<link rel=icon type=image/png sizes=96x96 href=/favicon/favicon-96x96.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png>
<link rel=manifest href=/favicon/manifest.json>
<meta name=msapplication-TileColor content="#ffffff">
<meta name=msapplication-TileImage content="/favicon/ms-icon-144x144.png">
<meta name=theme-color content="#ffffff">
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-139986442-1','auto'),ga('send','pageview'))</script>
</head>
<body class="article-page has-toc">
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span>
</a>
</div>
<main class="main full-width">
<article class="has-image main-article">
<header class=article-header>
<div class=article-image>
<a href=/posts/effective-kotlin/>
<img src=/../../images/kotlin.jpg loading=lazy alt="Featured image of post Effective Kotlinを読む">
</a>
</div>
<div class=article-details>
<header class=article-category>
<a href=/categories/kotlin/ style=background-color:#2a9d8f;color:#fff>
kotlin
</a>
</header>
<h2 class=article-title>
<a href=/posts/effective-kotlin/>Effective Kotlinを読む</a>
</h2>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Feb 20, 2022</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
11 minute read
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<p>今回は久々に本を読んだのでそれに関する感想を少し書こうと思います。転職前は主にJavaを扱っていたため、<a class=link href="https://www.amazon.co.jp/Effective-Java-%E7%AC%AC3%E7%89%88-%E3%82%B8%E3%83%A7%E3%82%B7%E3%83%A5%E3%82%A2%E3%83%BB%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF-ebook/dp/B099922DML/ref=sr_1_1?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&crid=1OT3QRYCGG9BB&keywords=Effective+Java&qid=1645265607&sprefix=effective+kotlin%2Caps%2C753&sr=8-1" target=_blank rel=noopener>Effective Java</a>を読み自分の書いたコードを振り返って見たことがありました。転職後はKotlinという違う言語を触るようになったものの、やはりJVMで動く言語であり、現在使っているフレームワークもSpringから変わってないので基本的には同じ観点でコードを作成すると良いのかなと思っていました。しかし、Kotlinに触れてから1年が経った今、やはり言語が違うとコードを作成するときの週間も一度は見直す必要があるのではないかと思っています。</p>
<p>そこで、ちょうど<a class=link href="https://www.amazon.co.jp/Effective-Kotlin-Best-practices-English-ebook/dp/B08WXCRVD2/ref=sr_1_1?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&crid=2HVT6TZYJL65A&keywords=effective+kotlin&qid=1645264802&sprefix=effective+kotli%2Caps%2C230&sr=8-1" target=_blank rel=noopener>Effective Kotlin</a>という本を発見したので早速読んでみました。そして今回のポストではその内容について色々と書こうと思います。</p>
<p>ちなみに、この本自体は出版されて少し経つので、ネット上でもたまにその内容やPDFの資料などを発見することあができました。例えば、この本で「可読性」のチャプタに関しての話は[こちらのブログ]の方によく整理されてあるので、参考にしてください。</p>
<h2 id=全体的な印象>全体的な印象</h2>
<p>個人的に<code>Effective Java</code>は上級者向けの本で、ある程度Javaでアプリを書いたこと経験のある人でないと理解が難しいところが多かったかなと思います。例えば、「<code>try-finally</code>を
<code>try-with-resource</code>に代替した方がいいとか、<code>Stream</code>で副作用のない関数を書く方法などが紹介されていますが、これらはやはりある程度Javaという言語の設計と仕様に対する基盤知識を必要とするものですね。</p>
<p>それに比べ、<code>Effective Kotlin</code>には初心者向けの内容も結構あります。例えば、そもそものオブジェクト志向が何かのような内容がありました。ただそれだけではどう思っても<code>Effective Java</code>を意識したような題名が意味をなくすと判断したからか（前書きでも<code>Effective Java</code>を言及しています）他には「ベストプラクティス」として書かれているものも多いです。</p>
<p>そして当たり前ながら、Kotlinにおいても有効なことは<code>Effective Java</code>と重なっているような部分もあります。例えば、オブジェクトのインスタンスを作るときはfactory methodを書いた方が良いとかがそうですね。</p>
<p>ただ、Kotlinのバージョンアップの速さに追いついてないと感じるところがあったり（これは出版物の限界でもありますが）、上級者向けの内容は多少十分ではない感覚でしたので、どちらかというとジュニア向けの感覚ではあります。</p>
<h2 id=興味深い>興味深い</h2>
<p>ジュニア向けといいつつ、自分もまだジュニア（の気持ち）であるため、興味深いと思ったところもありました。ここでその一部を紹介したいと思います。</p>
<h3 id=single-responsibility-principle>Single responsibility principle</h3>
<p>いわゆる<a class=link href=https://ja.wikipedia.org/wiki/SOLID target=_blank rel=noopener>SOLID</a>に触れるパートです。Kotlinでは拡張関数を用いることで、単一責任の原則を守れるという主張をしていました。まず以下のようなケースがあるとしましょう。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Student</span> {
    <span style=color:#6272a4>// ...
</span><span style=color:#6272a4></span>
    <span style=color:#ff79c6>fun</span> <span style=color:#50fa7b>isPassing</span>(): Boolean = 
        calculatePointsFromPassedCourses() &gt; <span style=color:#bd93f9>15</span>

    <span style=color:#ff79c6>fun</span> <span style=color:#50fa7b>qualifiesForScholarship</span>(): Boolean = 
        calculatePointsFromPassedCourses() &gt; <span style=color:#bd93f9>30</span>

    <span style=color:#ff79c6>private</span> <span style=color:#ff79c6>fun</span> <span style=color:#50fa7b>calculatePointsFromPassedCourses</span>(): Int {
        <span style=color:#6272a4>//...
</span><span style=color:#6272a4></span>    }
}
</code></pre></div><p>ここで<code>isPassing()</code>は<code>accreditations</code>というモジュールで、<code>qualifiesForScholarship()</code>は<code>scholarship</code>というモジュールで使われるとします。そしたら、<code>Student</code>というクラスがこれらの関数を持つのは単一責任としてどうか、ということですね。</p>
<p>なので、モジュール別にこれらの関数を拡張関数として定義することが良いとのことでした。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#6272a4>// scholarship module
</span><span style=color:#6272a4></span><span style=color:#ff79c6>fun</span> <span style=color:#50fa7b>Student</span>.qualifiesForScholarship(): Boolean{
    <span style=color:#6272a4>/*...*/</span>
}

<span style=color:#6272a4>// accreditations module
</span><span style=color:#6272a4></span><span style=color:#ff79c6>fun</span> <span style=color:#50fa7b>Student</span>.calculatePointsFromPassedCourses(): Boolean{
    <span style=color:#6272a4>/*...*/</span>
}
</code></pre></div><p>もしくは<code>calculatePointsFromPassedCourses()</code>を外に出す方法を考えられるでしょう。しかし、この場合はこれらの二つのメソッド専用のprivateメソッドとしてつかえません。なので、</p>
<ol>
<li>どのモジュールでも使える共通関数を作っておく</li>
<li>department別にhelper関数を作っておく</li>
</ol>
<p>とかの方法も考えられます。</p>
<p>確かに、よく考えると拡張関数の良いところは「interfaceの実装ややスーパークラスの継承なし」でも簡単に処理を追加できるということなので、このような使い方をするのがユースケース別に処理を分けられて良さげな気がします。特に拡張関数を使うと、関数を配置するパッケージと可視性の制御が効くというところが個人的には新しい発見でした。</p>
<h3 id=consider-defining-a-dsl-for-complex-object-creation>Consider defining a DSL for complex object creation</h3>
<p>オブジェクトの作成時の複雑な処理はDSLを使いましょう、というパートです。Kotlinですでに提供している例としたら、HTMLがありますね。以下のような形で定義することになります。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>body {
    div {
        a(<span style=color:#f1fa8c>&#34;https://kotlinlang.org&#34;</span>) {
            target = ATarget.blank
            +<span style=color:#f1fa8c>&#34;google&#34;</span>
        }
    }
    +<span style=color:#f1fa8c>&#34;Some content&#34;</span>
}
</code></pre></div><p>確かにKtorのようなフレームワークでもよく使われている物なので、ある程度需要はあるのかなという気がしました。Kotlinだと高階関数を作るのが難しくはないので、十分挑戦できるところでもありますね。</p>
<p>ただ、DSL特有の書き方を確立し、その書き方をエンジニアに共有することや最初の設計と維持管理が難しそうな気がするので、アプリの縮小が求められる今のご時世に果たして合うかとうかは少し疑問ののころところでした。</p>
<p>個人的に何かのライブラリやフレームワークを作るとしたら、挑戦してみたいなと思いました。</p>
<h2 id=まあそうだよねって思ったところ>まあそうだよねって思ったところ</h2>
<p>なんとなくそうではないかと思っていたところを（もしくはどこかで聞いて理論的な部分は忘れたけど、無意識的のうちに習慣化されていた部分を）文として親切に整理してくれているようなパートもありました。なのでもう一度自分の考えを再確認できたといえるところでしょうか。</p>
<h3 id=do-not-repeat-common-algorithms>Do not repeat common algorithms</h3>
<p>「スタンダードライブラリで解決できる一般的なアルゴリズムを自前のコードで書くな」というパートです。理由は以下の通りです。</p>
<ol>
<li>呼び出しの方がコードを書くより時間が短くかかる</li>
<li>わかりやすい名前になっている</li>
<li>コードがわかりやすくなる</li>
<li>最適化が効く</li>
</ol>
<p>私自身もなるべくスタンダートライブラリを活用した方が良いと思っていたので、ここはすぐに納得できました。自分で書いた処理が果たして最適化されたものかどうかもわからないし、業務使用以外のロジックを触るのは避けたいという理由でした。</p>
<p>この本では、以下のようなコードを上げています。自前のロジックを書いた場合です。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#ff79c6>val</span> percent = <span style=color:#ff79c6>when</span> {
    number &gt; <span style=color:#bd93f9>100</span> <span style=color:#ff79c6>-&gt;</span> <span style=color:#bd93f9>100</span>
    number &lt; <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>-&gt;</span> <span style=color:#bd93f9>0</span>
    <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>-&gt;</span> number
}
</code></pre></div><p>上記のコードは、<a class=link href=https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.ranges/coerce-in.html target=_blank rel=noopener>coerceIn()</a>を使うことでシンプルにできます。以下がその例です。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#ff79c6>val</span> percent = number.coerceIn(<span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>100</span>)
</code></pre></div><p>Kotlinには特にスタンダードラリブラリに良い関数が多いので、自前のロジックを書くよりは一度どんなAPIがあるのかを確認した方が良いケースが個人的には多かった気がします。そしてそれが納得できる理由が書いてあってよかったと思います。</p>
<h3 id=implementing-your-own-utils>Implementing your own utils</h3>
<p>スタンダードライブラリで解消できる問題以外で、プロジェクトに必要な共通の処理はユーティリティ関数として作っておきましょうってパートです。ユーティリティはクラスでなく、拡張関数として作ったら以下のようなメリットがあるらしいです。</p>
<ul>
<li>関数は状態を持たないので副作用がない</li>
<li>トップレベル関数と比べると型が決まっているので使い勝手がいい</li>
<li>引数よりはクラスについた形が直観的</li>
<li>オブジェクトに関数をまとめるより必要な機能を探しやすい</li>
<li>特定のクラスに従属されるので親クラスのものか、子クラスのものか悩まない</li>
</ul>
<p>確かにJavaを使っていた時は、私もいわゆるSingleton Patternでユーティリティクラスを作ったり、DIして使えるクラスを定義しておいて、staticメソッドを書いていました。Kotlinだと、ユーティリティクラスなしでも特定のクラスに関数を追加することができるのでより使い勝手がよくなります。</p>
<p>例えば、同じことをするとしても、拡張関数で書く場合とユーティリティクラスを作る場合のコードは以下のような違いがあります。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#6272a4>// 拡張関数を使う場合
</span><span style=color:#6272a4></span><span style=color:#ff79c6>val</span> isEmptyByExtension = <span style=color:#f1fa8c>&#34;Text&#34;</span>.isEmpty()

<span style=color:#6272a4>// ユーティリティクラスを使う場合
</span><span style=color:#6272a4></span><span style=color:#ff79c6>val</span> isEmptyByUtilClass = TextUtils.isEmpty(<span style=color:#f1fa8c>&#34;Text&#34;</span>)
</code></pre></div><p>ユーティリティクラスを使う場合はまず、「どのユーティリティクラスの関数を使うか」を考えなければならないです。それに比べ、拡張関数はIDEでも自動補完ですぐ欲しい関数を見つけることができるので、より直観的なものになっていますね。</p>
<p>他にも具体的なクラスにのみ追加ができたりするので、より安全な使い方ができるというのも良いところですね。色々と拡張関数は使い道が多いなという、再発見ができたと言えるところでしょうか。</p>
<h3 id=builder-pattern>Builder pattern</h3>
<p>Kotlinでは<a class=link href=https://kotlinlang.org/docs/functions.html#named-arguments target=_blank rel=noopener>named arguments</a>が使えて、Builderパターンがいらないというパートです。KotlinでもBuilderパターンを使うことが技術的に不可能ではないが、named parameterを使った方が良い理由としては以下が挙げられています。</p>
<ul>
<li>より短い</li>
<li>より綺麗</li>
<li>使い方がシンプル</li>
<li>スレッドセーフ</li>
</ul>
<p>私自身も、Javaで使っていたのでKotlinでもBuilderパターンが必要かなと思ったことがありますが、いらないという結論を出しています。上記で挙げた理由ももちろん妥当ですが、Builderパターンだとインスタンスを生成するときに必須パラメータが揃っているかどうかを判断するのが難しくなるという理由からでした。</p>
<p>例えば本に出てくるBuilderパターンの例があるとしましょう。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Pizza</span> <span style=color:#ff79c6>private</span> <span style=color:#ff79c6>constructor</span>(
    <span style=color:#ff79c6>val</span> size: String,
    <span style=color:#ff79c6>val</span> cheese: Int,
    <span style=color:#ff79c6>val</span> olives: Int,
    <span style=color:#ff79c6>val</span> bacon: Int
) {
    <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Builder</span>(<span style=color:#ff79c6>private</span> <span style=color:#ff79c6>val</span> size: String) {
        <span style=color:#ff79c6>private</span> <span style=color:#ff79c6>var</span> cheese: Int = <span style=color:#bd93f9>0</span>
        <span style=color:#ff79c6>private</span> <span style=color:#ff79c6>var</span> olives: Int = <span style=color:#bd93f9>0</span>
        <span style=color:#ff79c6>private</span> <span style=color:#ff79c6>var</span> bacon: Int = <span style=color:#bd93f9>0</span>

        <span style=color:#ff79c6>fun</span> <span style=color:#50fa7b>setCheese</span>(value: Int): Builder = apply { cheese = value }

        <span style=color:#ff79c6>fun</span> <span style=color:#50fa7b>setOlives</span>(value: Int): Builder = apply { olives = value }

        <span style=color:#ff79c6>fun</span> <span style=color:#50fa7b>setBacon</span>(value: Int): Builder = apply { bacon = value }

        <span style=color:#ff79c6>fun</span> <span style=color:#50fa7b>build</span>() = Pizza(size, cheese, olives, bacon)
    }
}
</code></pre></div><p>このBuilderは以下のような使い方ができると思います。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#ff79c6>val</span> villagePizza = Pizza.Builder(<span style=color:#f1fa8c>&#34;L&#34;</span>)
        .setCheese(<span style=color:#bd93f9>1</span>)
        .setOlives(<span style=color:#bd93f9>2</span>)
        .setBacon(<span style=color:#bd93f9>3</span>)
        .build()
</code></pre></div><p>しかし以下の場合でもビルドはできますね。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#ff79c6>val</span> villagePizza = Pizza.Builder(<span style=color:#f1fa8c>&#34;L&#34;</span>).build()
</code></pre></div><p>もし<code>cheese</code>、<code>olives</code>、<code>bacon</code>が<code>0</code>を許容しない作りになっていると、これを修正するのは大変なことになるでしょう。もしくは、パラメータが複雑な作りのオブジェクトだったらデフォルト値を設定するか、強制null check(<code>!!</code>)などを入れるか…より複雑になるだけですね。</p>
<p>しかし、named parameterを使うと簡単に解決できる問題です。デフォルト値を指定しない<code>val</code>だったら、それが必須項目であるということもわかりやすいですね。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#ff79c6>val</span> myFavorite = Pizza(
                    size = <span style=color:#f1fa8c>&#34;L&#34;</span>,
                    cheese = <span style=color:#bd93f9>5</span>,
                    olives = <span style=color:#bd93f9>5</span>,
                    bacon = <span style=color:#bd93f9>5</span>
                )
</code></pre></div><h3 id=consider-factory-functions-instead-of-constructors>Consider factory functions instead of constructors</h3>
<p>Javaでも最近は色々とfactory functionを導入していて、簡単にimmutableなオブジェクトを作りやすくなりました。Kotlinでもコンストラクタの作成や、named parameterによるインスタンスの生成が色々と便利ではあるものの、それでもfactory functionが良いケースがあるというパートです。理由は以下の通りです。</p>
<ul>
<li>関数には名前があるので、どうやってオブジェクトが生成されるかわかる
<ul>
<li><code>ArrayList(3)</code>よりは<code>ArrayList.withSize(3)</code>がわかりやすい</li>
</ul>
</li>
<li>戻り値としてサブタイプのオブジェクトを指定できる
<ul>
<li>具体的な実装を時と場合によって違う形にすることができる</li>
</ul>
</li>
<li>呼び出されるたび新しいオブジェクトを作るわけではない
<ul>
<li><code>Connections.createOrNull()</code>のようにnullを返すこともできる</li>
</ul>
</li>
<li>まだ存在しないオブジェクトを提供できる
<ul>
<li>プロキシなしで動くようなオブジェクトを作るなどで応用できる</li>
</ul>
</li>
<li>オブジェクトの外に作ることで可視性を制御できる</li>
<li><code>inline</code>にできるので、<code>reified</code>にもできる</li>
<li>インスタンスを作るのが複雑なオブジェクトの手間を省く</li>
<li>スーパークラスやプライマリコンストラクタを呼び出さずにインスタンスを生成できる</li>
</ul>
<p>こちらも読みながらなるほどと納得しました。特に私の場合でも、Service層のDTOとController層のResponseなどのオブジェクト間のマッピングではfactory functionを導入してコードを再使用性を高められたと思っていたので、良い判断だったなと今は思っています。</p>
<p>他に、factory functionを作る方法としても以下のようなものが提示されてありました。一般的にはcompanion object内に定義しておくことが多いかと思いますが、他の方法も必要であれば考慮したいものですね。</p>
<ol>
<li>companion object</li>
<li>extension</li>
<li>top-level</li>
<li>fake constructor</li>
<li>factory class</li>
</ol>
<h2 id=最後に>最後に</h2>
<p>ざっくりなまとめとなりますが、以上が私のこの本で得られた知識への感想となります。新しい発見もあり、自分の習慣が間違ってなかったということを人の説明で補ってもらったような気にもなり、かなり興味深かったです。</p>
<p>ただやはり、Kotlinがまだ新しい言語であり、いろいろなパラダイムを吸収しているためか、<code>Effective Java</code>のようなレベルの高い作法に対する議論は少し足りてないような気がしていて、そこは多少残念に思います。まあ、こう思うようになったということ自体が、少しは自分が成長した証拠でもあるかなという生意気な想像もしてみるのですが。</p>
<p>では、また！</p>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/kotlin/>kotlin</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>Related contents</h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article class=has-image>
<a href=/posts/kotlin-reverse-groupping/>
<div class=article-image>
<img src=/../../images/kotlin.jpg loading=lazy data-key data-hash=/../../images/kotlin.jpg>
</div>
<div class=article-details>
<h2 class=article-title>Kotlinでデータの逆転グルーピング</h2>
</div>
</a>
</article>
<article class=has-image>
<a href=/posts/kotlin-japanese-era/>
<div class=article-image>
<img src=/../../images/kotlin.jpg loading=lazy data-key data-hash=/../../images/kotlin.jpg>
</div>
<div class=article-details>
<h2 class=article-title>Kotlinで和暦を使う</h2>
</div>
</a>
</article>
<article class=has-image>
<a href=/posts/kotlin-hidden-cost-3/>
<div class=article-image>
<img src=/../../images/kotlin.jpg loading=lazy data-key data-hash=/../../images/kotlin.jpg>
</div>
<div class=article-details>
<h2 class=article-title>Kotlinの隠されたコストーその３</h2>
</div>
</a>
</article>
<article class=has-image>
<a href=/posts/kotlin-hidden-cost-2/>
<div class=article-image>
<img src=/../../images/kotlin.jpg loading=lazy data-key data-hash=/../../images/kotlin.jpg>
</div>
<div class=article-details>
<h2 class=article-title>Kotlinの隠されたコストーその２</h2>
</div>
</a>
</article>
<article class=has-image>
<a href=/posts/kotlin-hidden-cost-1/>
<div class=article-image>
<img src=/../../images/kotlin.jpg loading=lazy data-key data-hash=/../../images/kotlin.jpg>
</div>
<div class=article-details>
<h2 class=article-title>Kotlinの隠されたコストーその１</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<footer class=site-footer>
<section class=copyright>
&copy;
2019 -
2022 Korean-man in Tokyo
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.7.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">Table of contents</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#全体的な印象>全体的な印象</a></li>
<li><a href=#興味深い>興味深い</a>
<ol>
<li><a href=#single-responsibility-principle>Single responsibility principle</a></li>
<li><a href=#consider-defining-a-dsl-for-complex-object-creation>Consider defining a DSL for complex object creation</a></li>
</ol>
</li>
<li><a href=#まあそうだよねって思ったところ>まあそうだよねって思ったところ</a>
<ol>
<li><a href=#do-not-repeat-common-algorithms>Do not repeat common algorithms</a></li>
<li><a href=#implementing-your-own-utils>Implementing your own utils</a></li>
<li><a href=#builder-pattern>Builder pattern</a></li>
<li><a href=#consider-factory-functions-instead-of-constructors>Consider factory functions instead of constructors</a></li>
</ol>
</li>
<li><a href=#最後に>最後に</a></li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>