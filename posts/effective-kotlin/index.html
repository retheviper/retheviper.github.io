<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='今回は久々に本を読んだのでそれに関する感想を少し書こうと思います。転職前は主にJavaを扱っていたため、Effective Javaを読み自分の書いたコードを振り返って見たことがありました。転職後はKotlinという違う言語を触るようになったものの、やはりJVMで動く言語であり、現在使っているフレームワークもSpringから変わってないので基本的には同じ観点でコードを作成すると良いのかなと思っていました。しかし、Kotlinに触れてから1年が経った今、やはり言語が違うとコードを作成するときの週間も一度は見直す必要があるのではないかと思っています。
'><title>Effective Kotlinを読む</title>
<link rel=canonical href=https://retheviper.github.io/posts/effective-kotlin/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property='og:title' content='Effective Kotlinを読む'><meta property='og:description' content='今回は久々に本を読んだのでそれに関する感想を少し書こうと思います。転職前は主にJavaを扱っていたため、Effective Javaを読み自分の書いたコードを振り返って見たことがありました。転職後はKotlinという違う言語を触るようになったものの、やはりJVMで動く言語であり、現在使っているフレームワークもSpringから変わってないので基本的には同じ観点でコードを作成すると良いのかなと思っていました。しかし、Kotlinに触れてから1年が経った今、やはり言語が違うとコードを作成するときの週間も一度は見直す必要があるのではないかと思っています。
'><meta property='og:url' content='https://retheviper.github.io/posts/effective-kotlin/'><meta property='og:site_name' content='Korean-man in Tokyo'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='kotlin'><meta property='article:tag' content='java'><meta property='article:tag' content='design pattern'><meta property='article:published_time' content='2022-02-20T00:00:00+00:00'><meta property='article:modified_time' content='2022-02-20T00:00:00+00:00'><meta property='og:image' content='https://retheviper.github.io/images/kotlin.webp'><meta name=twitter:title content="Effective Kotlinを読む"><meta name=twitter:description content="今回は久々に本を読んだのでそれに関する感想を少し書こうと思います。転職前は主にJavaを扱っていたため、Effective Javaを読み自分の書いたコードを振り返って見たことがありました。転職後はKotlinという違う言語を触るようになったものの、やはりJVMで動く言語であり、現在使っているフレームワークもSpringから変わってないので基本的には同じ観点でコードを作成すると良いのかなと思っていました。しかし、Kotlinに触れてから1年が経った今、やはり言語が違うとコードを作成するときの週間も一度は見直す必要があるのではないかと思っています。
"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://retheviper.github.io/images/kotlin.webp'><link rel="shortcut icon" href=/favicon.ico><link rel=icon href=/favicon/favicon.ico><link rel=mask-icon href=safari-pinned-tab.svg color=black><link rel=manifest href=/favicon/manifest.json><script async src="https://www.googletagmanager.com/gtag/js?id=G-BYJBEJB6DX"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BYJBEJB6DX")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu5847319893060935988.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>👋</span></figure><div class=site-meta><h1 class=site-name><a href=/>Korean-man in Tokyo</a></h1><h2 class=site-description>一人前になりたいです</h2></div></header><ol class=social-menu><li><a href=https://www.credly.com/users/youngbin-kim.6d7122f1/badges target=_blank title=Certificates rel=me><svg class="icon icon-tabler icon-tabler-certificate" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="15" cy="15" r="3"/><path d="M13 17.5V22l2-1.5 2 1.5v-4.5"/><path d="M10 19H5a2 2 0 01-2-2V7c0-1.1.9-2 2-2h14a2 2 0 012 2v10a2 2 0 01-1 1.73"/><line x1="6" y1="9" x2="18" y2="9"/><line x1="6" y1="12" x2="9" y2="12"/><line x1="6" y1="15" x2="8" y2="15"/></svg></a></li><li><a href=https://github.com/retheviper target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/%E8%8B%B1%E6%96%8C-%E9%87%91-6736ba194/ target=_blank title=LinkedIn rel=me><svg class="icon icon-tabler icon-tabler-brand-linkedin" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="2"/><line x1="8" y1="11" x2="8" y2="16"/><line x1="8" y1="8" x2="8" y2="8.01"/><line x1="12" y1="16" x2="12" y2="11"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://retheviper.github.io/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://retheviper.github.io/ selected></option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#全体的な印象>全体的な印象</a></li><li><a href=#興味深い>興味深い</a><ol><li><a href=#single-responsibility-principle>Single responsibility principle</a></li><li><a href=#consider-defining-a-dsl-for-complex-object-creation>Consider defining a DSL for complex object creation</a></li></ol></li><li><a href=#まあそうだよねって思ったところ>まあそうだよねって思ったところ</a><ol><li><a href=#do-not-repeat-common-algorithms>Do not repeat common algorithms</a></li><li><a href=#implementing-your-own-utils>Implementing your own utils</a></li><li><a href=#builder-pattern>Builder pattern</a></li><li><a href=#consider-factory-functions-instead-of-constructors>Consider factory functions instead of constructors</a><ol><li><a href=#companion-object>companion object</a></li><li><a href=#extension>extension</a></li><li><a href=#top-level>top-level</a></li><li><a href=#fake-constructor>fake constructor</a></li><li><a href=#factory-class>factory class</a></li></ol></li></ol></li><li><a href=#最後に>最後に</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/effective-kotlin/><img src=/images/kotlin.webp loading=lazy alt="Featured image of post Effective Kotlinを読む"></a></div><div class=article-details><header class=article-category><a href=/categories/kotlin/ style=background-color:#2a9d8f;color:#fff>kotlin</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/effective-kotlin/>Effective Kotlinを読む</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Feb 20, 2022</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>14 minute read</time></div></footer></div></header><section class=article-content><p>今回は久々に本を読んだのでそれに関する感想を少し書こうと思います。転職前は主にJavaを扱っていたため、<a class=link href="https://www.amazon.co.jp/Effective-Java-%E7%AC%AC3%E7%89%88-%E3%82%B8%E3%83%A7%E3%82%B7%E3%83%A5%E3%82%A2%E3%83%BB%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF-ebook/dp/B099922DML/ref=sr_1_1?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&amp;crid=1OT3QRYCGG9BB&amp;keywords=Effective+Java&amp;qid=1645265607&amp;sprefix=effective+kotlin%2Caps%2C753&amp;sr=8-1" target=_blank rel=noopener>Effective Java</a>を読み自分の書いたコードを振り返って見たことがありました。転職後はKotlinという違う言語を触るようになったものの、やはりJVMで動く言語であり、現在使っているフレームワークもSpringから変わってないので基本的には同じ観点でコードを作成すると良いのかなと思っていました。しかし、Kotlinに触れてから1年が経った今、やはり言語が違うとコードを作成するときの週間も一度は見直す必要があるのではないかと思っています。</p><p>そこで、ちょうど<a class=link href="https://www.amazon.co.jp/Effective-Kotlin-Best-practices-English-ebook/dp/B08WXCRVD2/ref=sr_1_1?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&amp;crid=2HVT6TZYJL65A&amp;keywords=effective+kotlin&amp;qid=1645264802&amp;sprefix=effective+kotli%2Caps%2C230&amp;sr=8-1" target=_blank rel=noopener>Effective Kotlin</a>という本を発見したので早速読んでみました。そして今回のポストではその内容について色々と書こうと思います。</p><p>ちなみに、この本自体は出版されて少し経つので、ネット上でもたまにその内容やPDFの資料などを発見することあができました。例えば、この本で「可読性」のチャプタに関しての話は[こちらのブログ]の方によく整理されてあるので、参考にしてください。</p><h2 id=全体的な印象>全体的な印象</h2><p>個人的に<code>Effective Java</code>は上級者向けの本で、ある程度Javaでアプリを書いたこと経験のある人でないと理解が難しいところが多かったかなと思います。例えば、「<code>try-finally</code>を
<code>try-with-resource</code>に代替した方がいい」とか、「<code>Stream</code>で副作用のない関数を書く方法」などが紹介されていますが、これらはやはりある程度Javaという言語の設計と仕様に対する基盤知識を必要とするものですね。</p><p>それに比べ、<code>Effective Kotlin</code>には初心者向けの内容も結構あります。例えば、そもそものオブジェクト志向が何かのような内容がありました。ただそれだけではどう思っても<code>Effective Java</code>を意識したような題名が意味をなくすと判断したからか（前書きでも<code>Effective Java</code>を言及しています）他には「ベストプラクティス」として書かれているものも多いです。</p><p>そして当たり前ながら、Kotlinにおいても有効なことは<code>Effective Java</code>と重なっているような部分もあります。例えば、オブジェクトのインスタンスを作るときはfactory methodを書いた方が良いとかがそうですね。</p><p>ただ、Kotlinのバージョンアップの速さに追いついてないと感じるところがあったり（これは出版物の限界でもありますが）、上級者向けの内容は多少十分ではない感覚でしたので、どちらかというとジュニア向けの感覚ではあります。</p><h2 id=興味深い>興味深い</h2><p>ジュニア向けといいつつ、自分もまだジュニア（の気持ち）であるため、興味深いと思ったところもありました。ここでその一部を紹介したいと思います。</p><h3 id=single-responsibility-principle>Single responsibility principle</h3><p>いわゆる<a class=link href=https://ja.wikipedia.org/wiki/SOLID target=_blank rel=noopener>SOLID</a>に触れるパートです。Kotlinでは拡張関数を用いることで、単一責任の原則を守れるという主張をしていました。まず以下のようなケースがあるとしましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Student</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>isPassing</span>(): Boolean = 
</span></span><span style=display:flex><span>        calculatePointsFromPassedCourses() &gt; <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>qualifiesForScholarship</span>(): Boolean = 
</span></span><span style=display:flex><span>        calculatePointsFromPassedCourses() &gt; <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>calculatePointsFromPassedCourses</span>(): Int {
</span></span><span style=display:flex><span>        <span style=color:#75715e>//...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ここで<code>isPassing()</code>は<code>accreditations</code>というモジュールで、<code>qualifiesForScholarship()</code>は<code>scholarship</code>というモジュールで使われるとします。そしたら、<code>Student</code>というクラスがこれらの関数を持つのは単一責任としてどうか、ということですね。</p><p>なので、モジュール別にこれらの関数を拡張関数として定義することが良いとのことでした。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// scholarship module
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>Student</span>.qualifiesForScholarship(): Boolean {
</span></span><span style=display:flex><span>    <span style=color:#75715e>/*...*/</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// accreditations module
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>Student</span>.calculatePointsFromPassedCourses(): Boolean {
</span></span><span style=display:flex><span>    <span style=color:#75715e>/*...*/</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>もしくは<code>calculatePointsFromPassedCourses()</code>を外に出す方法を考えられるでしょう。しかし、この場合はこれらの二つのメソッド専用のprivateメソッドとしてつかえません。なので、</p><ol><li>どのモジュールでも使える共通関数を作っておく</li><li>department別にhelper関数を作っておく</li></ol><p>とかの方法も考えられます。</p><p>確かに、よく考えると拡張関数の良いところは「interfaceの実装ややスーパークラスの継承なし」でも簡単に処理を追加できるということなので、このような使い方をするのがユースケース別に処理を分けられて良さげな気がします。特に拡張関数を使うと、関数を配置するパッケージと可視性の制御が効くというところが個人的には新しい発見でした。</p><h3 id=consider-defining-a-dsl-for-complex-object-creation>Consider defining a DSL for complex object creation</h3><p>オブジェクトの作成時の複雑な処理はDSLを使いましょう、というパートです。Kotlinですでに提供している例としたら、HTMLがありますね。以下のような形で定義することになります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>body {
</span></span><span style=display:flex><span>    div {
</span></span><span style=display:flex><span>        a(<span style=color:#e6db74>&#34;https://kotlinlang.org&#34;</span>) {
</span></span><span style=display:flex><span>            target = <span style=color:#a6e22e>ATarget</span>.blank
</span></span><span style=display:flex><span>            +<span style=color:#e6db74>&#34;google&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    +<span style=color:#e6db74>&#34;Some content&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>確かにKtorのようなフレームワークでもよく使われている物なので、ある程度需要はあるのかなという気がしました。Kotlinだと高階関数を作るのが難しくはないので、十分挑戦できるところでもありますね。</p><p>ただ、DSL特有の書き方を確立し、その書き方をエンジニアに共有することや最初の設計と維持管理が難しそうな気がするので、アプリの縮小が求められる今のご時世に果たして合うかとうかは少し疑問ののころところでした。</p><p>個人的に何かのライブラリやフレームワークを作るとしたら、挑戦してみたいなと思いました。</p><h2 id=まあそうだよねって思ったところ>まあそうだよねって思ったところ</h2><p>なんとなくそうではないかと思っていたところを（もしくはどこかで聞いて理論的な部分は忘れたけど、無意識的のうちに習慣化されていた部分を）文として親切に整理してくれているようなパートもありました。なのでもう一度自分の考えを再確認できたといえるところでしょうか。</p><h3 id=do-not-repeat-common-algorithms>Do not repeat common algorithms</h3><p>「スタンダードライブラリで解決できる一般的なアルゴリズムを自前のコードで書くな」というパートです。理由は以下の通りです。</p><ol><li>呼び出しの方がコードを書くより時間が短くかかる</li><li>わかりやすい名前になっている</li><li>コードがわかりやすくなる</li><li>最適化が効く</li></ol><p>私自身もなるべくスタンダートライブラリを活用した方が良いと思っていたので、ここはすぐに納得できました。自分で書いた処理が果たして最適化されたものかどうかもわからないし、業務使用以外のロジックを触るのは避けたいという理由でした。</p><p>この本では、以下のようなコードを上げています。自前のロジックを書いた場合です。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> percent = <span style=color:#66d9ef>when</span> {
</span></span><span style=display:flex><span>    number &gt; <span style=color:#ae81ff>100</span> <span style=color:#f92672>-&gt;</span> <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>    number &lt; <span style=color:#ae81ff>0</span> <span style=color:#f92672>-&gt;</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> <span style=color:#f92672>-&gt;</span> number
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>上記のコードは、<a class=link href=https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.ranges/coerce-in.html target=_blank rel=noopener>coerceIn()</a>を使うことでシンプルにできます。以下がその例です。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> percent = number.coerceIn(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>100</span>)
</span></span></code></pre></div><p>Kotlinには特にスタンダードラリブラリに良い関数が多いので、自前のロジックを書くよりは一度どんなAPIがあるのかを確認した方が良いケースが個人的には多かった気がします。そしてそれが納得できる理由が書いてあってよかったと思います。</p><h3 id=implementing-your-own-utils>Implementing your own utils</h3><p>スタンダードライブラリで解消できる問題以外で、プロジェクトに必要な共通の処理はユーティリティ関数として作っておきましょうってパートです。ユーティリティはクラスでなく、拡張関数として作ったら以下のようなメリットがあるらしいです。</p><ul><li>関数は状態を持たないので副作用がない</li><li>トップレベル関数と比べると型が決まっているので使い勝手がいい</li><li>引数よりはクラスについた形が直観的</li><li>オブジェクトに関数をまとめるより必要な機能を探しやすい</li><li>特定のクラスに従属されるので親クラスのものか、子クラスのものか悩まない</li></ul><p>確かにJavaを使っていた時は、私もいわゆるSingleton Patternでユーティリティクラスを作ったり、DIして使えるクラスを定義しておいて、staticメソッドを書いていました。Kotlinだと、ユーティリティクラスなしでも特定のクラスに関数を追加することができるのでより使い勝手がよくなります。</p><p>例えば、同じことをするとしても、拡張関数で書く場合とユーティリティクラスを作る場合のコードは以下のような違いがあります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// 拡張関数を使う場合
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> isEmptyByExtension = <span style=color:#e6db74>&#34;Text&#34;</span>.isEmpty()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ユーティリティクラスを使う場合
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> isEmptyByUtilClass = <span style=color:#a6e22e>TextUtils</span>.isEmpty(<span style=color:#e6db74>&#34;Text&#34;</span>)
</span></span></code></pre></div><p>ユーティリティクラスを使う場合はまず、「どのユーティリティクラスの関数を使うか」を考えなければならないです。それに比べ、拡張関数はIDEでも自動補完ですぐ欲しい関数を見つけることができるので、より直観的なものになっていますね。</p><p>他にも具体的なクラスにのみ追加ができたりするので、より安全な使い方ができるというのも良いところですね。色々と拡張関数は使い道が多いなという、再発見ができたと言えるところでしょうか。</p><h3 id=builder-pattern>Builder pattern</h3><p>Kotlinでは<a class=link href=https://kotlinlang.org/docs/functions.html#named-arguments target=_blank rel=noopener>named arguments</a>が使えて、Builderパターンがいらないというパートです。KotlinでもBuilderパターンを使うことが技術的に不可能ではないが、named parameterを使った方が良い理由としては以下が挙げられています。</p><ul><li>より短い</li><li>より綺麗</li><li>使い方がシンプル</li><li>スレッドセーフ</li></ul><p>私自身も、Javaで使っていたのでKotlinでもBuilderパターンが必要かなと思ったことがありますが、いらないという結論を出しています。上記で挙げた理由ももちろん妥当ですが、Builderパターンだとインスタンスを生成するときに必須パラメータが揃っているかどうかを判断するのが難しくなるという理由からでした。</p><p>例えば本に出てくるBuilderパターンの例があるとしましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Pizza</span> <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>constructor</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> size: String,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> cheese: Int,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> olives: Int,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> bacon: Int
</span></span><span style=display:flex><span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Builder</span>(<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> size: String) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> cheese: Int = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> olives: Int = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> bacon: Int = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>setCheese</span>(<span style=color:#66d9ef>value</span>: Int): Builder = apply { cheese = <span style=color:#66d9ef>value</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>setOlives</span>(<span style=color:#66d9ef>value</span>: Int): Builder = apply { olives = <span style=color:#66d9ef>value</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>setBacon</span>(<span style=color:#66d9ef>value</span>: Int): Builder = apply { bacon = <span style=color:#66d9ef>value</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>build</span>() = Pizza(size, cheese, olives, bacon)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>このBuilderは以下のような使い方ができると思います。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> villagePizza = <span style=color:#a6e22e>Pizza</span>.Builder(<span style=color:#e6db74>&#34;L&#34;</span>)
</span></span><span style=display:flex><span>        .setCheese(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        .setOlives(<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>        .setBacon(<span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>        .build()
</span></span></code></pre></div><p>しかし以下の場合でもビルドはできますね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> villagePizza = <span style=color:#a6e22e>Pizza</span>.Builder(<span style=color:#e6db74>&#34;L&#34;</span>).build()
</span></span></code></pre></div><p>もし<code>cheese</code>、<code>olives</code>、<code>bacon</code>が<code>0</code>を許容しない作りになっていると、これを修正するのは大変なことになるでしょう。もしくは、パラメータが複雑な作りのオブジェクトだったらデフォルト値を設定するか、強制null check(<code>!!</code>)などを入れるか…より複雑になるだけですね。</p><p>しかし、named parameterを使うと簡単に解決できる問題です。デフォルト値を指定しない<code>val</code>だったら、それが必須項目であるということもわかりやすいですね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> myFavorite = Pizza(
</span></span><span style=display:flex><span>            size = <span style=color:#e6db74>&#34;L&#34;</span>,
</span></span><span style=display:flex><span>            cheese = <span style=color:#ae81ff>5</span>,
</span></span><span style=display:flex><span>            olives = <span style=color:#ae81ff>5</span>,
</span></span><span style=display:flex><span>            bacon = <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>        )
</span></span></code></pre></div><h3 id=consider-factory-functions-instead-of-constructors>Consider factory functions instead of constructors</h3><p>Javaでも最近は色々とfactory functionを導入していて、簡単にimmutableなオブジェクトを作りやすくなりました。Kotlinでもコンストラクタの作成や、named parameterによるインスタンスの生成が色々と便利ではあるものの、それでもfactory functionが良いケースがあるというパートです。理由は以下の通りです。</p><ul><li>関数には名前があるので、どうやってオブジェクトが生成されるかわかる<ul><li><code>ArrayList(3)</code>よりは<code>ArrayList.withSize(3)</code>がわかりやすい</li></ul></li><li>戻り値としてサブタイプのオブジェクトを指定できる<ul><li>具体的な実装を時と場合によって違う形にすることができる</li></ul></li><li>呼び出されるたび新しいオブジェクトを作るわけではない<ul><li><code>Connections.createOrNull()</code>のようにnullを返すこともできる</li></ul></li><li>まだ存在しないオブジェクトを提供できる<ul><li>プロキシなしで動くようなオブジェクトを作るなどで応用できる</li></ul></li><li>オブジェクトの外に作ることで可視性を制御できる</li><li><code>inline</code>にできるので、<a class=link href=https://kotlinlang.org/docs/inline-functions.html#reified-type-parameters target=_blank rel=noopener>reified</a>にもできる</li><li>インスタンスを作るのが複雑なオブジェクトの手間を省く</li><li>スーパークラスやプライマリコンストラクタを呼び出さずにインスタンスを生成できる</li></ul><p>こちらも読みながらなるほどと納得しました。特に私の場合でも、Service層のDTOとController層のResponseなどのオブジェクト間のマッピングではfactory functionを導入してコードを再使用性を高められたと思っていたので、良い判断だったなと今は思っています。</p><p>他に、factory functionを作る方法としても以下のようなものが提示されてありました。一般的にはcompanion object内に定義しておくことが多いかと思いますが、他の方法も必要であれば考慮したいものですね。</p><h4 id=companion-object>companion object</h4><p>Javaのstaticメソッドのようなパターン。最もわかりやすいですね。以下のような形です。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyLinkedList</span>&lt;T&gt;(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> head: T,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> tail: MyLinkedList&lt;T&gt;?
</span></span><span style=display:flex><span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>companion</span> <span style=color:#66d9ef>object</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fun</span> &lt;<span style=color:#a6e22e>T</span>&gt; <span style=color:#a6e22e>of</span>(<span style=color:#66d9ef>vararg</span> elements: T): MyLinkedList&lt;T&gt;? {
</span></span><span style=display:flex><span>            <span style=color:#75715e>/*...*/</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Usage
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> list = <span style=color:#a6e22e>MyLinkedList</span>.of(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>)
</span></span></code></pre></div><p>factory functionは大体以下の規則を持って命名されるという説明もありました。</p><h5 id=from>from</h5><p>一つのパラメータを渡し、タイプを変える時（自分自身のインスタンスを返す）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> date: Date = <span style=color:#a6e22e>Date</span>.from(instant)
</span></span></code></pre></div><h5 id=of>of</h5><p>複数のパタメータを渡し、それを束ねたタイプに変換するとき</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> faceCards: Set&lt;Rank&gt; = <span style=color:#a6e22e>EnumSet</span>.of(JACK, QUEEN, KING)
</span></span></code></pre></div><h5 id=valueof>valueOf</h5><p><code>of</code>の冗長な形</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> prime: BigInteger = <span style=color:#a6e22e>BigInteger</span>.valueOf(<span style=color:#a6e22e>Integer</span>.MAX_VALUE)
</span></span></code></pre></div><h5 id=instance--getinstance>instance / getInstance</h5><p>Singletonのインスタンス取得（パラメータが同じだと常に同じインスタンスが帰ってくる）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> luke: StackWalker = <span style=color:#a6e22e>StackWalker</span>.getInstance(options)
</span></span></code></pre></div><h5 id=createinstance--newinstance>createInstance / newInstance</h5><p>instance / getInstanceは似ているが、常に新しいインスタンスを返す</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> newArray = <span style=color:#a6e22e>Array</span>.newInstance(classObject, arrayLen)
</span></span></code></pre></div><h5 id=gettype>getType</h5><p>instance / getInstanceと似ているが、違うタイプのインスタンスを返すとき</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> fs: FileStore = <span style=color:#a6e22e>Files</span>.getFileStore(path)
</span></span></code></pre></div><h5 id=newtype>newType</h5><p>createInstance / newInstanceに似ているが、違うタイプのインスタンスを返す時</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> br: BufferedReader = <span style=color:#a6e22e>Files</span>.newBufferedReader(path)
</span></span></code></pre></div><h4 id=extension>extension</h4><p>クラスにからのcompanion objectを定義しておいて、外部から拡張関数でfactory functionを付ける形です。元のクラスをいじらなくても良くなるし、パッケージと可視性の制御など拡張関数の持つ特徴を活用できますね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Tool</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>companion</span> <span style=color:#66d9ef>object</span> { <span style=color:#75715e>/*...*/</span> }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>Tool</span>.<span style=color:#a6e22e>Companion</span>.createBigTool( <span style=color:#75715e>/*...*/</span> ): BigTool {
</span></span><span style=display:flex><span>    <span style=color:#75715e>//...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><h4 id=top-level>top-level</h4><p>スタンダードライブラリに含まれている、<a class=link href=https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/list-of.html target=_blank rel=noopener>listOf()</a>、<a class=link href=https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/set-of.html target=_blank rel=noopener>setOf()</a>、<a class=link href=https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/map-of.html target=_blank rel=noopener>mapOf()</a>のようなものです。</p><p>よく使うタイプに関しては使い勝手がいいので便利なものの、IDEの自動補完などに現れたら混乱するケースもあるので命名は慎重にする必要がある、とのことでした。</p><h4 id=fake-constructor>fake constructor</h4><p>Pascal Caseを使って、関数をコンストラクタに見せかけるものです。Kotlinのスタンダードライブラリとしては、以下のようなものがあります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>List(<span style=color:#ae81ff>4</span>) { <span style=color:#e6db74>&#34;User</span><span style=color:#e6db74>$it</span><span style=color:#e6db74>&#34;</span> } <span style=color:#75715e>// [User0, User1, User2, User3]
</span></span></span></code></pre></div><p>これは実際は以下のような関数ですね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>inline</span> <span style=color:#66d9ef>fun</span> &lt;<span style=color:#a6e22e>T</span>&gt; <span style=color:#a6e22e>List</span>(
</span></span><span style=display:flex><span>    size: Int,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>init</span>: (index: Int) <span style=color:#f92672>-&gt;</span> T
</span></span><span style=display:flex><span>): List&lt;T&gt; = MutableList(size, <span style=color:#66d9ef>init</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>inline</span> <span style=color:#66d9ef>fun</span> &lt;<span style=color:#a6e22e>T</span>&gt; <span style=color:#a6e22e>MutableList</span>(
</span></span><span style=display:flex><span>    size: Int,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>init</span>: (index: Int) <span style=color:#f92672>-&gt;</span> T
</span></span><span style=display:flex><span>): MutableList&lt;T&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> list = ArrayList&lt;T&gt;(size)
</span></span><span style=display:flex><span>    repeat(size) { index <span style=color:#f92672>-&gt;</span> list.add(<span style=color:#66d9ef>init</span>(index)) }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> list
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>これはinterfaceに対してコンストラクタを作る必要があったり、<code>reified</code>タイプの引数が必要な時に考慮できるものらしいです。</p><p>他にもfake constructorを作る方法があります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Tree</span>&lt;T&gt; {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>companion</span> <span style=color:#66d9ef>object</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>operator</span> <span style=color:#66d9ef>fun</span> &lt;<span style=color:#a6e22e>T</span>&gt; <span style=color:#a6e22e>invoke</span>(size: Int, generator: (Int) <span style=color:#f92672>-&gt;</span> T): Tree&lt;T&gt; {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Usage
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>Tree(<span style=color:#ae81ff>10</span>) { <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$it</span><span style=color:#e6db74>&#34;</span> }
</span></span></code></pre></div><p>ただ、この場合constructor referenceではコードが複雑になる問題があるらしいですね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// Constructor
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> f: () <span style=color:#f92672>-&gt;</span> Tree = <span style=color:#f92672>::</span>Tree
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Fake Constructor
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> d: () <span style=color:#f92672>-&gt;</span> Tree = <span style=color:#f92672>::</span>Tree
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Invoke in companion object
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> g: () <span style=color:#f92672>-&gt;</span> Tree = <span style=color:#a6e22e>Tree</span>.Companion<span style=color:#f92672>::</span>invoke
</span></span></code></pre></div><p>なのでfake constructorを使うとしたら、関数として定義したほうがよさそうです。</p><h4 id=factory-class>factory class</h4><p>別途Factoryというクラスを置いてインスタンスを返すようにする方法ですね。Javaではinterfaceでそのようなことをするケースがありますが（<a class=link href=https://docs.oracle.com/javase/jp/11/docs/api/java.base/java/util/List.html#of%28E%29 target=_blank rel=noopener>List.of()</a>みたいな）、Kotlinでも良いのか？という疑問が湧きました。結論から言いますと、「factoryクラスは状態を持つことが可能」なため、場合によっては考慮しても良いとのことです。これは思ったより活用できそうな可能性がありますね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Student</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> id: Int,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> name: String,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> surname: String
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StudentsFactory</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> nextId = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>next</span>(name: String, surname: String) =
</span></span><span style=display:flex><span>        Student(nextId<span style=color:#f92672>++</span>, name, surname)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>val</span> factory = StudentsFactory()
</span></span><span style=display:flex><span><span style=color:#66d9ef>val</span> s1 = factory.next(<span style=color:#e6db74>&#34;Marcin&#34;</span>, <span style=color:#e6db74>&#34;Moskala&#34;</span>)
</span></span><span style=display:flex><span>println(s1) <span style=color:#75715e>// Student(id=0, name=Marcin, Surname=Moskala)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> s2 = factory.next(<span style=color:#e6db74>&#34;Igor&#34;</span>, <span style=color:#e6db74>&#34;Wojda&#34;</span>)
</span></span><span style=display:flex><span>println(s2) <span style=color:#75715e>// Student(id=1, name=Igor, Surname=Wojda)
</span></span></span></code></pre></div><h2 id=最後に>最後に</h2><p>ざっくりなまとめとなりますが、以上が私のこの本で得られた知識への感想となります。新しい発見もあり、自分の習慣が間違ってなかったということを人の説明で補ってもらったような気にもなり、かなり興味深かったです。</p><p>ただやはり、Kotlinがまだ新しい言語であり、いろいろなパラダイムを吸収しているためか、<code>Effective Java</code>のようなレベルの高い作法に対する議論は少し足りてないような気がしていて、そこは多少残念に思います。まあ、こう思うようになったということ自体が、少しは自分が成長した証拠でもあるかなという生意気な想像もしてみるのですが。</p><p>では、また！</p></section><footer class=article-footer><section class=article-tags><a href=/tags/kotlin/>Kotlin</a>
<a href=/tags/java/>Java</a>
<a href=/tags/design-pattern/>Design Pattern</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/posts/kotlin-how-to-kotlin-like/><div class=article-image><img src=/images/kotlin.webp loading=lazy data-key data-hash=/images/kotlin.webp></div><div class=article-details><h2 class=article-title>Kotlinはどう書いたらいいか</h2></div></a></article><article class=has-image><a href=/posts/kotlin-write-csv/><div class=article-image><img src=/images/kotlin.webp loading=lazy data-key data-hash=/images/kotlin.webp></div><div class=article-details><h2 class=article-title>data classのListをCSVにする</h2></div></a></article><article class=has-image><a href=/posts/kotlin-prospect/><div class=article-image><img src=/images/kotlin.webp loading=lazy data-key data-hash=/images/kotlin.webp></div><div class=article-details><h2 class=article-title>Kotlinのこれからを語る</h2></div></a></article><article class=has-image><a href=/posts/kotlin-japanese-era/><div class=article-image><img src=/images/kotlin.webp loading=lazy data-key data-hash=/images/kotlin.webp></div><div class=article-details><h2 class=article-title>Kotlinで和暦を使う</h2></div></a></article><article class=has-image><a href=/posts/kotlin-hidden-cost-3/><div class=article-image><img src=/images/kotlin.webp loading=lazy data-key data-hash=/images/kotlin.webp></div><div class=article-details><h2 class=article-title>Kotlinの隠されたコストーその３</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2019 -
2024 Korean-man in Tokyo</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.20.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>