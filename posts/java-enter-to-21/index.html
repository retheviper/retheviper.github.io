<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='Java 17ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã‹ã‚‰ç´„2å¹´ã€ä»Šæœˆã«ã¯Java 21ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã™ã€‚ã¾ã æ¡ˆä»¶ã«ã‚ˆã£ã¦ã¯1.7ãªã©å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã‚‚å¤šã„ã¨'><title>Java 21ã¯ä½•ãŒå¤‰ã‚ã£ãŸã‹</title>
<link rel=canonical href=https://retheviper.github.io/posts/java-enter-to-21/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property='og:title' content='Java 21ã¯ä½•ãŒå¤‰ã‚ã£ãŸã‹'><meta property='og:description' content='Java 17ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã‹ã‚‰ç´„2å¹´ã€ä»Šæœˆã«ã¯Java 21ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã™ã€‚ã¾ã æ¡ˆä»¶ã«ã‚ˆã£ã¦ã¯1.7ãªã©å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã‚‚å¤šã„ã¨'><meta property='og:url' content='https://retheviper.github.io/posts/java-enter-to-21/'><meta property='og:site_name' content='Korean-man in Tokyo'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='java'><meta property='article:tag' content='kotlin'><meta property='article:published_time' content='2023-09-18T00:00:00+00:00'><meta property='article:modified_time' content='2023-09-18T00:00:00+00:00'><meta property='og:image' content='https://retheviper.github.io/images/java.jpg'><meta name=twitter:title content="Java 21ã¯ä½•ãŒå¤‰ã‚ã£ãŸã‹"><meta name=twitter:description content="Java 17ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã‹ã‚‰ç´„2å¹´ã€ä»Šæœˆã«ã¯Java 21ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã™ã€‚ã¾ã æ¡ˆä»¶ã«ã‚ˆã£ã¦ã¯1.7ãªã©å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã‚‚å¤šã„ã¨"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://retheviper.github.io/images/java.jpg'><link rel="shortcut icon" href=/favicon.ico><link rel=icon href=/favicon/favicon.ico><link rel=mask-icon href=safari-pinned-tab.svg color=black><link rel=manifest href=/favicon/manifest.json><script async src="https://www.googletagmanager.com/gtag/js?id=G-BYJBEJB6DX"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BYJBEJB6DX")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu768313a802c015f07dded3abd3d4245d_264018_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ‘‹</span></figure><div class=site-meta><h1 class=site-name><a href=/>Korean-man in Tokyo</a></h1><h2 class=site-description>ä¸€äººå‰ã«ãªã‚ŠãŸã„ã§ã™</h2></div></header><ol class=social-menu><li><a href=https://www.credly.com/users/youngbin-kim.6d7122f1/badges target=_blank title=Certificates rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-certificate" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="15" cy="15" r="3"/><path d="M13 17.5V22l2-1.5 2 1.5v-4.5"/><path d="M10 19H5a2 2 0 01-2-2V7c0-1.1.9-2 2-2h14a2 2 0 012 2v10a2 2 0 01-1 1.73"/><line x1="6" y1="9" x2="18" y2="9"/><line x1="6" y1="12" x2="9" y2="12"/><line x1="6" y1="15" x2="8" y2="15"/></svg></a></li><li><a href=https://github.com/retheviper target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/%E8%8B%B1%E6%96%8C-%E9%87%91-6736ba194/ target=_blank title=LinkedIn rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="2"/><line x1="8" y1="11" x2="8" y2="16"/><line x1="8" y1="8" x2="8" y2="8.01"/><line x1="12" y1="16" x2="12" y2="11"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://retheviper.github.io/index.xml target=_blank title=RSS rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://retheviper.github.io/ selected></option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#è¨€èªã‚¹ãƒšãƒƒã‚¯>è¨€èªã‚¹ãƒšãƒƒã‚¯</a><ol><li><a href=#string-templates-preview>String Templates (Preview)</a></li><li><a href=#sequenced-collections>Sequenced Collections</a></li><li><a href=#generational-zgc>Generational ZGC</a></li><li><a href=#record-patterns>Record Patterns</a></li><li><a href=#pattern-matching-for-switch>Pattern Matching for switch</a></li><li><a href=#foreign-fuctions-and-memory-access-api-third-preview>Foreign Fuctions and Memory Access API (Third Preview)</a></li><li><a href=#unnamed-patterns-and-variables-preview>Unnamed Patterns and Variables (Preview)</a></li><li><a href=#virtual-threads>Virtual threads</a></li><li><a href=#unnamed-classes-and-instance-main-methods-preview>Unnamed Classes and Instance Main Methods (Preview)</a></li><li><a href=#scoped-values-preview>Scoped Values (Preview)</a></li><li><a href=#vector-api-sixth-incubator>Vector API (Sixth Incubator)</a></li><li><a href=#deprecate-the-windows-32-bit-x86-port-for-removal>Deprecate the Windows 32-bit x86 Port for Removal</a></li><li><a href=#prepare-to-disallow-the-dynamic-loading-of-agents>Prepare to Disallow the Dynamic Loading of Agents</a></li><li><a href=#key-encapsulation-mechanism-api>Key Encapsulation Mechanism API</a></li><li><a href=#structured-concurrency-preview>Structured Concurrency (Preview)</a></li></ol></li><li><a href=#api>API</a></li><li><a href=#æœ€å¾Œã«>æœ€å¾Œã«</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/java-enter-to-21/><img src=/images/java.jpg loading=lazy alt="Featured image of post Java 21ã¯ä½•ãŒå¤‰ã‚ã£ãŸã‹"></a></div><div class=article-details><header class=article-category><a href=/categories/java/ style=background-color:#2a9d8f;color:#fff>java</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/java-enter-to-21/>Java 21ã¯ä½•ãŒå¤‰ã‚ã£ãŸã‹</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Sep 18, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>16 minute read</time></div></footer></div></header><section class=article-content><p>Java 17ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã‹ã‚‰ç´„2å¹´ã€ä»Šæœˆã«ã¯Java 21ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã™ã€‚ã¾ã æ¡ˆä»¶ã«ã‚ˆã£ã¦ã¯1.7ãªã©å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã‚‚å¤šã„ã¨æ€ã„ã¾ã™ãŒã€21ã¯æ–°ã—ã„LTSãªã®ã§ã€ä»Šå¾Œæ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å§‹ã‚ã‚‹ã¨ãã¯æ¡ç”¨ã‚’æ¤œè¨ã™ã‚‹ã®ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ãã“ã§ä»Šå›ã¯Java 21ã§ä½•ãŒå¤‰ã‚ã£ãŸã®ã‹ã‚’ã–ã£ãã‚Šã¨ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚</p><p>ä»Šå›ã®è¨˜äº‹ã¯Java 17ã‹ã‚‰ã®å¤‰åŒ–ã«ã¤ã„ã¦è¿°ã¹ã¦ã„ã‚‹ã®ã§ã€Java 11ã‹ã‚‰17ã¾ã§ã®å¤‰åŒ–ã«ã¤ã„ã¦ã¯<a class=link href=../java-enter-to-17/>å‰å›ã®ãƒã‚¹ãƒˆ</a>ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p><h2 id=è¨€èªã‚¹ãƒšãƒƒã‚¯>è¨€èªã‚¹ãƒšãƒƒã‚¯</h2><h3 id=string-templates-preview>String Templates (Preview)</h3><p>Kotlinã®ã‚ˆã†ãªè¨€èªã«ã¯ã„ã‚ã‚†ã‚‹String Interpolationã¨ã„ã†æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯æ–‡å­—åˆ—ã®ä¸­ã«å¤‰æ•°ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã¨ãŒã§ãã‚‹æ©Ÿèƒ½ã§ã™ã­ã€‚ä¾‹ãˆã°xã¨yã¨ã„ã†å¤‰æ•°ãŒã‚ã£ãŸã¨ã—ã¦ã€ãã‚Œã‚’Stringã«åŸ‹ã‚è¾¼ã‚€ã¨ãã«Kotlinã ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> s = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$x</span><span style=color:#e6db74> plus </span><span style=color:#e6db74>$y</span><span style=color:#e6db74> equals </span><span style=color:#e6db74>${x + y}</span><span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>ã“ã‚Œã‚’Javaã§å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã“ã¨ã«ãªã‚Šã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// String concatenation</span>
</span></span><span style=display:flex><span>String s <span style=color:#f92672>=</span> x <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; plus &#34;</span> <span style=color:#f92672>+</span> y <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; equals &#34;</span> <span style=color:#f92672>+</span> (x <span style=color:#f92672>+</span> y);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// StringBuilder</span>
</span></span><span style=display:flex><span>String s <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> StringBuilder()
</span></span><span style=display:flex><span>                 .<span style=color:#a6e22e>append</span>(x)
</span></span><span style=display:flex><span>                 .<span style=color:#a6e22e>append</span>(<span style=color:#e6db74>&#34; plus &#34;</span>)
</span></span><span style=display:flex><span>                 .<span style=color:#a6e22e>append</span>(y)
</span></span><span style=display:flex><span>                 .<span style=color:#a6e22e>append</span>(<span style=color:#e6db74>&#34; equals &#34;</span>)
</span></span><span style=display:flex><span>                 .<span style=color:#a6e22e>append</span>(x <span style=color:#f92672>+</span> y)
</span></span><span style=display:flex><span>                 .<span style=color:#a6e22e>toString</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// String.format</span>
</span></span><span style=display:flex><span>String s <span style=color:#f92672>=</span> String.<span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#34;%2$d plus %1$d equals %3$d&#34;</span>, x, y, x <span style=color:#f92672>+</span> y);
</span></span><span style=display:flex><span>String t <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;%2$d plus %1$d equals %3$d&#34;</span>.<span style=color:#a6e22e>formatted</span>(x, y, x <span style=color:#f92672>+</span> y);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// MessageFormat</span>
</span></span><span style=display:flex><span>MessageFormat mf <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MessageFormat(<span style=color:#e6db74>&#34;{0} plus {1} equals {2}&#34;</span>);
</span></span><span style=display:flex><span>String s <span style=color:#f92672>=</span> mf.<span style=color:#a6e22e>format</span>(x, y, x <span style=color:#f92672>+</span> y);
</span></span></code></pre></div><p>ã“ã‚Œã‚‰ã®æ–¹æ³•ã¯ã©ã‚Œã‚‚å†—é•·ã§ã€å¯èª­æ€§ãŒä½ã„ã§ã™ã€‚ãã“ã§Java 21ã§ã¯String Templatesã¨ã„ã†æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã¯æ–‡å­—åˆ—ã®ä¸­ã«å¤‰æ•°ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã¨ãŒã§ãã‚‹æ©Ÿèƒ½ã§ã™ã€‚ãªã®ã§ã€Javaã§ã‚‚ã‚‚ã£ã¨ç°¡å˜ãªæ–¹æ³•ã§Stringã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</p><p>ãŸã ã€String Interpolationã«ã¯SQL Injectionã®ã‚ˆã†ãªå•é¡ŒãŒã‚ã‚‹ã®ã§ã€Javaã§ã¯åˆ¥ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å–ã‚Šã¾ã—ãŸã€‚ã“ã‚Œã¯æ–‡å­—åˆ—ã®ä¸­ã«å¤‰æ•°ã‚’åŸ‹ã‚è¾¼ã‚€ã®ã§ã¯ãªãã€æ–‡å­—åˆ—ã®ä¸­ã«å¤‰æ•°ã‚’åŸ‹ã‚è¾¼ã‚€ãŸã‚ã®<a class=link href=https://download.java.net/java/early_access/jdk21/docs/api/java.base/java/lang/StringTemplate.html target=_blank rel=noopener>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</a>ã‚’ã¾ãšä½œæˆã—ã¦ã€ãã‚Œã‚’ä½¿ã£ã¦æ–‡å­—åˆ—ã‚’ä½œæˆã™ã‚‹ã¨ã„ã†æ–¹æ³•ã«ãªã£ã¦ã„ã¾ã™ã€‚ãªã®ã§ã‚³ãƒ¼ãƒ‰ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// STRã‚’ä½¿ã†å ´åˆ</span>
</span></span><span style=display:flex><span>String name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Joan&#34;</span>;
</span></span><span style=display:flex><span>String info <span style=color:#f92672>=</span> STR.<span style=color:#e6db74>&#34;My name is \{name}&#34;</span>; <span style=color:#75715e>// My name is Joan</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// RAWã‚’ä½¿ã†å ´åˆ</span>
</span></span><span style=display:flex><span>String name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Joan&#34;</span>;
</span></span><span style=display:flex><span>StringTemplate st <span style=color:#f92672>=</span> RAW.<span style=color:#e6db74>&#34;My name is \{name}&#34;</span>;
</span></span><span style=display:flex><span>String info <span style=color:#f92672>=</span> STR.<span style=color:#a6e22e>process</span>(st); <span style=color:#75715e>// My name is Joan</span>
</span></span></code></pre></div><p><a class=link href=https://download.java.net/java/early_access/jdk21/docs/api/java.base/java/lang/StringTemplate.html#STR target=_blank rel=noopener>STR</a>ã‚„<a class=link href=https://download.java.net/java/early_access/jdk21/docs/api/java.base/java/lang/StringTemplate.html#RAW target=_blank rel=noopener>RAW</a>ã¯StringTemplateã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ã¾ãšä½œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ãŒã€ã“ã®StringTemplateã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã¯fragmentsã¨ã„ã†ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨valuesã¨ã„ã†é…åˆ—ãŒã‚ã‚Šã¾ã™ã€‚fragmentsã¯æ–‡å­—åˆ—ã®ä¸­ã«å¤‰æ•°ãŒã‚ã‚‹ã¨ã“ã‚ã‚’ç©ºæ–‡å­—åˆ—ã«ç½®ãæ›ãˆãŸã‚‚ã®ã®é…åˆ—ã§ã€valuesã¯å¤‰æ•°ã®å€¤ã®é…åˆ—ã§ã™ã€‚ãªã®ã§ã€å¤‰æ•°ã‚’åŸ‹ã‚è¾¼ã‚“ã çµæœã®æ–‡å­—åˆ—ã ã‘ã§ãªãå®Ÿéš›ä¸ãˆã‚‰ã‚ŒãŸå¤‰æ•°ã®å€¤ã‚‚å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>int</span> x <span style=color:#f92672>=</span> 10, y <span style=color:#f92672>=</span> 20;
</span></span><span style=display:flex><span>StringTemplate st <span style=color:#f92672>=</span> RAW.<span style=color:#e6db74>&#34;\{x} plus \{y} equals \{x + y}&#34;</span>;
</span></span><span style=display:flex><span>String s <span style=color:#f92672>=</span> st.<span style=color:#a6e22e>toString</span>(); <span style=color:#75715e>// StringTemplate{ fragments = [ &#34;&#34;, &#34; plus &#34;, &#34; equals &#34;, &#34;&#34; ], values = [10, 20, 30] }</span>
</span></span></code></pre></div><p>ã¾ãŸã€StringTemplateã«ã¯Processorã¨ã„ã†InterfaceãŒã‚ã‚Šã€Functional Interfaceã¨ã—ã¦ç‹¬è‡ªã®å®Ÿè£…ã‚’ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Processor Interface</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>StringTemplate</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@FunctionalInterface</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Processor</span><span style=color:#f92672>&lt;</span>R, E <span style=color:#66d9ef>extends</span> Throwable<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        R <span style=color:#a6e22e>process</span>(StringTemplate st) <span style=color:#66d9ef>throws</span> E;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> INTER <span style=color:#f92672>=</span> StringTemplate.<span style=color:#a6e22e>Processor</span>.<span style=color:#a6e22e>of</span>(StringTemplate::interpolate);
</span></span><span style=display:flex><span>String s <span style=color:#f92672>=</span> INTER.<span style=color:#e6db74>&#34;\{x} plus \{y} equals \{x + y}&#34;</span>;
</span></span></code></pre></div><p>ã¾ã Previewãªã®ã§ã€ã“ã®ã‚ˆã†ãªä½¿ã„æ–¹ã¯ä»Šå¾Œå¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€ã‹ãªã‚Šé¢ç™½ã„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãªã®ã§ä»Šå¾Œã®å‹•å‘ã«æ³¨ç›®ã—ãŸã„æ©Ÿèƒ½ã§ã—ãŸã€‚</p><h3 id=sequenced-collections>Sequenced Collections</h3><p>Javaã®Collectionã®å ´åˆã€ç¨®é¡ã«ã‚ˆã£ã¦æœ€å¾Œã®è¦ç´ ã‚’å–ã‚‹ãŸã‚ã«ã¯è‰²ã€…æ›¸ãæ–¹ãŒå¤‰ã‚ã£ãŸã‚Šã€å†—é•·ã«ãªã£ãŸã‚Šã—ã¾ã™ã­ã€‚ä¾‹ãˆã°ã€æœ€åˆã®è¦ç´ ã¨æœ€å¾Œã®è¦ç´ ã‚’å–ã‚‹å ´åˆCollecitonã®ç¨®é¡ã«ã‚ˆã£ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// List</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> firstOnList <span style=color:#f92672>=</span> list.<span style=color:#a6e22e>get</span>(0);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> lastOnList <span style=color:#f92672>=</span> list.<span style=color:#a6e22e>get</span>(list.<span style=color:#a6e22e>size</span>() <span style=color:#f92672>-</span> 1);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Deque</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> firstOnDeque <span style=color:#f92672>=</span> deque.<span style=color:#a6e22e>getFirst</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> lastOnDeque <span style=color:#f92672>=</span> deque.<span style=color:#a6e22e>getLast</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// SortedSet</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> firstOnSortedSet <span style=color:#f92672>=</span> sortedSet.<span style=color:#a6e22e>first</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> lastOnSortedSet <span style=color:#f92672>=</span> sortedSet.<span style=color:#a6e22e>last</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// LinkedHashSet</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> firstOnLinkedHashSet <span style=color:#f92672>=</span> linkedHashSet.<span style=color:#a6e22e>iterator</span>().<span style=color:#a6e22e>next</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> lastOnLinkedHashSet <span style=color:#f92672>=</span> linkedHashSet.<span style=color:#a6e22e>stream</span>().<span style=color:#a6e22e>reduce</span>((first, second) <span style=color:#f92672>-&gt;</span> second).<span style=color:#a6e22e>orElse</span>(<span style=color:#66d9ef>null</span>);
</span></span></code></pre></div><p>ã¾ãŸã€ãƒ«ãƒ¼ãƒ—ã‚’é€†é †ã«ã™ã‚‹å ´åˆã‚‚ã‚³ãƒ¼ãƒ‰ã¯å†—é•·ã«ãªã£ãŸã‚Šã€ä½¿ã„å‹æ‰‹ãŒæ‚ªãæ„Ÿã˜ã‚‰ã‚Œã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹ã¨ã€ã‚„ã‚ã†ã¨ã—ã¦ã„ã‚‹ã“ã¨ã¯ä¸€ç·’ãªã®ã«ã€ã‚³ãƒ¼ãƒ‰ãŒå…¨ç„¶é•ã†ã¨ã„ã†ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// NavigableSet with descendingSet</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> e: navigableSet.<span style=color:#a6e22e>descendingSet</span>()) {
</span></span><span style=display:flex><span>    process(e);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Deque with reverse Iterator</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> it <span style=color:#f92672>=</span> deque.<span style=color:#a6e22e>descendingIterator</span>(); it.<span style=color:#a6e22e>hasNext</span>(); ) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> e <span style=color:#f92672>=</span> it.<span style=color:#a6e22e>next</span>();
</span></span><span style=display:flex><span>    process(e);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// List with reverse ListIterator</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> it <span style=color:#f92672>=</span> list.<span style=color:#a6e22e>listIterator</span>(list.<span style=color:#a6e22e>size</span>()); it.<span style=color:#a6e22e>hasPrevious</span>(); ) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> e <span style=color:#f92672>=</span> it.<span style=color:#a6e22e>previous</span>();
</span></span><span style=display:flex><span>    process(e);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ã¾ãŸå®Ÿè£…ã‚¯ãƒ©ã‚¹ã«ã‚ˆã£ã¦ã¯è¦ç´ ã®é †ç•ªãŒä¿æŒã•ã‚Œã‚‹Collectionã‹ã‚‰ãã†ã§ãªã„ã‚‚ã®ã«ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°LinkedHashSetã‚’Collections::unmodifiableSetã§ãƒ©ãƒƒãƒ—ã™ã‚‹ã¨ã€LinkedHashSetã®é †ç•ªãŒå¤±ã‚ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚</p><p>ãã“ã§Java 21ã§ã¯<a class=link href=https://download.java.net/java/early_access/jdk21/docs/api/java.base/java/util/SequencedCollection.html target=_blank rel=noopener>SequencedCollection</a>ãŠã‚ˆã³<a class=link href=https://download.java.net/java/early_access/jdk21/docs/api/java.base/java/util/SequencedSet.html target=_blank rel=noopener>SequencedSet</a>ã¨ã„ã†Interfaceã‚’è¿½åŠ ã—ã¦ã€ä¸Šè¨˜ã®å•é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚ã“ã‚Œã‚‰Interfaceã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã—ã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>SequencedCollection</span><span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>extends</span> Collection<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// new method</span>
</span></span><span style=display:flex><span>    SequencedCollection<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>reversed</span>();
</span></span><span style=display:flex><span>    <span style=color:#75715e>// methods promoted from Deque</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addFirst</span>(E);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addLast</span>(E);
</span></span><span style=display:flex><span>    E <span style=color:#a6e22e>getFirst</span>();
</span></span><span style=display:flex><span>    E <span style=color:#a6e22e>getLast</span>();
</span></span><span style=display:flex><span>    E <span style=color:#a6e22e>removeFirst</span>();
</span></span><span style=display:flex><span>    E <span style=color:#a6e22e>removeLast</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>SequencedSet</span><span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>extends</span> Set<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span>, SequencedCollection<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    SequencedSet<span style=color:#f92672>&lt;</span>E<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>reversed</span>();    <span style=color:#75715e>// covariant override</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ã¾ãŸMapã«ãŠã„ã¦ã‚‚<a class=link href=https://download.java.net/java/early_access/jdk21/docs/api/java.base/java/util/SequencedMap.html target=_blank rel=noopener>SequencedMap</a>ã¨ã„ã†InterfaceãŒè¿½åŠ ã•ã‚Œã¦ã„ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã—ã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>SequencedMap</span><span style=color:#f92672>&lt;</span>K,V<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>extends</span> Map<span style=color:#f92672>&lt;</span>K,V<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// new methods</span>
</span></span><span style=display:flex><span>    SequencedMap<span style=color:#f92672>&lt;</span>K,V<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>reversed</span>();
</span></span><span style=display:flex><span>    SequencedSet<span style=color:#f92672>&lt;</span>K<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>sequencedKeySet</span>();
</span></span><span style=display:flex><span>    SequencedCollection<span style=color:#f92672>&lt;</span>V<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>sequencedValues</span>();
</span></span><span style=display:flex><span>    SequencedSet<span style=color:#f92672>&lt;</span>Entry<span style=color:#f92672>&lt;</span>K,V<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>sequencedEntrySet</span>();
</span></span><span style=display:flex><span>    V <span style=color:#a6e22e>putFirst</span>(K, V);
</span></span><span style=display:flex><span>    V <span style=color:#a6e22e>putLast</span>(K, V);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// methods promoted from NavigableMap</span>
</span></span><span style=display:flex><span>    Entry<span style=color:#f92672>&lt;</span>K, V<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>firstEntry</span>();
</span></span><span style=display:flex><span>    Entry<span style=color:#f92672>&lt;</span>K, V<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>lastEntry</span>();
</span></span><span style=display:flex><span>    Entry<span style=color:#f92672>&lt;</span>K, V<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>pollFirstEntry</span>();
</span></span><span style=display:flex><span>    Entry<span style=color:#f92672>&lt;</span>K, V<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>pollLastEntry</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ã“ã‚Œã‚‰ã®æ–°ã—ã„InterfaceãŒè¿½åŠ ã•ã‚Œã‚‹ã“ã¨ã§ã€Collectionå…¨ä½“ã®ç¶™æ‰¿é–¢ä¿‚ãŒä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚</p><p><img src=/posts/java-enter-to-21/SequencedCollectionDiagram20220216.webp width=1512 height=840 srcset="/posts/java-enter-to-21/SequencedCollectionDiagram20220216_hu52eadc6c156a34b7d2f6c016bafa6cff_17846_480x0_resize_q75_h2_box_2.webp 480w, /posts/java-enter-to-21/SequencedCollectionDiagram20220216_hu52eadc6c156a34b7d2f6c016bafa6cff_17846_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt="Sequenced Collections" class=gallery-image data-flex-grow=180 data-flex-basis=432px>
<em>å‡ºå…¸ï¼šOpenJDK - <a class=link href=https://openjdk.org/jeps/431 target=_blank rel=noopener>JEP 431: Sequenced Collections</a></em></p><p>ç¶™æ‰¿é–¢ä¿‚ã«ã‚ˆã£ã¦ãƒ€ã‚¦ãƒ³ã‚­ãƒ£ã‚¹ãƒˆãŒç™ºç”Ÿã™ã‚‹å ´åˆã‚‚ã‚ã‚‹ã‹ãªã¨æ€ã„ã¾ã™ãŒã€Listã®å ´åˆã¯SequencedCollectionã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ã®ã§ãã®ã¾ã¾æ–°ã—ã„ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚</p><h3 id=generational-zgc>Generational ZGC</h3><p>ZGCã¯Java 11ã§å°å…¥ã•ã‚ŒãŸGarbage Collectorã§ã™ãŒã€Java 21ã§ã¯Generational ZGCã¨ã„ã†æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã¯ZGCã®æ€§èƒ½ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã«ã€ZGCã®ãƒ’ãƒ¼ãƒ—ã‚’Young Generationã¨Old Generationã«åˆ†ã‘ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã€Young Generationã®GCã‚’ã‚ˆã‚Šé »ç¹ã«è¡Œã†ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã€Young Generationã®GCã®æ™‚é–“ã‚’çŸ­ç¸®ã™ã‚‹ã“ã¨ãŒã§ãã€ãƒ¡ãƒ¢ãƒªã‚„CPUã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’æ¸›ã‚‰ã™ã“ã¨ãŒã§ãã‚‹ã‚‰ã—ã„ã§ã™ã€‚</p><p>Generational ZGCã‚’ä½¿ã†ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«èµ·å‹•ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>java -XX:+UseZGC -XX:+ZGenerational
</span></span></code></pre></div><p>ãŸã ã€æ–°ã—ã„GCã«é–¢ã—ã¦ã¯<a class=link href=https://openjdk.org/jeps/439 target=_blank rel=noopener>å…¬å¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ã‚’å‚ç…§ã™ã‚‹ã¨è‰²ã€…ã¨è¨­è¨ˆã‚„å®Ÿè£…ã«ã¤ã„ã¦è¿°ã¹ã¦ã„ã¾ã™ãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ç«‹å ´ã¨ã—ã¦ã¯ãã‚Œã‚’ä½¿ã£ãŸå ´åˆã®å®Ÿéš›ã®æ€§èƒ½ä¸Šã®åˆ©ç‚¹ãŒã©ã‚Œãã‚‰ã„ã‚ã‚‹ã®ã‹ãŒæ°—ã«ãªã‚‹ã¨ã“ã‚ã§ã™ã­ã€‚ãªã®ã§ã€å®Ÿéš›ã«Generational ZGCã‚’ä½¿ã£ãŸå ´åˆã®æ€§èƒ½ã«ã¤ã„ã¦ã¯<a class=link href=https://timefold.ai/blog/2023/java-21-performance/ target=_blank rel=noopener>ã“ã¡ã‚‰ã®è¨˜äº‹</a>ãŒå‚è€ƒã«ãªã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚çµè«–ã¨ã—ã¦ã¯ã¾ã ParallelGCãŒã‚‚ã£ã¨ã‚‚æ€§èƒ½ãŒè‰¯ã„ã¨ã„ã†ã“ã¨ã«ãªã£ã¦ã„ã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“ã“ã‚Œã¯ãƒã‚·ãƒ³ã‚¹ãƒšãƒƒã‚¯ï¼ˆç‰¹ã«ãƒ¡ãƒ¢ãƒªï¼‰ã«ã‚ˆã£ã¦ã‚‚å¤‰ã‚ã£ã¦ãã‚‹ã¨æ€ã†ã®ã§ã€è‡ªåˆ†ã®ç’°å¢ƒã§è©¦ã—ã¦ã¿ã‚‹ã®ãŒè‰¯ã„ã‹ã¨æ€ã„ã¾ã™ã€‚</p><h3 id=record-patterns>Record Patterns</h3><p>Java 16ã§ã¯<a class=link href=https://openjdk.org/jeps/394 target=_blank rel=noopener>Pattern Matching</a>ã¨ã„ã†æ©Ÿèƒ½ãŒå°å…¥ã•ã‚Œã€instanceOfã§å‹ãƒã‚§ãƒƒã‚¯ã‚’ã—ãŸå¾Œã«ã‚­ãƒ£ã‚¹ãƒˆã™ã‚‹ã¨ã„ã†ã‚³ãƒ¼ãƒ‰ã‚’ç°¡æ½”ã«æ›¸ãã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Prior to Java 16</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (obj <span style=color:#66d9ef>instanceof</span> String) {
</span></span><span style=display:flex><span>    String s <span style=color:#f92672>=</span> (String)obj;
</span></span><span style=display:flex><span>    ... use s ...
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// As of Java 16</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (obj <span style=color:#66d9ef>instanceof</span> String s) {
</span></span><span style=display:flex><span>    ... use s ...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Java 21ã§ã¯ã“ã®Pattern Matchingã‚’ã€åŒã˜ãJava 16ã§å°å…¥ã•ã‚ŒãŸ<a class=link href=https://openjdk.org/jeps/395 target=_blank rel=noopener>Record</a>ã«ã‚‚é©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// As of Java 16</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>record</span> <span style=color:#a6e22e>Point</span>(<span style=color:#66d9ef>int</span> x, <span style=color:#66d9ef>int</span> y) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>printSum</span>(Object obj) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (obj <span style=color:#66d9ef>instanceof</span> Point p) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> x <span style=color:#f92672>=</span> p.<span style=color:#a6e22e>x</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> y <span style=color:#f92672>=</span> p.<span style=color:#a6e22e>y</span>();
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(x<span style=color:#f92672>+</span>y);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// As of Java 21</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>printSum</span>(Object obj) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (obj <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>Point</span>(<span style=color:#66d9ef>int</span> x, <span style=color:#66d9ef>int</span> y)) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(x<span style=color:#f92672>+</span>y);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ã•ã‚‰ã«ãƒã‚¹ãƒˆã—ãŸRecordã«ã‚‚é©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚‚å¯èƒ½ã§ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>printXCoordOfUpperLeftPointWithPatterns</span>(Rectangle r) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (r <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>Rectangle</span>(ColoredPoint(Point(<span style=color:#66d9ef>var</span> x, <span style=color:#66d9ef>var</span> y), <span style=color:#66d9ef>var</span> c),
</span></span><span style=display:flex><span>                               <span style=color:#66d9ef>var</span> lr)) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Upper-left corner: &#34;</span> <span style=color:#f92672>+</span> x);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=pattern-matching-for-switch>Pattern Matching for switch</h3><p>Pattern Matchingã®æ”¹å–„ã¯switchã«ã‚‚é©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ã«ã€switchã®caseã«nullã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ããŸã‚Šã€ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ£ã‚¹ãƒˆãŒä½¿ãˆãŸã‚Šã€ã•ã‚‰ã«whenã‚’ä½¿ã£ãŸæ¡ä»¶åˆ†å²ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testStringEnhanced</span>(String response) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span> (response) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>-&gt;</span> { }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;y&#34;</span>, <span style=color:#e6db74>&#34;Y&#34;</span> <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;You got it&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;n&#34;</span>, <span style=color:#e6db74>&#34;N&#34;</span> <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Shame&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> String s
</span></span><span style=display:flex><span>        when s.<span style=color:#a6e22e>equalsIgnoreCase</span>(<span style=color:#e6db74>&#34;YES&#34;</span>) <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;You got it&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> String s
</span></span><span style=display:flex><span>        when s.<span style=color:#a6e22e>equalsIgnoreCase</span>(<span style=color:#e6db74>&#34;NO&#34;</span>) <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Shame&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> String s <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Sorry?&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ã“ã®æ”¹å–„ã¯Enumã«ã‚‚é©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>exhaustiveSwitchWithBetterEnumSupport</span>(CardClassification c) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span> (c) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> Suit.<span style=color:#a6e22e>CLUBS</span> <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;It&#39;s clubs&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> Suit.<span style=color:#a6e22e>DIAMONDS</span> <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;It&#39;s diamonds&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> Suit.<span style=color:#a6e22e>HEARTS</span> <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;It&#39;s hearts&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> Suit.<span style=color:#a6e22e>SPADES</span> <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;It&#39;s spades&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> Tarot t <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;It&#39;s a tarot&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ã¾ã primitive typeã«ã¯é©ç”¨ã•ã‚Œãªã„ã®ã§ã™ãŒã€ã“ã‚Œã¯ä»Šå¾Œæ”¹å–„ã™ã‚‹äºˆå®šã‚‰ã—ã„ã®ã§ã€ã¾ãŸæ¬¡ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§æœŸå¾…ã—ãŸã„ã¨ã“ã‚ã§ã™ã€‚</p><h3 id=foreign-fuctions-and-memory-access-api-third-preview>Foreign Fuctions and Memory Access API (Third Preview)</h3><p>Java 19ã‹ã‚‰å°å…¥ã•ã‚ŒãŸæ©Ÿèƒ½ã§ã€Java runtimeå¤–ã®ã‚³ãƒ¼ãƒ‰ã‚„ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ãªAPIãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯Java 21ã§ã¯Third Previewã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã¦ã€Javaã‹ã‚‰Cã‚„C++ã®ã‚³ãƒ¼ãƒ‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§Cã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 1. Find foreign function on the C library path</span>
</span></span><span style=display:flex><span>Linker linker          <span style=color:#f92672>=</span> Linker.<span style=color:#a6e22e>nativeLinker</span>();
</span></span><span style=display:flex><span>SymbolLookup stdlib    <span style=color:#f92672>=</span> linker.<span style=color:#a6e22e>defaultLookup</span>();
</span></span><span style=display:flex><span>MethodHandle radixsort <span style=color:#f92672>=</span> linker.<span style=color:#a6e22e>downcallHandle</span>(stdlib.<span style=color:#a6e22e>find</span>(<span style=color:#e6db74>&#34;radixsort&#34;</span>), ...);
</span></span><span style=display:flex><span><span style=color:#75715e>// 2. Allocate on-heap memory to store four strings</span>
</span></span><span style=display:flex><span>String<span style=color:#f92672>[]</span> javaStrings <span style=color:#f92672>=</span> { <span style=color:#e6db74>&#34;mouse&#34;</span>, <span style=color:#e6db74>&#34;cat&#34;</span>, <span style=color:#e6db74>&#34;dog&#34;</span>, <span style=color:#e6db74>&#34;car&#34;</span> };
</span></span><span style=display:flex><span><span style=color:#75715e>// 3. Use try-with-resources to manage the lifetime of off-heap memory</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span> (Arena offHeap <span style=color:#f92672>=</span> Arena.<span style=color:#a6e22e>ofConfined</span>()) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 4. Allocate a region of off-heap memory to store four pointers</span>
</span></span><span style=display:flex><span>    MemorySegment pointers
</span></span><span style=display:flex><span>        <span style=color:#f92672>=</span> offHeap.<span style=color:#a6e22e>allocateArray</span>(ValueLayout.<span style=color:#a6e22e>ADDRESS</span>, javaStrings.<span style=color:#a6e22e>length</span>);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 5. Copy the strings from on-heap to off-heap</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> javaStrings.<span style=color:#a6e22e>length</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        MemorySegment cString <span style=color:#f92672>=</span> offHeap.<span style=color:#a6e22e>allocateUtf8String</span>(javaStrings<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span>);
</span></span><span style=display:flex><span>        pointers.<span style=color:#a6e22e>setAtIndex</span>(ValueLayout.<span style=color:#a6e22e>ADDRESS</span>, i, cString);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 6. Sort the off-heap data by calling the foreign function</span>
</span></span><span style=display:flex><span>    radixsort.<span style=color:#a6e22e>invoke</span>(pointers, javaStrings.<span style=color:#a6e22e>length</span>, MemorySegment.<span style=color:#a6e22e>NULL</span>, <span style=color:#e6db74>&#39;\0&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 7. Copy the (reordered) strings from off-heap to on-heap</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> javaStrings.<span style=color:#a6e22e>length</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        MemorySegment cString <span style=color:#f92672>=</span> pointers.<span style=color:#a6e22e>getAtIndex</span>(ValueLayout.<span style=color:#a6e22e>ADDRESS</span>, i);
</span></span><span style=display:flex><span>        javaStrings<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> cString.<span style=color:#a6e22e>getUtf8String</span>(0);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>} <span style=color:#75715e>// 8. All off-heap memory is deallocated here</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>assert</span> Arrays.<span style=color:#a6e22e>equals</span>(javaStrings,
</span></span><span style=display:flex><span>                     <span style=color:#66d9ef>new</span> String<span style=color:#f92672>[]</span> {<span style=color:#e6db74>&#34;car&#34;</span>, <span style=color:#e6db74>&#34;cat&#34;</span>, <span style=color:#e6db74>&#34;dog&#34;</span>, <span style=color:#e6db74>&#34;mouse&#34;</span>});  <span style=color:#75715e>// true</span>
</span></span></code></pre></div><p>ä»Šã¯Javaã‚’ä½¿ã£ã¦ä»–ã®è¨€èªã§ä½œã‚‰ã‚ŒãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã™ã‚‹å ´åˆã€Wrapperã‚„Runtimeã‚’åˆ©ç”¨ã—ãŸå½¢ãŒå¤šã„ã‹ãªã¨æ€ã„ã¾ã™ãŒã€ã“ã‚Œã‚’ä½¿ã†ã“ã¨ã§ã‚ˆã‚Šç°¡å˜ã«ä»–ã®è¨€èªã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚µã‚¤ã‚ºã‚’æ¸›ã‚‰ã—ãŸã‚Šã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã‹ãªã¨æ€ã„ã¾ã™ã€‚ãŸã ã€ã¾ã Previewãªã®ã§ä»Šå¾Œå¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã¨ã€ç›´æ¥ãƒ¡ãƒ¢ãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã®ã§ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã®å¯èƒ½æ€§ãŒã‚ã‚‹ã‹ãªã¨æ€ã„ã¾ã™ã®ã§ã€ä½¿ç”¨æ™‚ã«ã¯æ³¨æ„ãŒå¿…è¦ã‹ã¨æ€ã„ã¾ã™ã€‚</p><h3 id=unnamed-patterns-and-variables-preview>Unnamed Patterns and Variables (Preview)</h3><p>å‡¦ç†ã®ä¸­ã§ä½¿ã‚ã‚Œã¦ãªã„å¤‰æ•°ã‚’<code>_</code>ã§è¡¨ç¾ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ãªã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒæ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Loop</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> acc <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (Order _ : orders) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (acc <span style=color:#f92672>&lt;</span> LIMIT) { 
</span></span><span style=display:flex><span>        ... acc<span style=color:#f92672>++</span> ...
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Multiple assignment</span>
</span></span><span style=display:flex><span>Queue<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;</span> q <span style=color:#f92672>=</span> ... <span style=color:#75715e>// x1, y1, z1, x2, y2, z2, ...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> (q.<span style=color:#a6e22e>size</span>() <span style=color:#f92672>&gt;=</span> 3) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> x <span style=color:#f92672>=</span> q.<span style=color:#a6e22e>remove</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> _ <span style=color:#f92672>=</span> q.<span style=color:#a6e22e>remove</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> _ <span style=color:#f92672>=</span> q.<span style=color:#a6e22e>remove</span>(); 
</span></span><span style=display:flex><span>    ... <span style=color:#66d9ef>new</span> Point(x, 0) ...
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Catch block</span>
</span></span><span style=display:flex><span>String s <span style=color:#f92672>=</span> ...
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span> { 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> Integer.<span style=color:#a6e22e>parseInt</span>(s);
</span></span><span style=display:flex><span>    ... i ...
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> (NumberFormatException _) { 
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Bad number: &#34;</span> <span style=color:#f92672>+</span> s);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// try-with-resources</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span> (<span style=color:#66d9ef>var</span> _ <span style=color:#f92672>=</span> ScopedContext.<span style=color:#a6e22e>acquire</span>()) {
</span></span><span style=display:flex><span>    ... no use of acquired resource ...
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Lambda</span>
</span></span><span style=display:flex><span>stream.<span style=color:#a6e22e>collect</span>(Collectors.<span style=color:#a6e22e>toMap</span>(String::toUpperCase, _ <span style=color:#f92672>-&gt;</span> <span style=color:#e6db74>&#34;NODATA&#34;</span>))
</span></span></code></pre></div><h3 id=virtual-threads>Virtual threads</h3><p>Project Loomã¨ã„ã†åã§é•·ã„é–“é–‹ç™ºã•ã‚Œã¦ã„ãŸæ©Ÿèƒ½ã§ã™ã€‚å€‹äººçš„ãªæ„è¦‹ã§ã™ãŒã€Java 21ã«ãŠã„ã¦ã‚‚ã£ã¨ã‚‚æ³¨ç›®ã•ã‚Œã¦ã„ã‚‹æ©Ÿèƒ½ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚æ—¢å­˜ã®ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ã¯ç”Ÿæˆã§ãã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ã®æ•°ã«ãŠã„ã¦ç‰©ç†çš„ãªåˆ¶ç´„ãŒã‚ã£ãŸã®ã§ã™ãŒã€ä»Šå›ã®å°å…¥ã•ã‚Œã‚‹ä»®æƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã¯ãã®OSã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ã•ã‚‰ã«ç´°ã‹ãåˆ†ã‘ã¦ä½¿ã†ã“ã¨ã«ãªã‚‹ã®ã§ã€ã‚ˆã‚Šå¤šãã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’åŒæ™‚ã«æ‰±ã†ã“ã¨ãŒã§ãã‚‹ã®ãŒç‰¹å¾´ã§ã™ã€‚</p><p>ä½¿ã„æ–¹ã¨ã—ã¦ã¯æ—¢å­˜ã®ç‰©ç†ã‚¹ãƒ¬ãƒƒãƒ‰ã¨å¤§ããå¤‰ã‚ã‚‹ã‚ã‘ã§ã¯ãªã„ã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>try</span> (<span style=color:#66d9ef>var</span> executor <span style=color:#f92672>=</span> Executors.<span style=color:#a6e22e>newVirtualThreadPerTaskExecutor</span>()) {
</span></span><span style=display:flex><span>    IntStream.<span style=color:#a6e22e>range</span>(0, 10_000).<span style=color:#a6e22e>forEach</span>(i <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>        executor.<span style=color:#a6e22e>submit</span>(() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            Thread.<span style=color:#a6e22e>sleep</span>(Duration.<span style=color:#a6e22e>ofSeconds</span>(1));
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> i;
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>}  <span style=color:#75715e>// executor.close() is called implicitly, and waits</span>
</span></span></code></pre></div><p>ä»®æƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã¯å®Ÿéš›ã®OSã®ã‚¹ãƒ¬ãƒƒãƒ‰ã«1:1å¯¾å¿œã—ãªã„ã®ã§ã€æ—¢å­˜ã®ã‚ˆã†ã«ThreadPoolã‚’ä½œæˆã—ã¦ã‚¹ãƒ¬ãƒƒãƒ‰ã®æ•°ã‚’åˆ¶é™ã™ã‚‹å¿…è¦ã¯ã»ã¨ã‚“ã©ã‚ã‚Šã¾ã›ã‚“ã€‚å…¬å¼ã§ã‚‚Poolã‚’ä½¿ã†ã“ã¨ã‚’ãŠã™ã™ã‚ã—ãªã„ã¨è¨€ã£ã¦ã„ã‚‹ãã‚‰ã„ã§ã™ã€‚</p><p>å®Ÿéš›<a class=link href=https://kt.academy/article/dispatcher-loom target=_blank rel=noopener>Kotlinã§Javaã®ä»®æƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«Dispatcherã‚’å®Ÿè£…ã—ã¦å®Ÿé¨“ã—ãŸè¨˜äº‹</a>ã«ã‚ˆã‚‹ã¨ã€30ã‚¹ãƒ¬ãƒƒãƒ‰ã®ãƒã‚·ãƒ³ã§ã‚‚100ä¸‡ã®
ä»®æƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆã—ã¦å‡¦ç†ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚JVMè¨€èªã§ä½œæˆã•ã‚ŒãŸã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å ´åˆã€å¾“æ¥ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ¢ãƒ‡ãƒ«ã§ã¯ã‚¹ãƒ¬ãƒƒãƒ‰ã®æ•°ã‚’åˆ¶é™ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã®ã§ã€ã“ã®ä»®æƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã®å°å…¥ã«ã‚ˆã£ã¦ã€ã‚ˆã‚Šå¤šãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’åŒæ™‚ã«å‡¦ç†ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã‹ãªã¨æ€ã„ã¾ã™ã€‚</p><h3 id=unnamed-classes-and-instance-main-methods-preview>Unnamed Classes and Instance Main Methods (Preview)</h3><p>é–¢æ•°ã‚’ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã«å®šç¾©ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ãªã®ã§ã€ä¼çµ±ã®Hello Worldã®ã‚µãƒ³ãƒ—ãƒ«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒæ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Prior to Java 21</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HelloWorld</span> { 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) { 
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Hello, World!&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// As of Java 21</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Hello, World!&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®é–¢æ•°ã‚„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚Unnamed Classã®ãƒ¡ãƒ³ãƒãƒ¼æ‰±ã„ã¨ãªã‚‹ã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚‚å•é¡Œãªãå‹•ãã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Method</span>
</span></span><span style=display:flex><span>String <span style=color:#a6e22e>greeting</span>() { <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Hello, World!&#34;</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(greeting());
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Field</span>
</span></span><span style=display:flex><span>String greeting <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Hello, World!&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(greeting);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ã¾ãŸã€mainé–¢æ•°ã‚’æŒã¤Unnamed Classã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>new</span> Object() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// the unnamed class&#39;s body</span>
</span></span><span style=display:flex><span>}.<span style=color:#a6e22e>main</span>();
</span></span></code></pre></div><h3 id=scoped-values-preview>Scoped Values (Preview)</h3><p>Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å ´åˆã€ä¸€ã¤ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾ã—ã¦ã¯ã‚¹ãƒ¬ãƒƒãƒ‰ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã€ä¸€è²«ã—ãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ä¸­ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã§ã™ã€‚ãŸã ã€ãã“ã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦æ‰±ã†å ´åˆã€æ—¢å­˜ã ã¨å®Ÿè¡Œã•ã‚Œã‚‹é–¢æ•°ã®å¼•æ•°ã¨ã—ã¦æ¸¡ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handle</span>(Request request, Response response, FrameworkContext context) {
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> userInfo <span style=color:#f92672>=</span> readUserInfo(context);
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> UserInfo <span style=color:#a6e22e>readUserInfo</span>(FrameworkContext context) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (UserInfo)framework.<span style=color:#a6e22e>readKey</span>(<span style=color:#e6db74>&#34;userInfo&#34;</span>, context);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ã¾ãŸã¯ã€<a class=link href=https://docs.oracle.com/en/java/javase/18/docs/api/java.base/java/lang/ThreadLocal.html target=_blank rel=noopener>ThreadLocal</a>ã‚’ä½¿ç”¨ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã“ã¨ã‚‚ã§ãã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Framework</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Application application;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Framework</span>(Application app) { <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>application</span> <span style=color:#f92672>=</span> app; }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>static</span> ThreadLocal<span style=color:#f92672>&lt;</span>FrameworkContext<span style=color:#f92672>&gt;</span> CONTEXT 
</span></span><span style=display:flex><span>                       <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ThreadLocal<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>serve</span>(Request request, Response response) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> context <span style=color:#f92672>=</span> createContext(request);
</span></span><span style=display:flex><span>        CONTEXT.<span style=color:#a6e22e>set</span>(context);
</span></span><span style=display:flex><span>        Application.<span style=color:#a6e22e>handle</span>(request, response);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> PersistedObject <span style=color:#a6e22e>readKey</span>(String key) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> context <span style=color:#f92672>=</span> CONTEXT.<span style=color:#a6e22e>get</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> db <span style=color:#f92672>=</span> getDBConnection(context);
</span></span><span style=display:flex><span>        db.<span style=color:#a6e22e>readKey</span>(key);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ã—ã‹ã—ã€ThreadLocalã‚’ä½¿ã†å ´åˆã¯è‰²ã€…ã¨å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ã¾ãšThreadLocalã®å€¤ãã®ã‚‚ã®ãŒå¤‰æ›´ã•ã‚Œã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚ãã—ã¦ä¸è¦ã«ãªã£ãŸThreadLocalã®å€¤ã‚’é©å®œå‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã‚Šã€ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒç™ºç”Ÿã™ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚</p><p>ãã“ã§Java 21ã§ã¯<a class=link href=https://download.java.net/java/early_access/jdk21/docs/api/java.base/java/lang/ScopedValue.html target=_blank rel=noopener>ScopedValue</a>ã¨ã„ã†ã‚¯ãƒ©ã‚¹ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã‚’ä½¿ã†ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¹ãƒ¬ãƒƒãƒ‰ã‚ãŸã‚Šã®å€¤ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Framework</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>static</span> ScopedValue<span style=color:#f92672>&lt;</span>FrameworkContext<span style=color:#f92672>&gt;</span> CONTEXT 
</span></span><span style=display:flex><span>                        <span style=color:#f92672>=</span> ScopedValue.<span style=color:#a6e22e>newInstance</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>serve</span>(Request request, Response response) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> context <span style=color:#f92672>=</span> createContext(request);
</span></span><span style=display:flex><span>        ScopedValue.<span style=color:#a6e22e>where</span>(CONTEXT, context)
</span></span><span style=display:flex><span>                   .<span style=color:#a6e22e>run</span>(() <span style=color:#f92672>-&gt;</span> Application.<span style=color:#a6e22e>handle</span>(request, response));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> PersistedObject <span style=color:#a6e22e>readKey</span>(String key) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> context <span style=color:#f92672>=</span> CONTEXT.<span style=color:#a6e22e>get</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> db <span style=color:#f92672>=</span> getDBConnection(context);
</span></span><span style=display:flex><span>        db.<span style=color:#a6e22e>readKey</span>(key);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ScopedVlaueã«ã¯setterãŒãªã„ã§ã™ãŒã€ã ã‹ã‚‰ã¨è¨€ã£ã¦ä»–ã®å€¤ã‚’ä¸ãˆã‚‰ã‚Œãªã„ã‚ã‘ã§ã¯ãªã„ã§ã™ã€‚ThreadLocalã¨ã¯åˆ¥ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã€ç‰¹å®šã®å€¤ã‚’æ¸¡ã—ã¦run()é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> ScopedValue<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> X <span style=color:#f92672>=</span> ScopedValue.<span style=color:#a6e22e>newInstance</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>foo</span>() {
</span></span><span style=display:flex><span>    ScopedValue.<span style=color:#a6e22e>where</span>(X, <span style=color:#e6db74>&#34;hello&#34;</span>).<span style=color:#a6e22e>run</span>(() <span style=color:#f92672>-&gt;</span> bar());
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>bar</span>() {
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(X.<span style=color:#a6e22e>get</span>()); <span style=color:#75715e>// prints hello</span>
</span></span><span style=display:flex><span>    ScopedValue.<span style=color:#a6e22e>where</span>(X, <span style=color:#e6db74>&#34;goodbye&#34;</span>).<span style=color:#a6e22e>run</span>(() <span style=color:#f92672>-&gt;</span> baz());
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(X.<span style=color:#a6e22e>get</span>()); <span style=color:#75715e>// prints hello</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>baz</span>() {
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(X.<span style=color:#a6e22e>get</span>()); <span style=color:#75715e>// prints goodbye</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ã“ã®ScopedValueã¯ã‚¹ãƒ¬ãƒƒãƒ‰ã®å®Ÿè¡Œä¸­ã«ã ã‘å€¤ãŒä¿æŒã•ã‚Œãªã„ã®ã§ã€ThreadLocalã‚ˆã‚Šå®‰å…¨ãªä½¿ã„æ–¹ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚</p><h3 id=vector-api-sixth-incubator>Vector API (Sixth Incubator)</h3><p>Java 1.0ã®æ™‚ä»£ã®é…åˆ—ã‚’æ‰±ã†<a class=link href=https://docs.oracle.com/javase/jp/8/docs/api/java/util/Vector.html target=_blank rel=noopener>Vector</a>ã¨ã¯é•ã£ã¦ã€æ•°å€¤ï¼ˆè¡Œåˆ—ï¼‰ã®è¨ˆç®—ã®ãŸã‚ã®Vector APIãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚åŸºæœ¬çš„ã«ä»¥ä¸‹ã®ã‚ˆã†ãªã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Prior to Java 21</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>scalarComputation</span>(<span style=color:#66d9ef>float</span><span style=color:#f92672>[]</span> a, <span style=color:#66d9ef>float</span><span style=color:#f92672>[]</span> b, <span style=color:#66d9ef>float</span><span style=color:#f92672>[]</span> c) {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> a.<span style=color:#a6e22e>length</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        c<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> (a<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> <span style=color:#f92672>*</span> a<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> b<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> <span style=color:#f92672>*</span> b<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span>) <span style=color:#f92672>*</span> <span style=color:#f92672>-</span>1.<span style=color:#a6e22e>0f</span>;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// As of Java 21</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> VectorSpecies<span style=color:#f92672>&lt;</span>Float<span style=color:#f92672>&gt;</span> SPECIES <span style=color:#f92672>=</span> FloatVector.<span style=color:#a6e22e>SPECIES_PREFERRED</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>vectorComputation</span>(<span style=color:#66d9ef>float</span><span style=color:#f92672>[]</span> a, <span style=color:#66d9ef>float</span><span style=color:#f92672>[]</span> b, <span style=color:#66d9ef>float</span><span style=color:#f92672>[]</span> c) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> upperBound <span style=color:#f92672>=</span> SPECIES.<span style=color:#a6e22e>loopBound</span>(a.<span style=color:#a6e22e>length</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (; i <span style=color:#f92672>&lt;</span> upperBound; i <span style=color:#f92672>+=</span> SPECIES.<span style=color:#a6e22e>length</span>()) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// FloatVector va, vb, vc;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> va <span style=color:#f92672>=</span> FloatVector.<span style=color:#a6e22e>fromArray</span>(SPECIES, a, i);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> vb <span style=color:#f92672>=</span> FloatVector.<span style=color:#a6e22e>fromArray</span>(SPECIES, b, i);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> vc <span style=color:#f92672>=</span> va.<span style=color:#a6e22e>mul</span>(va)
</span></span><span style=display:flex><span>                   .<span style=color:#a6e22e>add</span>(vb.<span style=color:#a6e22e>mul</span>(vb))
</span></span><span style=display:flex><span>                   .<span style=color:#a6e22e>neg</span>();
</span></span><span style=display:flex><span>        vc.<span style=color:#a6e22e>intoArray</span>(c, i);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (; i <span style=color:#f92672>&lt;</span> a.<span style=color:#a6e22e>length</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        c<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> (a<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> <span style=color:#f92672>*</span> a<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> b<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> <span style=color:#f92672>*</span> b<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span>) <span style=color:#f92672>*</span> <span style=color:#f92672>-</span>1.<span style=color:#a6e22e>0f</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä¸€èˆ¬çš„ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã‚ã¾ã‚Šä½¿ã‚ã‚Œã‚‹ã“ã¨ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ãŒã€ã‚‚ã—ã“ã®ã‚ˆã†ãªè¨ˆç®—ãŒå¿…è¦ã¨ã•ã‚Œã‚‹å‡¦ç†ã‚’æ›¸ãå ´åˆã€å¾“æ¥ã®ã‚³ãƒ¼ãƒ‰ã‚ˆã‚Šã‚‚é«˜é€Ÿã§ä¸¦åˆ—ã‹ã‚‚ã§ãã‚‹ã¨ã„ã†ã“ã¨ãªã®ã§ã€ä½¿ã†å ´é¢ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</p><h3 id=deprecate-the-windows-32-bit-x86-port-for-removal>Deprecate the Windows 32-bit x86 Port for Removal</h3><p>Windows x86-32ã®ãƒãƒ¼ãƒˆãŒã„ãšã‚Œçµ‚ã‚ã‚‹ã®ã§ã€ã¾ãšã¯Deprecatedã«ã—ã¦ã™ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚Virtual ThreadãŒè©²å½“ã®OSã ã¨æœŸå¾…é€šã‚Šã®æ€§èƒ½å‘ä¸ŠãŒãªãã€32bitã«å¯¾å¿œã™ã‚‹æœ€å¾Œã®Windowsã§ã‚ã‚‹Windows 10ãŒ2025å¹´10æœˆã«ã‚µãƒãƒ¼ãƒˆçµ‚äº†ã¨ãªã‚‹ãŸã‚ã®å¯¾å¿œã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚</p><h3 id=prepare-to-disallow-the-dynamic-loading-of-agents>Prepare to Disallow the Dynamic Loading of Agents</h3><p>Java agentã«ã‚ˆã‚‹å‹•çš„ãƒ­ãƒ¼ãƒ‰ã¯ã€å®Ÿè¡Œä¸­ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ã—ã‹ã—ã“ã®ã‚ˆã†æ©Ÿèƒ½ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ•´åˆæ€§ã‚’ä¿è¨¼ã§ããªãã™ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚ãã®ã‚ˆã†ãªå•é¡Œã‚’é˜²ããŸã‚ã«ã€å°†æ¥ã¯å‹•çš„ãƒ­ãƒ¼ãƒ‰ã‚’ç¦æ­¢ã—ã€Java 21ã§ã¯ã¾ãšè­¦å‘Šã‚’å‡ºåŠ›ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>WARNING: A {Java,JVM TI} agent has been loaded dynamically (file:/u/bob/agent.jar)
</span></span><span style=display:flex><span>WARNING: If a serviceability tool is in use, please run with -XX:+EnableDynamicAgentLoading to hide this warning
</span></span><span style=display:flex><span>WARNING: If a serviceability tool is not in use, please run with -Djdk.instrument.traceUsage for more information
</span></span><span style=display:flex><span>WARNING: Dynamic loading of agents will be disallowed by default in a future release
</span></span></code></pre></div><p>ã“ã®ã‚ˆã†ãªè­¦å‘Šã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œæ™‚ã«<code>-XX:+EnableDynamicAgentLoading</code>ã¨ã„ã†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><p><a class=link href=https://www.datadoghq.com/ target=_blank rel=noopener>Datadog</a>ã‚„<a class=link href=https://docs.oracle.com/cd/F25597_01/document/products/wls/docs90/jmxinst/understanding.html target=_blank rel=noopener>JMX</a>ãªã©ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ãŒã“ã®ã‚ˆã†ãªæ©Ÿèƒ½ã«ä¾å­˜ã—ã¦ã„ã‚‹å ´åˆãŒã‚ã‚‹ã®ã§ã€ä»Šå¾Œã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ã†éš›ã«ã¯ä½•ã‹å®Ÿè£…ã®æ–¹æ³•ãŒå¤‰ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚</p><h3 id=key-encapsulation-mechanism-api>Key Encapsulation Mechanism API</h3><p>æœ€æ–°ã®æš—å·åŒ–ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«å¯¾å¿œã™ã‚‹ã‚‚ã®ã§ã™ã€‚é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã§ã¯æ—¢å­˜ã®æš—å·åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒé€šç”¨ã—ãªããªã‚‹ã¨ã„ã†è©±ã‚‚ã‚ã‚‹ã®ã§ã€ãã®å¯¾å¿œã¨ã—ã¦å°å…¥ã•ã‚ŒãŸã‚‚ã®ã‹ã¨æ€ã‚ã‚Œã¾ã™ï¼ˆå…¬å¼ã§ã‚‚ã€<code> Post-Quantum Cryptography standardization process</code>ã¨è¿°ã¹ã¦ã„ã¾ã™ï¼‰ã€‚</p><p>æ–°ã—ã„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ç”¨ã„ãŸå…¬é–‹éµãƒ»ç§˜å¯†éµã®ãƒšã‚¢ã®ç”Ÿæˆã€ã‚«ãƒ—ã‚»ãƒ«åŒ–ã€ã‚«ãƒ—ã‚»ãƒ«ã®è§£é™¤ãªã©ã®æ©Ÿèƒ½ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªä½¿ã„æ–¹ã¨ãªã‚Šã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Receiver side</span>
</span></span><span style=display:flex><span>KeyPairGenerator g <span style=color:#f92672>=</span> KeyPairGenerator.<span style=color:#a6e22e>getInstance</span>(<span style=color:#e6db74>&#34;ABC&#34;</span>);
</span></span><span style=display:flex><span>KeyPair kp <span style=color:#f92672>=</span> g.<span style=color:#a6e22e>generateKeyPair</span>();
</span></span><span style=display:flex><span>publishKey(kp.<span style=color:#a6e22e>getPublic</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Sender side</span>
</span></span><span style=display:flex><span>KEM kemS <span style=color:#f92672>=</span> KEM.<span style=color:#a6e22e>getInstance</span>(<span style=color:#e6db74>&#34;ABC-KEM&#34;</span>);
</span></span><span style=display:flex><span>PublicKey pkR <span style=color:#f92672>=</span> retrieveKey();
</span></span><span style=display:flex><span>ABCKEMParameterSpec specS <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ABCKEMParameterSpec(...);
</span></span><span style=display:flex><span>KEM.<span style=color:#a6e22e>Encapsulator</span> e <span style=color:#f92672>=</span> kemS.<span style=color:#a6e22e>newEncapsulator</span>(pkR, specS, <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>KEM.<span style=color:#a6e22e>Encapsulated</span> enc <span style=color:#f92672>=</span> e.<span style=color:#a6e22e>encapsulate</span>();
</span></span><span style=display:flex><span>SecretKey secS <span style=color:#f92672>=</span> enc.<span style=color:#a6e22e>key</span>();
</span></span><span style=display:flex><span>sendBytes(enc.<span style=color:#a6e22e>encapsulation</span>());
</span></span><span style=display:flex><span>sendBytes(enc.<span style=color:#a6e22e>params</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Receiver side</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> em <span style=color:#f92672>=</span> receiveBytes();
</span></span><span style=display:flex><span><span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> params <span style=color:#f92672>=</span> receiveBytes();
</span></span><span style=display:flex><span>KEM kemR <span style=color:#f92672>=</span> KEM.<span style=color:#a6e22e>getInstance</span>(<span style=color:#e6db74>&#34;ABC-KEM&#34;</span>);
</span></span><span style=display:flex><span>AlgorithmParameters algParams <span style=color:#f92672>=</span> AlgorithmParameters.<span style=color:#a6e22e>getInstance</span>(<span style=color:#e6db74>&#34;ABC-KEM&#34;</span>);
</span></span><span style=display:flex><span>algParams.<span style=color:#a6e22e>init</span>(params);
</span></span><span style=display:flex><span>ABCKEMParameterSpec specR <span style=color:#f92672>=</span> algParams.<span style=color:#a6e22e>getParameterSpec</span>(ABCKEMParameterSpec.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>KEM.<span style=color:#a6e22e>Decapsulator</span> d <span style=color:#f92672>=</span> kemR.<span style=color:#a6e22e>newDecapsulator</span>(kp.<span style=color:#a6e22e>getPrivate</span>(), specR);
</span></span><span style=display:flex><span>SecretKey secR <span style=color:#f92672>=</span> d.<span style=color:#a6e22e>decapsulate</span>(em);
</span></span></code></pre></div><h3 id=structured-concurrency-preview>Structured Concurrency (Preview)</h3><p>ä¸¦åˆ—å‡¦ç†ã‚’ã‚ˆã‚Šç°¡å˜ã«ã™ã‚‹ãŸã‚ã®APIã§ã™ã€‚è¤‡æ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã•ã‚Œã‚‹ä½œæ¥­ã®å˜ä½ã‚’ä¸€ã¤ã®ã‚¿ã‚¹ã‚¯ã¨ã—ã¦æ‰±ã†ã“ã¨ãŒã§ãã¾ã™ã€‚</p><p>ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒã‚ã£ãŸã¨ã—ã¾ã™ã€‚userã¨orderã®ãƒ‡ãƒ¼ã‚¿ã‚’ãã‚Œãã‚Œé•ã†ã‚¹ãƒ¬ãƒƒãƒ‰ã§å–å¾—ã—ã¦ã€ãã®çµæœã‚’è¿”ã™é–¢æ•°ã§ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Response <span style=color:#a6e22e>handle</span>() <span style=color:#66d9ef>throws</span> ExecutionException, InterruptedException {
</span></span><span style=display:flex><span>    Future<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>  user  <span style=color:#f92672>=</span> esvc.<span style=color:#a6e22e>submit</span>(() <span style=color:#f92672>-&gt;</span> findUser());
</span></span><span style=display:flex><span>    Future<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;</span> order <span style=color:#f92672>=</span> esvc.<span style=color:#a6e22e>submit</span>(() <span style=color:#f92672>-&gt;</span> fetchOrder());
</span></span><span style=display:flex><span>    String theUser  <span style=color:#f92672>=</span> user.<span style=color:#a6e22e>get</span>();   <span style=color:#75715e>// Join findUser</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span>    theOrder <span style=color:#f92672>=</span> order.<span style=color:#a6e22e>get</span>();  <span style=color:#75715e>// Join fetchOrder</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Response(theUser, theOrder);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå•é¡ŒãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚</p><ul><li>findUser()ã§ä¾‹å¤–ãŒç™ºç”Ÿã—ã¦ã‚‚fetchOrder()ã¯å®Ÿè¡Œã•ã‚Œã¦ãƒªã‚½ãƒ¼ã‚¹ã®ç„¡é§„ã«ãªã‚‹</li><li>handle()ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ãŒã‚¤ãƒ³ã‚¿ãƒ©ãƒ—ãƒˆã•ã‚ŒãŸå ´åˆã€findUser()ã¨fetchOrder()ã¯å®Ÿè¡Œã•ã‚ŒãŸã¾ã¾ã«ãªã‚‹</li><li>findUser()ã®å®Ÿè¡ŒãŒé•·ã™ãã‚‹å ´åˆã€fetchOrder()ãŒå¤±æ•—ã—ã¦ã‚‚ãã‚Œã‚’å¾…ã¤ã“ã¨ã«ãªã‚‹ï¼ˆçµæœçš„ã«å¤±æ•—ï¼‰</li></ul><p>ã“ã‚Œã‚‰ã®å•é¡ŒãŒæŒ™ã’ã‚‰ã‚Œã¦ã¨ã„ã†ã“ã¨ã¯ã€æ–°ã—ã„APIã§ã¯ãã‚Œã‚’è§£æ±ºã§ãã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã­ã€‚æ–°ã—ã„APIã§ã¯ä¸Šè¨˜ã®å•é¡Œã‚’ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§è§£æ±ºã—ã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Response <span style=color:#a6e22e>handle</span>() <span style=color:#66d9ef>throws</span> ExecutionException, InterruptedException {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (<span style=color:#66d9ef>var</span> scope <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> StructuredTaskScope.<span style=color:#a6e22e>ShutdownOnFailure</span>()) {
</span></span><span style=display:flex><span>        Supplier<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>  user  <span style=color:#f92672>=</span> scope.<span style=color:#a6e22e>fork</span>(() <span style=color:#f92672>-&gt;</span> findUser());
</span></span><span style=display:flex><span>        Supplier<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;</span> order <span style=color:#f92672>=</span> scope.<span style=color:#a6e22e>fork</span>(() <span style=color:#f92672>-&gt;</span> fetchOrder());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        scope.<span style=color:#a6e22e>join</span>()            <span style=color:#75715e>// Join both subtasks</span>
</span></span><span style=display:flex><span>             .<span style=color:#a6e22e>throwIfFailed</span>();  <span style=color:#75715e>// ... and propagate errors</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Here, both subtasks have succeeded, so compose their results</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Response(user.<span style=color:#a6e22e>get</span>(), order.<span style=color:#a6e22e>get</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><a class=link href=https://download.java.net/java/early_access/jdk21/docs/api/java.base/java/util/concurrent/StructuredTaskScope.html target=_blank rel=noopener>StructuredTaskScope</a>ã‚’åˆ©ç”¨ã—ã¦å‡¦ç†ã‚’è¡Œã†å ´åˆã€ä»¥ä¸‹ã®ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚</p><ul><li>findUser()ã‚„fecthOrder()ã®ã©ã¡ã‚‰ã‹ãŒå¤±æ•—ã—ãŸã‚‰ã€æ®‹ã‚Šã®å‡¦ç†ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã‚‹</li><li>handle()ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ãŒã‚¤ãƒ³ã‚¿ãƒ©ãƒ—ãƒˆã•ã‚ŒãŸå ´åˆã€findUser()ã¨fetchOrder()ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã‚‹</li><li>å‡¦ç†ãŒæ˜ç¢ºã«ç†è§£ã§ãã‚‹</li></ul><h2 id=api>API</h2><p>ä»Šå›ã®æ–°ã—ã„APIã«é–¢ã—ã¦ã¯ã€è¨€èªã‚¹ãƒšãƒƒã‚¯ã§ã‚ˆãèª¬æ˜ã•ã‚Œã¦ãŠã‚Šã€æ–°ã—ã„Javadocã®æ–¹ã§ãã‚Œãã‚Œã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¥ã«ã©ã‚“ãªã‚‚ã®ãŒè¿½åŠ ã•ã‚ŒãŸã‹ãƒ•ã‚£ãƒ«ã‚¿ã—ãªãŒã‚‰ç¢ºèªãŒã§ãã‚‹ã®ã§ã€ã“ã“ã§ã¯<a class=link href=https://download.java.net/java/early_access/jdk21/docs/api/new-list.html target=_blank rel=noopener>Javadocã®ãƒªãƒ³ã‚¯</a>ã ã‘ã‚’è²¼ã£ã¦ãŠãã¾ã™ã€‚</p><h2 id=æœ€å¾Œã«>æœ€å¾Œã«</h2><p>ã„ã‹ãŒã ã£ãŸã§ã—ã‚‡ã†ã‹ã€‚ç§ã¯ã‚‚ã†Javaã§ã‚¢ãƒ—ãƒªã‚’æ›¸ãã“ã¨ã¯ã»ã¨ã‚“ã©ãªãã€ä¸»ã«Kotlinã‚’æ›¸ã„ã¦ã„ã¦ã€æ–°ã—ã„APIã‚‚ãã“ã¾ã§ã‚³ãƒ¼ãƒ‰ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã“ã¨ã¯ãªã„ã®ã§ã™ãŒã€ãã‚Œã§ã‚‚Javaã®æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹ã¨ã€ãªã‚“ã ã‹å¬‰ã—ããªã‚Šã¾ã™ã­ã€‚ç‰¹ã«Virtual Threadã®ã‚ˆã†ãªAPIã¯Kotlinã§ã‚‚ä½¿ãˆã‚‹ã—ã€Javaã§ä½œæˆã•ã‚ŒãŸTomcatã‚„Nettyã®ã‚ˆã†ãªãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®æ€§èƒ½ã‚‚ã“ã‚Œã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã•ã‚‰ã«æ€§èƒ½ãŒä¸ŠãŒã‚‹ã¨æ€ã†ã¨ã‚ã‚ŠãŒãŸã„ã§ã™ã€‚ä»–ã«ã‚‚è¿½åŠ ã•ã‚Œã‚‹APIã¯Kotlinã¨ã¯ã¾ãŸé•ã†ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ã—ã¦ã„ã‚‹ã®ã§å¤§å¤‰å‹‰å¼·ã«ãªã‚‹ãªã¨æ€ã„ã¾ã—ãŸã€‚</p><p>ä»Šã¯ä»•äº‹ã§Java 17ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€Java 21ã«ãªã£ãŸã‚‰ã™ãã«ã§ã‚‚ä½¿ã„ãŸã„ã¨æ€ã„ã¾ã™ã€‚ç‰¹ã«æ¥å¹´ã¯Kotlinã‚‚2.0ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹ã®ã§ã€Javaã®æ–°æ©Ÿèƒ½ã‚’æ´»ã‹ã—ã¦Kotlinã®ãƒ“ãƒ«ãƒ‰ã‚‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚‚ã•ã‚‰ã«å‘ä¸Šã•ã›ã¦ã„ããŸã„ãªã¨æ€ã„ã¾ã™ã€‚</p><p>ã§ã¯ã€ã¾ãŸï¼</p></section><footer class=article-footer><section class=article-tags><a href=/tags/java/>Java</a>
<a href=/tags/kotlin/>Kotlin</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/posts/java-enter-to-17/><div class=article-image><img src=/images/java.jpg loading=lazy data-key data-hash=/images/java.jpg></div><div class=article-details><h2 class=article-title>Java 17ã¯ä½•ãŒå¤‰ã‚ã£ãŸã‹</h2></div></a></article><article class=has-image><a href=/posts/java-string-concat-and-split/><div class=article-image><img src=/images/java.jpg loading=lazy data-key data-hash=/images/java.jpg></div><div class=article-details><h2 class=article-title>ä»Šæ›´ãªæ–‡å­—åˆ—æ“ä½œã®è©±</h2></div></a></article><article class=has-image><a href=/posts/java-file-copy/><div class=article-image><img src=/images/java.jpg loading=lazy data-key data-hash=/images/java.jpg></div><div class=article-details><h2 class=article-title>ä»Šæ›´ãªI/Oã®è©±</h2></div></a></article><article class=has-image><a href=/posts/java-new-methods-from-9-to-11/><div class=article-image><img src=/images/java.jpg loading=lazy data-key data-hash=/images/java.jpg></div><div class=article-details><h2 class=article-title>9ã‹ã‚‰ã®æ–°ãƒ¡ã‚½ãƒƒãƒ‰ã‚ãã‚Š</h2></div></a></article><article class=has-image><a href=/posts/java-collection-loop/><div class=article-image><img src=/images/java.jpg loading=lazy data-key data-hash=/images/java.jpg></div><div class=article-details><h2 class=article-title>ä»Šæ›´ãªãƒ«ãƒ¼ãƒ—ã®è©±</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2019 -
2024 Korean-man in Tokyo</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.20.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>