<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="IT関係の仕事を選び、最も良いと思うところはやはり色々な状況に置かれることによって得られる経験が多いということではないかと思います。なぜかと"><title>Pythonでxmlファイルを操作する(1)</title><link rel=canonical href=https://retheviper.github.io/posts/python-xml-modifier-1/><link rel=stylesheet href=/scss/style.min.fbb68fe51fb77bdd639dccfe1c7b590d2330cf8b81da91f1585b35c3d07fbac8.css><meta property="og:title" content="Pythonでxmlファイルを操作する(1)"><meta property="og:description" content="IT関係の仕事を選び、最も良いと思うところはやはり色々な状況に置かれることによって得られる経験が多いということではないかと思います。なぜかと"><meta property="og:url" content="https://retheviper.github.io/posts/python-xml-modifier-1/"><meta property="og:site_name" content="Korean-man in Tokyo"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="xml"><meta property="article:tag" content="python"><meta property="article:published_time" content="2019-06-09T00:00:00+00:00"><meta property="article:modified_time" content="2019-06-09T00:00:00+00:00"><meta property="og:image" content="https://retheviper.github.io/images/python.jpg"><meta name=twitter:title content="Pythonでxmlファイルを操作する(1)"><meta name=twitter:description content="IT関係の仕事を選び、最も良いと思うところはやはり色々な状況に置かれることによって得られる経験が多いということではないかと思います。なぜかと"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://retheviper.github.io/images/python.jpg"><link rel=apple-touch-icon sizes=57x57 href=/favicon/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/favicon/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/favicon/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/favicon/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/favicon/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/favicon/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/favicon/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/favicon/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/favicon/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/favicon/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><link rel=manifest href=/favicon/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/favicon/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><script async src="https://www.googletagmanager.com/gtag/js?id=G-BYJBEJB6DX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-BYJBEJB6DX',{anonymize_ip:!1})}</script></head><body class="article-page has-toc"><script>(function(){const e='StackColorScheme';localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t='StackColorScheme',e=localStorage.getItem(t),n=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;e=='dark'||e==='auto'&&n?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/python-xml-modifier-1/><img src=/../../images/python.jpg loading=lazy alt="Featured image of post Pythonでxmlファイルを操作する(1)"></a></div><div class=article-details><header class=article-category><a href=/categories/python/ style=background-color:#2a9d8f;color:#fff>python</a></header><h2 class=article-title><a href=/posts/python-xml-modifier-1/>Pythonでxmlファイルを操作する(1)</a></h2><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Jun 09, 2019</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>10 minute read</time></div></footer></div></header><section class=article-content><p>IT関係の仕事を選び、最も良いと思うところはやはり色々な状況に置かれることによって得られる経験が多いということではないかと思います。なぜかというと、独学だけでは言語の基礎文法はわかっても実際のコーディングではどう設計したらいいか、どんなモジュール(ライブラリーを含め)を使ったらいいかわからない場合があるからです。そもそも何を作ればいいかわからない場合が多いですね。大分類としてはウェブアプリケーションか、バッチで動くコードかということなどがあり、細かくはどんなDBを使って、どんな作業をしたいか(結合する対象など)の詳細を一人で全部想定することはかなり難しい作業ではないかと思います。しかし仕事ではある程度要件が決まっているので、その結合の方法と必要な作業がわかればあとは頑張るだけですから。目標設定が何よりも重要だということはまさにこれのことかも知れません。</p><p>なので今回も仕事で任されたことです。要件はこうです。とあるツールを使って開発をしています。このツールではGUIでマップ上にアイコンを配置し、そのアイコンが一つの作業単位となっています。そしてアイコンとアイコンを結び、各アイコンにとある行動を設定することで全体なワークフローが出来上がる構造となっています。例えばDBのアイコンに接続先のDBの情報と発行するSQL文を入力し、ファイル出力のアイコンに繋ぐとそれを実行した時にDBからSQL文を実行した結果がファイルとして保存されます。このツールで作られたワークフローはxmlファイルとして保存されます。</p><p>問題は、開発環境と本場環境での設定が違うところがあるということです。主にこのツールを通してやっている作業はDB関係のものですが、開発環境と本場環境でそれぞれDBの接続先情報が違います。そしてそのDBの接続先の設定はxmlファイルに保存されているので、開発の終わったxmlファイルを本場環境にデプロイするときはただのコピーでは不完全なので「DBの接続先情報を書き換える」作業が必要です。この作業をどう実装したから今回のポストのテーマとなります。</p><h2 id=事前準備>事前準備</h2><p>デプロイ先と、デプロイ元のサーバーは両方Linuxを使っています。そしてxmlファイルのソースはGitで管理することになっています。なのでまずデプロイ元からはGit pullし、DB情報を書き換えたあとはrsyncなどのコマンドでコピーすれば簡単に終わります。こちらの作業はJenkinsで自動化することにしました。ならば、残る問題はDB情報を書き換える作業をどう実装するかですね。</p><p>xmlを分析してみたら、各アイコンのタグの下にはそのアイコンの詳細設定情報がありました。DBの処理を行うアイコンは二つあって、一つ目はSELECTを発行する(以下、From)もので、二つ目はINSERTを発行する(以下、To)ものでした。FromとToで接続先のDBは種類も違って(片方はPostgreSQLで、片方はSQLServer)スキーマやテーブル名も違うので分けて処理する必要があります。</p><p>そして環境から考えると、Linuxで使える言語を選んだほうがいいでしょう。まずはシェルスクリプトを使ってコードを書いてみようと思いました。これが私の初のシェルスクリプトとなります。Javaよりは簡単ではないだろうか、という根拠のない自信からシェルを選びました。LinuxにはPythonも入っていましたが、そちらも触ったことがなかったのでまずシェルでやってみて、ダメだったらPythonに挑戦してみようかなと軽く思っていました。それが結果的には最初からPythonで書けばよかった…ってことになりましたが。</p><p>ともかくやりたいこと、環境、道具が揃ったので早速実装に入りました。</p><h2 id=シェルスクリプトでコーディング>シェルスクリプトでコーディング</h2><p>シェルは初めてだったので、試行錯誤が多かったです。最初に学んだのがJavaだったので、同じ感覚で書こうとしたら全然動きません。何回か失敗を重ねながら得られた結論は、関数を使うという考え方を捨てて、どうコマンドを組み合わせるかが重要だということでした。それに気づくにはだいぶ時間がかかりましたが、まず大事なことはわかったのであとはどんなことをするかですね。</p><p>まずはファイルを読み込むことからです。xmlファイルも結局はテキスト基盤なので、シェルでも読み込みはできます。For文一つで特定の拡張子をもつファイルを巡回しながら一行づつ読むことができるらしいです。そして既存のアイコン(このファイルを使うツールの表現を借りると、コンポーネント)のDB接続先の情報の行を把握し、書き換えれば完了。</p><p>ただ、前述したようにFromとToのコンポーネントを区別する必要があります。xmlファイルを覗くとどうやらコンポーネントの構造(タグの種類)はほぼ同じみたいなので、どう判定するかが問題でした。シェルではxmlをパーシングできるモジュールなどはないみたいですからね。それでまずは行数を比較して、Fromのコンポーネントがより上にあったら１番目に引っかかったDB設定がFromのやつだ、という風に判定することにしました。以下はその実装のコードです。</p><h2 id=コードの例シェルスクリプト>コードの例(シェルスクリプト)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ff79c6>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span><span style=color:#6272a4># 下のフォルダを巡回しながらxmlの拡張子を持つファイルを変数のfileNameに入れる</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> fileName in <span style=color:#f1fa8c>`</span><span style=color:#f1fa8c>\f</span>ind . -name <span style=color:#f1fa8c>&#39;*.xml&#39;</span><span style=color:#f1fa8c>`</span>; <span style=color:#ff79c6>do</span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4># コンポーネントの行数をつかめる(grepでコンポーネントのタグかを確認し、sedで行数を確保)</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>getComponentLine</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span>grep -n RDBGet <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>fileName</span><span style=color:#f1fa8c>}</span> | grep Component | sed -e <span style=color:#f1fa8c>&#39;s/:.*//g&#39;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>putComponentLine</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span>grep -n RDBPut <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>fileName</span><span style=color:#f1fa8c>}</span> | grep Component | sed -e <span style=color:#f1fa8c>&#39;s/:.*//g&#39;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4># コネクションの行数をつかめる</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>ConnectionOneLine</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span>grep -n Connection <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>fileName</span><span style=color:#f1fa8c>}</span> | sed -e <span style=color:#f1fa8c>&#39;s/:.*//g&#39;</span> | awk <span style=color:#f1fa8c>&#39;NR==1&#39;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>ConnectionTwoLine</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span>grep -n Connection <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>fileName</span><span style=color:#f1fa8c>}</span> | sed -e <span style=color:#f1fa8c>&#39;s/:.*//g&#39;</span> | awk <span style=color:#f1fa8c>&#39;NR==2&#39;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4># コネクション名をつかめる(cutでDB設定名だけを取り、awkで2種類以上の結果からどちらかを取る)</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>ConnectionOneName</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span>grep Connection <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>fileName</span><span style=color:#f1fa8c>}</span> | cut -d <span style=color:#f1fa8c>&#34;&gt;&#34;</span> -f <span style=color:#bd93f9>2</span> | cut -d <span style=color:#f1fa8c>&#34;&lt;&#34;</span> -f <span style=color:#bd93f9>1</span> | awk <span style=color:#f1fa8c>&#39;NR==1&#39;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>ConnectionTwoName</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span>grep Connection <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>fileName</span><span style=color:#f1fa8c>}</span> | cut -d <span style=color:#f1fa8c>&#34;&gt;&#34;</span> -f <span style=color:#bd93f9>2</span> | cut -d <span style=color:#f1fa8c>&#34;&lt;&#34;</span> -f <span style=color:#bd93f9>1</span> | awk <span style=color:#f1fa8c>&#39;NR==2&#39;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>[</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>getComponentLine</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span> -lt <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>putComponentLine</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>]</span>; <span style=color:#ff79c6>then</span>
</span></span><span style=display:flex><span>        <span style=color:#6272a4># get &lt; putの場合ConnectionOneLineはgetのコネクション</span>
</span></span><span style=display:flex><span>        sed -i -e <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>ConnectionOneLine</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> s/</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>ConnectionOneName</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>/HONBADBFROM/g&#34;</span> <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>fileName</span><span style=color:#f1fa8c>}</span>
</span></span><span style=display:flex><span>        sed -i -e <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>ConnectionTwoLine</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> s/</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>ConnectionTwoName</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>/HONBADBTO/g&#34;</span> <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>fileName</span><span style=color:#f1fa8c>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>else</span>
</span></span><span style=display:flex><span>        <span style=color:#6272a4># get &gt; putの場合ConnectionOneLineはputのコネクション</span>
</span></span><span style=display:flex><span>        sed -i -e <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>ConnectionTwoLine</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> s/</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>ConnectionTwoName</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>/HONBADBFROM/g&#34;</span> <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>fileName</span><span style=color:#f1fa8c>}</span>
</span></span><span style=display:flex><span>        sed -i -e <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>ConnectionOneLine</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> s/</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>ConnectionOneName</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>/HONBADBTO/g&#34;</span> <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>fileName</span><span style=color:#f1fa8c>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>fi</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>done</span>
</span></span></code></pre></div><h2 id=問題点>問題点</h2><p>ファイルの形式がxmlであり、タグのパーシングで確実にコンポーネントを分けて処理していない現行の方式ではあまり安全だとは言えない処理です。そしてこの方式だとFromとToのコンポーネントがそれぞれ一つづつある場合は大丈夫かもしれませんが、どちらかのコンポーネントが一つでも増えたら処理の方法を変えるしかないです。もしかしたらそんなケースが増えると、そのケースに合わせてそれぞれ違うコードを書く必要があるかも知れません。そしてそれはいちいちファイルをチェックしてそれにあうコードとマッチさせる必要がありますね。これなら手書きで変えるのとあまり変わらないのでは…と思いますね。</p><p>結果的に汎用性もなく、安全でもないコードとなってしまいました。こんなコードは本場では使えません。なので方法を変えることにしました。</p><h2 id=pythonで書き直す>Pythonで書き直す</h2><p>次の方法として、Pythonを使ってちゃんとパーシングを行うことにしました。挑戦してみてからわかったのですが、こんな簡単な作業をするときはPythonが正解なのではないかと思うくらい簡単でした。それにLinuxの環境では基本的にPythonが入っている場合も多いようなので(yumがPythonを使う代表的な例です)、インストールしなくてもいいというのがメリットでもあります。それにBashがLinuxの基本機能であるのでPythonよりは速度が早いのではないかと思っていましたが、必ずしもそうでもないらしいですね。ならばますますシェルスクリプトにこだわる理由は無くなります。</p><p>ただLinuxに内蔵されているPythonは2が多いらしく(確認してみると、私の使うMacでもPython2が入っていました)、Pythonは2と3で文法が違うところも多くて特定の機能を使うには注意がいるらしいです。実際私の書いたコードでは、Python3でしか使えない部分があります。alternativeのようなコマンドでPythonのリンクを3に指定するという方法もありますが、それならPython2を使うプログラムで問題が起こる可能性があります。<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>なので最初からPython2のコードに書くか、実行するコードをPython3として実行するようにするか、Python2を使うプログラムの実行環境を変えるかの方法を工夫する必要がありました。</p><p>ここで私は、自分が書いたコードをPython3で実行するよう(Jenkinsに埋め込むので、そちらの設定を通しています)にしました。コードは以下となります。</p><h2 id=コードの例python>コードの例(Python)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#6272a4># -*- coding: UTF-8 -*-</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 日本語のコメントのために最初にエンコードを指定する</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># xmlパーサーとフォルダからファイルを取得するモジュールをインポート</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> xml.etree.ElementTree <span style=color:#ff79c6>as</span> ET
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> glob
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 名前空間（prefix）をマップで宣言</span>
</span></span><span style=display:flex><span>ns <span style=color:#ff79c6>=</span> {<span style=color:#f1fa8c>&#39;fb&#39;</span>:<span style=color:#f1fa8c>&#39;http://foo.com/builder&#39;</span>, <span style=color:#f1fa8c>&#39;fe&#39;</span>:<span style=color:#f1fa8c>&#39;http://foo.com/engine&#39;</span>, <span style=color:#f1fa8c>&#39;mp&#39;</span>:<span style=color:#f1fa8c>&#39;http://foo.com/mapper&#39;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># ファイル名を再帰的に取得(recursiveオプションはPython3専用)</span>
</span></span><span style=display:flex><span>fileList <span style=color:#ff79c6>=</span> glob<span style=color:#ff79c6>.</span>glob(<span style=color:#f1fa8c>&#34;**/HOGE*.xml&#34;</span>, recursive<span style=color:#ff79c6>=</span><span style=color:#ff79c6>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 取得したファイルを巡回しながらコネクション名の書き換え処理</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> fileName <span style=color:#ff79c6>in</span> fileList:
</span></span><span style=display:flex><span>    <span style=color:#6272a4># ファイルをパーシング開始</span>
</span></span><span style=display:flex><span>    tree <span style=color:#ff79c6>=</span> ET<span style=color:#ff79c6>.</span>parse(fileName)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4># Toのコンポーネントで子要素であるコネクション名を取得(prefix内)</span>
</span></span><span style=display:flex><span>    putCon <span style=color:#ff79c6>=</span> tree<span style=color:#ff79c6>.</span>find(<span style=color:#f1fa8c>&#34;fe:WorkFlow/fe:Component[@type=&#39;RDB(Put)&#39;]/fe:Property[@name=&#39;Connection&#39;]&#34;</span>, ns)
</span></span><span style=display:flex><span>    putCon<span style=color:#ff79c6>.</span>text <span style=color:#ff79c6>=</span> putCon<span style=color:#ff79c6>.</span>text <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;x&#39;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#6272a4># Fromのコンポーネントで子要素であるコネクション名を取得(prefix内)</span>
</span></span><span style=display:flex><span>    getCon <span style=color:#ff79c6>=</span> tree<span style=color:#ff79c6>.</span>find(<span style=color:#f1fa8c>&#34;fe:WorkFlow/fe:Component[@type=&#39;RDB(Get)&#39;]/fe:Property[@name=&#39;Connection&#39;]&#34;</span>, ns)
</span></span><span style=display:flex><span>    getCon<span style=color:#ff79c6>.</span>text <span style=color:#ff79c6>=</span> getCon<span style=color:#ff79c6>.</span>text <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;y&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4># 書き込みの時prefixが変わることを防止</span>
</span></span><span style=display:flex><span>    ET<span style=color:#ff79c6>.</span>register_namespace(<span style=color:#f1fa8c>&#39;fb&#39;</span>, <span style=color:#f1fa8c>&#39;http://foo.com/builder&#39;</span>)
</span></span><span style=display:flex><span>    ET<span style=color:#ff79c6>.</span>register_namespace(<span style=color:#f1fa8c>&#39;fe&#39;</span>, <span style=color:#f1fa8c>&#39;http://foo.com/engine&#39;</span>)
</span></span><span style=display:flex><span>    ET<span style=color:#ff79c6>.</span>register_namespace(<span style=color:#f1fa8c>&#39;mp&#39;</span>, <span style=color:#f1fa8c>&#39;http://foo.com/mapper&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4># 書き換え処理</span>
</span></span><span style=display:flex><span>    tree<span style=color:#ff79c6>.</span>write(fileName, <span style=color:#f1fa8c>&#39;UTF-8&#39;</span>, <span style=color:#ff79c6>True</span>)
</span></span></code></pre></div><h2 id=最後に>最後に</h2><p>コードの量もそんなに長くないし、ちゃんとパーシングで要素を捉えているのでシェルスクリプトに比べ安全な書き方になっています。それにタグによってコンポーネントを区別しているので、コンポーネントを数に変動があってもそのまま使えるという長所がありますね。タグに名前空間があると初期設定と書き込み直前にその処理が必要となるので少し面倒な部分はありますが<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>、確かにシェルスクリプトに比べ維持補修の面で手間がかからなくなったので満足できるコードを書けたと思います。速度も直接測定してみた訳ではないですが、相当早かったです(ただ単にPythonは遅いだろうという自分の偏見が問題だったかも知れません)。いやーPythonいいですね。</p><p>何よりもメインの関数やクラスを省略しても、本当にスクリプトぽい書き方でもちゃんと意図通りに動くということが素晴らしいですね。これからもLinux環境で簡単な反復作業を自動化したいという場合には、皆さんもぜひPythonを使ってみてくださいとオススメしたいくらいです。とても簡単な言語なので、これからもどんどん使って色々やってみたいなと思います。</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>例えば、yumで問題が発生しています。これはyumの実行環境を変える方法(/usr/bin/yumの設定を参照してください)もありますが、どれがPython2を使うかいちいち確認はできないのであまりおすすめしたくはない方法です。&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>特に最後の方の<code>ET.register_namespace()</code>がないと、名前空間が勝手に変わってしまいます。&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></section><footer class=article-footer><section class=article-tags><a href=/tags/xml/>xml</a>
<a href=/tags/python/>python</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/posts/python-xml-modifier-2/><div class=article-image><img src=/../../images/python.jpg loading=lazy data-key data-hash=/../../images/python.jpg></div><div class=article-details><h2 class=article-title>Pythonでxmlファイルを操作する(2)</h2></div></a></article><article class=has-image><a href=/posts/python-qt-app/><div class=article-image><img src=/../../images/python.jpg loading=lazy data-key data-hash=/../../images/python.jpg></div><div class=article-details><h2 class=article-title>PyQtで字幕翻訳ツールを作ってみた</h2></div></a></article><article class=has-image><a href=/posts/python-blob-to-binary/><div class=article-image><img src=/../../images/python.jpg loading=lazy data-key data-hash=/../../images/python.jpg></div><div class=article-details><h2 class=article-title>PythonでDBの処理がしたい</h2></div></a></article><article class=has-image><a href=/posts/python-logger/><div class=article-image><img src=/../../images/python.jpg loading=lazy data-key data-hash=/../../images/python.jpg></div><div class=article-details><h2 class=article-title>Pythonでログを出したい</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2019 -
2022 Korean-man in Tokyo</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.7.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#事前準備>事前準備</a></li><li><a href=#シェルスクリプトでコーディング>シェルスクリプトでコーディング</a></li><li><a href=#コードの例シェルスクリプト>コードの例(シェルスクリプト)</a></li><li><a href=#問題点>問題点</a></li><li><a href=#pythonで書き直す>Pythonで書き直す</a></li><li><a href=#コードの例python>コードの例(Python)</a></li><li><a href=#最後に>最後に</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>