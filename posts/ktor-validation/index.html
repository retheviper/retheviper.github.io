<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='Kotlinã¯Javaã¨ã®äº’æ›æ€§ãŒã‚ã‚‹ã®ã§ã€Javaã§æ§‹ç¯‰ã—ãŸæ—¢å­˜ã®ã‚·ã‚¹ãƒ†ãƒ ã®ä¸€éƒ¨ã‚’æ›¸ãæ›ãˆãŸã‚Šã€è¨€èªã ã‘ã‚’å¤‰ãˆã¦æ–°ã—ã„ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ãŸã‚Šã™ã‚‹ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã‹ãªã¨æ€ã„ã¾ã™ã€‚ã—ã‹ã—ã€åŒã˜JVMä¸Šã§å‹•ä½œã™ã‚‹Kotlinã¨Javaã§ã‚‚ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é•ã„ã«ã‚ˆã‚Šæ”¹å–„ã§ãã‚‹ç®‡æ‰€ã‚‚ã‚ã‚Šã¾ã™ã€‚
'><title>Ktorã®Requestå‡¦ç†ã‚’æ”¹å–„ã™ã‚‹</title><link rel=canonical href=https://retheviper.github.io/posts/ktor-validation/><link rel=stylesheet href=/scss/style.min.860dd2cdb2f2ca3d772cda81aa659d4c99fcffa6b8fd7a384c2f4ccecd8f6b9f.css><meta property='og:title' content='Ktorã®Requestå‡¦ç†ã‚’æ”¹å–„ã™ã‚‹'><meta property='og:description' content='Kotlinã¯Javaã¨ã®äº’æ›æ€§ãŒã‚ã‚‹ã®ã§ã€Javaã§æ§‹ç¯‰ã—ãŸæ—¢å­˜ã®ã‚·ã‚¹ãƒ†ãƒ ã®ä¸€éƒ¨ã‚’æ›¸ãæ›ãˆãŸã‚Šã€è¨€èªã ã‘ã‚’å¤‰ãˆã¦æ–°ã—ã„ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ãŸã‚Šã™ã‚‹ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã‹ãªã¨æ€ã„ã¾ã™ã€‚ã—ã‹ã—ã€åŒã˜JVMä¸Šã§å‹•ä½œã™ã‚‹Kotlinã¨Javaã§ã‚‚ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é•ã„ã«ã‚ˆã‚Šæ”¹å–„ã§ãã‚‹ç®‡æ‰€ã‚‚ã‚ã‚Šã¾ã™ã€‚
'><meta property='og:url' content='https://retheviper.github.io/posts/ktor-validation/'><meta property='og:site_name' content='Korean-man in Tokyo'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='ktor'><meta property='article:tag' content='kotlin'><meta property='article:published_time' content='2025-06-28T00:00:00+00:00'><meta property='article:modified_time' content='2025-06-28T00:00:00+00:00'><meta property='og:image' content='https://retheviper.github.io/images/ktor.webp'><meta name=twitter:title content="Ktorã®Requestå‡¦ç†ã‚’æ”¹å–„ã™ã‚‹"><meta name=twitter:description content="Kotlinã¯Javaã¨ã®äº’æ›æ€§ãŒã‚ã‚‹ã®ã§ã€Javaã§æ§‹ç¯‰ã—ãŸæ—¢å­˜ã®ã‚·ã‚¹ãƒ†ãƒ ã®ä¸€éƒ¨ã‚’æ›¸ãæ›ãˆãŸã‚Šã€è¨€èªã ã‘ã‚’å¤‰ãˆã¦æ–°ã—ã„ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ãŸã‚Šã™ã‚‹ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã‹ãªã¨æ€ã„ã¾ã™ã€‚ã—ã‹ã—ã€åŒã˜JVMä¸Šã§å‹•ä½œã™ã‚‹Kotlinã¨Javaã§ã‚‚ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é•ã„ã«ã‚ˆã‚Šæ”¹å–„ã§ãã‚‹ç®‡æ‰€ã‚‚ã‚ã‚Šã¾ã™ã€‚
"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://retheviper.github.io/images/ktor.webp'><link rel="shortcut icon" href=/favicon.ico><link rel=icon href=/favicon/favicon.ico><link rel=mask-icon href=safari-pinned-tab.svg color=black><link rel=manifest href=/favicon/manifest.json><script async src="https://www.googletagmanager.com/gtag/js?id=G-BYJBEJB6DX"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BYJBEJB6DX")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_5754c4c47ba5668d.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ‘‹</span></figure><div class=site-meta><h1 class=site-name><a href=/>Korean-man in Tokyo</a></h1><h2 class=site-description>ä¸€äººå‰ã«ãªã‚ŠãŸã„ã§ã™</h2></div></header><ol class=social-menu><li><a href=https://www.credly.com/users/youngbin-kim.6d7122f1/badges target=_blank title=Certificates rel=me><svg class="icon icon-tabler icon-tabler-certificate" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="15" cy="15" r="3"/><path d="M13 17.5V22l2-1.5 2 1.5v-4.5"/><path d="M10 19H5a2 2 0 01-2-2V7c0-1.1.9-2 2-2h14a2 2 0 012 2v10a2 2 0 01-1 1.73"/><line x1="6" y1="9" x2="18" y2="9"/><line x1="6" y1="12" x2="9" y2="12"/><line x1="6" y1="15" x2="8" y2="15"/></svg></a></li><li><a href=https://github.com/retheviper target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/%E8%8B%B1%E6%96%8C-%E9%87%91-6736ba194/ target=_blank title=LinkedIn rel=me><svg class="icon icon-tabler icon-tabler-brand-linkedin" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="2"/><line x1="8" y1="11" x2="8" y2="16"/><line x1="8" y1="8" x2="8" y2="8.01"/><line x1="12" y1="16" x2="12" y2="11"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://retheviper.github.io/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://retheviper.github.io/ selected></option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#æ—¢å­˜>æ—¢å­˜</a></li><li><a href=#æ”¹å–„>æ”¹å–„</a><ol><li><a href=#ktorã®request-validationã‚’ä½¿ç”¨ã™ã‚‹>Ktorã®Request Validationã‚’ä½¿ç”¨ã™ã‚‹</a></li><li><a href=#ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¨­å®š>ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¨­å®š</a></li><li><a href=#kotlinx-serializationã®ä½¿ç”¨>Kotlinx Serializationã®ä½¿ç”¨</a></li><li><a href=#è©•ä¾¡>è©•ä¾¡</a></li></ol></li><li><a href=#æ”¹å–„å†…å®¹ã®ã¾ã¨ã‚>æ”¹å–„å†…å®¹ã®ã¾ã¨ã‚</a></li><li><a href=#æœ€å¾Œã«>æœ€å¾Œã«</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/ktor-validation/><img src=/images/ktor.webp loading=lazy alt="Featured image of post Ktorã®Requestå‡¦ç†ã‚’æ”¹å–„ã™ã‚‹"></a></div><div class=article-details><header class=article-category><a href=/categories/ktor/ style=background-color:#2a9d8f;color:#fff>ktor</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/ktor-validation/>Ktorã®Requestå‡¦ç†ã‚’æ”¹å–„ã™ã‚‹</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jun 28, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>11 minute read</time></div></footer></div></header><section class=article-content><p>Kotlinã¯Javaã¨ã®äº’æ›æ€§ãŒã‚ã‚‹ã®ã§ã€Javaã§æ§‹ç¯‰ã—ãŸæ—¢å­˜ã®ã‚·ã‚¹ãƒ†ãƒ ã®ä¸€éƒ¨ã‚’æ›¸ãæ›ãˆãŸã‚Šã€è¨€èªã ã‘ã‚’å¤‰ãˆã¦æ–°ã—ã„ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ãŸã‚Šã™ã‚‹ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã‹ãªã¨æ€ã„ã¾ã™ã€‚ã—ã‹ã—ã€åŒã˜JVMä¸Šã§å‹•ä½œã™ã‚‹Kotlinã¨Javaã§ã‚‚ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é•ã„ã«ã‚ˆã‚Šæ”¹å–„ã§ãã‚‹ç®‡æ‰€ã‚‚ã‚ã‚Šã¾ã™ã€‚</p><p>Javaã®æ­´å²ãŒé•·ã„ã“ã¨ã‚‚ã‚ã‚Šã€Javaã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯éå¸¸ã«å¤šãã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã¾ã™ãŒã€Kotlinã§ã¯ã‚ˆã‚Šç°¡æ½”ã§ç›´æ„Ÿçš„ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ãŒã§ãã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€ãã®ä¸­ã§ã¯Kotlinã®ç‰¹æ€§ã‚’æ´»ã‹ã—ãŸè¨­è¨ˆãŒå¯èƒ½ã ã£ãŸã‚Šã€æ€§èƒ½ã®å‘ä¸ŠãŒæœŸå¾…ã§ããŸã‚Šã—ã¾ã™ã€‚</p><p>ä»Šå›ã¯ãã®ã‚ˆã†ãªæ”¹å–„ã®ä¸€ä¾‹ã¨ã—ã¦ã€Ktorã§ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…æ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚</p><h2 id=æ—¢å­˜>æ—¢å­˜</h2><p>å®Ÿå‹™ã§ã¯<a class=link href=https://ktor.io target=_blank rel=noopener>Ktor</a>ã€<a class=link href=https://www.jetbrains.com/ja-jp/exposed target=_blank rel=noopener>Exposed</a>ã¨ã„ã£ãŸKotlinç”¨ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚ãŸã ä¸€éƒ¨ã§ã¯Javaã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ä¾å­˜ã—ã¦ã„ã¦ã€ç›´åˆ—åŒ–ã§ã¯Jacksonã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯jakarta.validationã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã—ãŸã€‚</p><p>Javaã‚„Kotlinã§ã‚ˆãä½¿ã‚ã‚Œã‚‹Spring Bootã®å ´åˆã€ã“ã‚Œã‚‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã®ãŒã¨ã¦ã‚‚ç°¡å˜ã§ã™ã­ã€‚ä¾‹ãˆã°ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯<code>@Valid</code>ã‚„<code>@Validated</code>ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§è‡ªå‹•çš„ã«è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚</p><p>ã—ã‹ã—ã€Ktorã§ã¯ãã†ã§ã‚‚ã„ãã¾ã›ã‚“ã€‚ãªã®ã§ã€Ktorã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€æ‰‹å‹•ã§è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦ã„ã¾ã—ãŸã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>object</span> <span style=color:#a6e22e>AnnotationValidator</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> validator: Validator = <span style=color:#a6e22e>Validation</span>.buildDefaultValidatorFactory().validator
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getViolationMessages</span>(model: Any?): List&lt;String&gt; {
</span></span><span style=display:flex><span>        model <span style=color:#f92672>?:</span> <span style=color:#66d9ef>return</span> emptyList()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> violations = validator.validate(model)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> violations.map { <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${it.propertyPath}</span><span style=color:#e6db74> </span><span style=color:#e6db74>${it.message}</span><span style=color:#e6db74>&#34;</span> }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Validatable</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>validate</span>(): List&lt;String&gt;
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateLogRequest</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:NotNull
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:NotBlank
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:Size(max = <span style=color:#ae81ff>36</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:Pattern(regexp = <span style=color:#e6db74>&#34;^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JsonProperty</span>(<span style=color:#e6db74>&#34;user_id&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> userId: String?,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:NotNull
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:NotBlank
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:Size(max = <span style=color:#ae81ff>2048</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JsonProperty</span>(<span style=color:#e6db74>&#34;referral&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> referral: String?,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:NotNull
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:NotBlank
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:Size(max = <span style=color:#ae81ff>2048</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JsonProperty</span>(<span style=color:#e6db74>&#34;user_agent&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> userAgent: String?
</span></span><span style=display:flex><span>) : Validatable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>validate</span>(): List&lt;String&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>AnnotationValidator</span>.getViolationMessages(<span style=color:#66d9ef>this</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LogController</span> : KoinComponent {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> logUseCase: sLogUseCase <span style=color:#66d9ef>by</span> inject()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>createLog</span>(request: CreateLogRequest): CreateLogResponse {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> validationErrors = request.validate()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (validationErrors.isNotEmpty()) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> BadRequestException(<span style=color:#e6db74>&#34;Validation failed: </span><span style=color:#e6db74>${validationErrors.joinToString(&#34;, &#34;)}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> logUseCase.createLog(request)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ã“ã“ã§è‡ªåˆ†ãŒå•é¡Œã¨æ€ã£ãŸã®ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚</p><ol><li>ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ‰‹å‹•ã§è¡Œã†å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€ã‚³ãƒ¼ãƒ‰ãŒå†—é•·ã«ãªã‚Šã‚„ã™ã„ã€‚</li><li>å„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾ã—ã¦åŒã˜ã‚ˆã†ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚‹ãŸã‚ã€ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ãŒç™ºç”Ÿã—ã‚„ã™ã„ã€‚</li><li>ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ç›´åˆ—åŒ–ã§ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ä¾å­˜ã—ã¦ã„ã‚‹ãŸã‚ã€ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ä½ä¸‹ã‚„ã€ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®å¤‰æ›´ãŒå¿…è¦ãªå ´åˆã«ã‚³ãƒ¼ãƒ‰ã®ä¿®æ­£ãŒå¿…è¦ã«ãªã‚‹ã€‚</li><li>ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å‹ã‚’ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§æŒ‡å®šã™ã‚‹ãŸã‚ã€å‹å®‰å…¨ãªã‚³ãƒ¼ãƒ‰ãŒæ›¸ãã«ãã„ã€‚</li></ol><p>ãªã®ã§ã€ã“ã‚Œã‚‰ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ã€Ktorã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ”¹å–„ã™ã‚‹æ–¹æ³•ã‚’è€ƒãˆã¾ã—ãŸã€‚</p><h2 id=æ”¹å–„>æ”¹å–„</h2><p>è‡ªåˆ†ã§è€ƒãˆãŸæ”¹å–„ç­–ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚</p><ol><li>Ktorå…¬å¼ã®<a class=link href=https://ktor.io/docs/request-validation.html target=_blank rel=noopener>Request Validation</a>ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ä¾å­˜ã—ãªã„ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ã€‚</li><li>ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å…±é€šåŒ–ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚</li><li>Jacksonã‹ã‚‰<a class=link href=https://kotlinlang.org/docs/serialization.html target=_blank rel=noopener>Kotlinx Serialization</a>ã«ç§»è¡Œã—ã¦ã€ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã•ã‚‰ã«æ¸›ã‚‰ã—ã¤ã¤ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã‚‹ã€‚</li></ol><p>ãã‚Œãã‚Œåˆ†ã‘ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã«ãªã‚Šã¾ã™ã€‚</p><h3 id=ktorã®request-validationã‚’ä½¿ç”¨ã™ã‚‹>Ktorã®Request Validationã‚’ä½¿ç”¨ã™ã‚‹</h3><p>ã¾ãšã¯ValidatableControllerã¨ã„ã†ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ã€ãã‚Œãã‚Œã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§å®Ÿè£…ã—ã¾ã™ã€‚ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯ã€Ktorã®Request Validationã‚’ä½¿ç”¨ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ãŸã‚ã®ã‚‚ã®ã§ã€Ktorã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ç™»éŒ²ã™ã‚‹ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã£ã¦ã„ã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ValidatableController</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>configureValidation</span>(validationConfig: RequestValidationConfig)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ãã—ã¦ã€data classã‚’ä¿®æ­£ã—ã¾ã™ã€‚jakarta.validationã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¯å‰Šé™¤ã—ã€Validatableã¨ã„ã†ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚‚å‰Šé™¤ã—ã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateLogRequest</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JsonProperty</span>(<span style=color:#e6db74>&#34;user_id&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> userId: String?,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JsonProperty</span>(<span style=color:#e6db74>&#34;referral&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> referral: String?,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JsonProperty</span>(<span style=color:#e6db74>&#34;user_agent&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> userAgent: String?
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>æ¬¡ã«ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä¿®æ­£ã—ã¾ã™ã€‚ValidatableControllerã‚’ç¶™æ‰¿ã•ã›ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’<code>configureValidation</code>ãƒ¡ã‚½ãƒƒãƒ‰ã«ç§»å‹•ã—ã€Ktorã®Request Validationã‚’ä½¿ç”¨ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã„ã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LogController</span> : KoinComponent, ValidatableController {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> logUseCase: LogUseCase <span style=color:#66d9ef>by</span> inject()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>configureValidation</span>(validationConfig: RequestValidationConfig) {
</span></span><span style=display:flex><span>        validationConfig.validate&lt;CreateLogRequest&gt; { request <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>when</span> {
</span></span><span style=display:flex><span>                request.userId <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User ID must not be null&#34;</span>)
</span></span><span style=display:flex><span>                request.userId.isBlank() <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User ID must not be blank&#34;</span>)
</span></span><span style=display:flex><span>                request.userId.length &gt; <span style=color:#ae81ff>36</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User ID must not exceed 36 characters&#34;</span>)
</span></span><span style=display:flex><span>                !request.userId.matches(Regex(<span style=color:#e6db74>&#34;^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$&#34;</span>)) <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User ID must be a valid UUID format&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                request.referral <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;Referral must not be null&#34;</span>)
</span></span><span style=display:flex><span>                request.referral.isBlank() <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;Referral must not be blank&#34;</span>)
</span></span><span style=display:flex><span>                request.referral.length &gt; <span style=color:#ae81ff>2048</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;Referral must not exceed 2048 characters&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                request.userAgent <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User Agent must not be null&#34;</span>)
</span></span><span style=display:flex><span>                request.userAgent.isBlank() <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User Agent must not be blank&#34;</span>)
</span></span><span style=display:flex><span>                request.userAgent.length &gt; <span style=color:#ae81ff>2048</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User Agent must not exceed 2048 characters&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Valid
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>createLog</span>(request: CreateLogRequest): CreateLogResponse {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> logUseCase.createLog(request)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ã“ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€Ktorã®Request Validationã‚’ä½¿ç”¨ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ä¾å­˜ã›ãšã€ã‚³ãƒ¼ãƒ‰ã®å†—é•·æ€§ã‚’æ¸›ã‚‰ã™ã“ã¨ãŒã§ãã¾ã™ã€‚</p><h3 id=ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¨­å®š>ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¨­å®š</h3><p>æ¬¡ã¯ã€ValidationControllerã‚’Ktorã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦è¨­å®šã—ã¾ã™ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã—ã¦<code>ValidatableController</code>ã‚’å®šç¾©ã—ãŸç†ç”±ã¯ã€DIã§ä½¿ç”¨ã—ã¦ã„ã‚‹<a class=link href=https://insert-koin.io/ target=_blank rel=noopener>Koin</a>ã‚’ä½¿ç”¨ã—ã¦ã€ã™ã¹ã¦ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’å–å¾—ã—ã€Ktorã®Request Validationã«ç™»éŒ²ã™ã‚‹ãŸã‚ã§ã™ã€‚</p><p>ã¾ãšKoinã§ã¯interfaceã«å¯¾ã—ã¦å®Ÿè£…ã‚¯ãƒ©ã‚¹ã‚’ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹ã„ãã¤ã‹ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚ä»£è¡¨çš„ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ–¹æ³•ãŒã‚ã‚‹ã§ã—ã‚‡ã†ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> koinModule = module {
</span></span><span style=display:flex><span>    single&lt;ValidatableController&gt; { AccessLogController() }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ã“ã®æ–¹æ³•ã§ã¯ã€<code>ValidatableController</code>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã—ãŸã‚¯ãƒ©ã‚¹ã‚’å˜ä¸€ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨ã—ã¦ç™»éŒ²ã—ã¾ã™ã€‚ã—ã‹ã—ã€ã“ã‚Œã§ã¯è¤‡æ•°ã®<code>ValidatableController</code>ã‚’ç™»éŒ²ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚</p><p>ã“ã®å ´åˆã€<code>get()</code>ã‚’ä½¿ç”¨ã—ã¦ã€1ã¤ã®<code>ValidatableController</code>ã®ã¿ã‚’å–å¾—ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã™ã€‚ã—ã‹ã—ã“ã“ã§ã‚„ã‚ŠãŸã„ã“ã¨ã¯ã€è¤‡æ•°ã®<code>ValidatableController</code>ã‚’å–å¾—ã—ã¦ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å…±é€šåŒ–ã™ã‚‹ã“ã¨ãªã®ã§ã“ã®æ–¹æ³•ã¯é©ã—ã¦ã„ã¾ã›ã‚“ã€‚</p><p>ã¾ãŸã®æ–¹æ³•ãŒã€<a class=link href=https://insert-koin.io/docs/reference/koin-core/definitions/#additional-type-binding target=_blank rel=noopener>bind</a>ã‚’ä½¿ç”¨ã™ã‚‹æ–¹æ³•ã§ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> koinModule = module {
</span></span><span style=display:flex><span>    single { LogController() } bind ValidatableController<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>single</span> { AnotherController() } bind ValidatableController<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span></code></pre></div><p>å…ˆã»ã©ã®ã‚³ãƒ¼ãƒ‰ã¨ã¯é•ã£ã¦ã€<code>bind</code>ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€Koinã¯ãã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã—ãŸã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¹ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ãªã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§å…¨ã¦ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>Application</span>.configureRequestValidation() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> validatableControllers: List&lt;ValidatableController&gt; = getKoin().getAll()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    install(RequestValidation) {
</span></span><span style=display:flex><span>        validatableControllers.forEach { controller <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>            controller.configureValidation(<span style=color:#66d9ef>this</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ã“ã†ã™ã‚‹ã“ã¨ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å…±é€šåŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‹ã‚‰ã¯æ–°ã—ã„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’è¿½åŠ ã™ã‚‹éš›ã‚‚ã€<code>ValidatableController</code>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã™ã‚‹ã ã‘ã§ã€Ktorã®Request Validationã«è‡ªå‹•çš„ã«ç™»éŒ²ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p><h3 id=kotlinx-serializationã®ä½¿ç”¨>Kotlinx Serializationã®ä½¿ç”¨</h3><p>æœ€å¾Œã«ã€Kotlinx Serializationã‚’ä½¿ç”¨ã—ã¦ç›´åˆ—åŒ–ã‚’è¡Œã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½¿ç”¨ã‚’æ¸›ã‚‰ã—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><p>Kotlinx Serializationã¯ã€KSPï¼ˆKotlin Symbol Processingï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ç›´åˆ—åŒ–ã®ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã›ãšã«ç›´åˆ—åŒ–ã‚’è¡Œã†ã“ã¨ãŒã§ãã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸ŠãŒæœŸå¾…ã§ãã¾ã—ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚‚å‹å®‰å…¨ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ãŒã§ãã‚‹ãŸã‚ã€ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ã‚‚å‘ä¸Šã—ã¾ã™ã€‚</p><p>ã¾ãšã€Kotlinx Serializationã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã€æ—¢å­˜ã®Jacksonã‹ã‚‰Kotlinx Serializationã«ç§»è¡Œã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«ã€ContentNegotiationãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã‚’è¨­å®šã—ã¾ã™ã€‚ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å‘½åè¦å‰‡ã‚’ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã«å¤‰æ›´ã™ã‚‹ãŸã‚ã«ã€<code>JsonNamingStrategy.SnakeCase</code>ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>Application</span>.configureContentNegotiation() {
</span></span><span style=display:flex><span>    install(ContentNegotiation) {
</span></span><span style=display:flex><span>        json(
</span></span><span style=display:flex><span>            Json {
</span></span><span style=display:flex><span>                namingStrategy = <span style=color:#a6e22e>JsonNamingStrategy</span>.SnakeCase
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æ¬¡ã«ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã«<code>@Serializable</code>ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚Kotlinx Serializationã§ã¯@Serializableã ã‘ã§ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã¸ã®å¤‰æ›ã‚‚å¯èƒ½ã¨ãªã‚Šã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã«ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒä¸è¦ã«ãªã‚Šã¾ã™ã€‚ã¾ãŸã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ãã®ã¾ã¾å‹ã‚’æŒ‡å®šã™ã‚‹ã ã‘ã§ã™ã€‚å‹ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§Nullãƒã‚§ãƒƒã‚¯ã‚‚è‡ªå‹•ã«ãªã‚Šã¾ã™ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#a6e22e>@Serializable</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateLogRequest</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> userId: UUID,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> referral: String,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> userAgent: String
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>æ¬¡ã«ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¿®æ­£ã—ã¾ã™ã€‚userIdã®å‹ãŒ<code>String</code>ã‹ã‚‰<code>UUID</code>ã«å¤‰æ›´ã•ã‚ŒãŸã®ã§ã€æ­£è¦è¡¨ç¾ã®ãƒã‚§ãƒƒã‚¯ã¯ä¸è¦ã«ãªã‚Šã¾ã—ãŸã€‚ã‹ãªã‚Šã‚¹ãƒƒã‚­ãƒªã—ã¾ã—ãŸã­ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LogController</span> : KoinComponent, ValidatableController {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> logUseCase: LogUseCase <span style=color:#66d9ef>by</span> inject()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>configureValidation</span>(validationConfig: RequestValidationConfig) {
</span></span><span style=display:flex><span>        validationConfig.validate&lt;CreateLogRequest&gt; { request <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>when</span> {
</span></span><span style=display:flex><span>                request.referral.isBlank() <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;Referral must not be blank&#34;</span>)
</span></span><span style=display:flex><span>                request.referral.length &gt; <span style=color:#ae81ff>2048</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;Referral must not exceed 2048 characters&#34;</span>)
</span></span><span style=display:flex><span>                request.userAgent.isBlank() <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User Agent must not be blank&#34;</span>)
</span></span><span style=display:flex><span>                request.userAgent.length &gt; <span style=color:#ae81ff>2048</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User Agent must not exceed 2048 characters&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Valid
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><h3 id=è©•ä¾¡>è©•ä¾¡</h3><p>çµè«–çš„ã«ä»¥ä¸‹ã®ã‚ˆã†ãªæ”¹å–„ãŒã§ããŸã¨æ€ã„ã¾ã™ã€‚</p><ul><li>ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ç›´åˆ—åŒ–ã®ã‚³ãƒ¼ãƒ‰ãŒç°¡æ½”ã«ãªã‚Šã€å¯èª­æ€§ãŒå‘ä¸Šã—ãŸ</li><li>ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ç›´åˆ—åŒ–ã§ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ãªããªã‚Šã€ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ä½ä¸‹ã‚’å›é¿ã§ããŸ</li><li>ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ä»¥å¤–ã®ãƒã‚§ãƒƒã‚¯ã‚’æ¸›ã‚‰ã™ã“ã¨ãŒã§ããŸ</li></ul><p>ã¾ãŸã€ã‚µã‚¤ãƒ‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¨ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ãªç‚¹ã‚‚ã‚ã‚Šã¾ã™ã€‚</p><ul><li>RegexãŒä¸è¦ã«ãªã£ã¦ã„ã‚‹ã‹ã€å…±é€šåŒ–ã—ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½¿ã„å›ã—ãŒã§ãã‚‹</li><li>max, minãªã©ã®ãƒã‚§ãƒƒã‚¯ãŒä¸è¦ã«ãªã£ã¦ã„ã‚‹</li><li>limit, offsetãªã©é »ç¹ã«ä½¿ã†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒã‚§ãƒƒã‚¯ã‚’å…±é€šåŒ–ã§ãã‚‹</li></ul><p>ãŸã ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ‡¸å¿µã‚‚ã‚ã‚Šã¾ã™ã€‚</p><ul><li>LocalDateTimeã‚„LocalDateãªã©ã®Kotlinx Serializationã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„å‹ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ç‹¬è‡ªã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// LocalDateTimeã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã®ä¾‹
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>object</span> <span style=color:#a6e22e>LocalDateTimeSerializer</span> : KSerializer&lt;LocalDateTime&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>val</span> descriptor: SerialDescriptor = PrimitiveSerialDescriptor(<span style=color:#e6db74>&#34;java.time.LocalDateTime&#34;</span>, <span style=color:#a6e22e>PrimitiveKind</span>.STRING)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>serialize</span>(encoder: Encoder, <span style=color:#66d9ef>value</span>: LocalDateTime) {
</span></span><span style=display:flex><span>        encoder.encodeString(<span style=color:#66d9ef>value</span>.format(<span style=color:#a6e22e>DateTimeFormatter</span>.ISO_LOCAL_DATE_TIME))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>deserialize</span>(decoder: Decoder): LocalDateTime {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>LocalDateTime</span>.parse(decoder.decodeString(), <span style=color:#a6e22e>DateTimeFormatter</span>.ISO_LOCAL_DATE_TIME)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>Application</span>.configureSerialization() {
</span></span><span style=display:flex><span>    install(ContentNegotiation) {
</span></span><span style=display:flex><span>        json(
</span></span><span style=display:flex><span>            Json {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// LocalDateTimeã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã‚’ç™»éŒ²
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                serializersModule = SerializersModule {
</span></span><span style=display:flex><span>                    contextual(LocalDateTimeSerializer)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Serializable</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ExampleRequest</span>(
</span></span><span style=display:flex><span>    <span style=color:#75715e>// LocalDateTimeã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã¯ã€ç‹¬è‡ªã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã‚’ä½¿ç”¨ã™ã‚‹
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>@Contextual</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> timestamp: LocalDateTime
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><ul><li>Enumã®ã‚ˆã†ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å€¤ãŒæ±ºã¾ã£ã¦ã„ã‚‹å‹ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã‚‚ã€ç‹¬è‡ªã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹</li><li>Kotlinx Serializationã¯ã¾ã Jacksonã»ã©ã®æ©Ÿèƒ½ãŒãªã„ãŸã‚ã€ç‰¹å®šã®æ©Ÿèƒ½ãŒå¿…è¦ãªå ´åˆã¯Kotlinx Serializationã§ã¯å®Ÿè£…ã§ããªã„ã“ã¨ãŒã‚ã‚‹</li><li>Ktor Request Validationã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®ã¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãŸã‚ã€ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚„ãƒ˜ãƒƒãƒ€ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯åˆ¥é€”å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹</li></ul><p>ãªã®ã§ã€ä»Šå›ã®å¯¾å¿œã¯æ„å›³ã¨ã—ã¦ã¯æˆåŠŸã—ãŸã¨æ€ã„ã¾ã™ãŒã€ã¾ã ã¾ã æ”¹å–„ã®ä½™åœ°ã¯ã‚ã‚‹ã‹ãªã¨æ€ã„ã¾ã™ã€‚ã¾ãŸã€ç’°å¢ƒã‚„è¦ä»¶ã«ã‚ˆã£ã¦ã¯ã€ã“ã®ã‚ˆã†ãªæ”¹å–„ãŒé©ã•ãªã„å ´åˆã‚‚ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</p><h2 id=æ”¹å–„å†…å®¹ã®ã¾ã¨ã‚>æ”¹å–„å†…å®¹ã®ã¾ã¨ã‚</h2><p>ä»¥ä¸‹ã®è¡¨ã«ã€æ”¹å–„å‰å¾Œã®é•ã„ã‚’ç°¡æ½”ã«ã¾ã¨ã‚ã¾ã—ãŸã€‚</p><div class=table-wrapper><table><thead><tr><th>é …ç›®</th><th>æ”¹å–„å‰</th><th>æ”¹å–„å¾Œ</th></tr></thead><tbody><tr><td>ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®æ–¹æ³•</td><td><code>jakarta.validation</code> + æ‰‹å‹•å‘¼ã³å‡ºã—</td><td>Ktorå…¬å¼ã®RequestValidationãƒ—ãƒ©ã‚°ã‚¤ãƒ³</td></tr><tr><td>ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½¿ç”¨</td><td><code>@NotNull</code>, <code>@Pattern</code>, <code>@JsonProperty</code>ãªã©å¤šæ•°</td><td><code>@Serializable</code>ã®ã¿ã€åŸºæœ¬çš„ã«ä¸è¦</td></tr><tr><td>UUIDãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</td><td>æ­£è¦è¡¨ç¾ã§ãƒã‚§ãƒƒã‚¯</td><td><code>UUID</code>å‹æŒ‡å®šã§å‹å®‰å…¨ã«</td></tr><tr><td>ç›´åˆ—åŒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</td><td>Jacksonï¼ˆãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†ï¼‰</td><td>kotlinx.serializationï¼ˆKSPåˆ©ç”¨ã§é«˜é€Ÿï¼‰</td></tr><tr><td>ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å…±é€šåŒ–</td><td>å„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§å€‹åˆ¥ã«è¨˜è¿°</td><td><code>ValidatableController</code>ã§å…±é€šå®šç¾©å¯èƒ½</td></tr><tr><td>Koinã¨ã®é€£æº</td><td>å–å¾—ã‚„ç™»éŒ²ãŒç…©é›‘ã‚‚ã—ãã¯ã—ãªã„</td><td><code>bind</code> + <code>getAll()</code> ã§ä¸€æ‹¬å–å¾—</td></tr></tbody></table></div><h2 id=æœ€å¾Œã«>æœ€å¾Œã«</h2><p>ä»Šå›ã¯Ktorã®Requestå‡¦ç†ã‚’æ”¹å–„ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚Kotlinã®ç‰¹æ€§ã‚’æ´»ã‹ã—ã€Ktorã®Request Validationã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç°¡æ½”ã«è¡Œã†ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ã¾ãŸã€Kotlinx Serializationã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ç›´åˆ—åŒ–ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚‚å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚</p><p>ã“ã®ã‚ˆã†ã«ã€Kotlinã¨Ktorã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€Javaã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯å®Ÿç¾ã§ããªã„ã‚ˆã†ãªæ”¹å–„ãŒå¯èƒ½ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ç‰¹ã«ã€Kotlinã®ç‰¹æ€§ã‚’æ´»ã‹ã—ãŸè¨­è¨ˆã‚„ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸ŠãŒæœŸå¾…ã§ãã‚‹ç‚¹ã¯å¤§ããªãƒ¡ãƒªãƒƒãƒˆã§ã™ã€‚</p><p>ä»Šå¾Œã‚‚Kotlinã‚„Ktorã‚’ä½¿ã£ãŸé–‹ç™ºã«ãŠã„ã¦ã€ã‚ˆã‚Šè‰¯ã„è¨­è¨ˆã‚„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸Šã‚’ç›®æŒ‡ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚ã‚‚ã—ã€ä»–ã«ã‚‚Ktorã‚„Kotlinã«é–¢ã™ã‚‹æ”¹å–„ç‚¹ã‚„ã‚¢ã‚¤ãƒ‡ã‚¢ãŒã‚ã‚Œã°ã€ã¾ãŸå…±æœ‰ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚</p><p>ã§ã¯ã€ã¾ãŸï¼</p></section><footer class=article-footer><section class=article-tags><a href=/tags/ktor/>Ktor</a>
<a href=/tags/kotlin/>Kotlin</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/posts/image-resize-api/><div class=article-image><img src=/images/ktor.webp loading=lazy data-key data-hash=/images/ktor.webp></div><div class=article-details><h2 class=article-title>å‹•çš„ç”»åƒãƒªã‚µã‚¤ã‚ºAPIã‚’ä½œã‚‹</h2></div></a></article><article class=has-image><a href=/posts/ktor-path-parameter-as-inline/><div class=article-image><img src=/images/ktor.webp loading=lazy data-key data-hash=/images/ktor.webp></div><div class=article-details><h2 class=article-title>Path Parameterã‚’Inline classã§å—ã‘å–ã‚‹</h2></div></a></article><article class=has-image><a href=/posts/ktor-role-based-authorization/><div class=article-image><img src=/images/ktor.webp loading=lazy data-key data-hash=/images/ktor.webp></div><div class=article-details><h2 class=article-title>Ktorã§Role-based Authorizationã‚’å®Ÿè£…ã™ã‚‹</h2></div></a></article><article class=has-image><a href=/posts/ktor-first-impression/><div class=article-image><img src=/images/ktor.webp loading=lazy data-key data-hash=/images/ktor.webp></div><div class=article-details><h2 class=article-title>Ktorã‚’è§¦ã£ã¦ã¿ãŸ</h2></div></a></article><article class=has-image><a href=/posts/home-server/><div class=article-image><img src=/images/nginx.webp loading=lazy data-key data-hash=/images/nginx.webp></div><div class=article-details><h2 class=article-title>ãƒ›ãƒ¼ãƒ ã‚µãƒ¼ãƒã‚’ä½œã£ã¦ã¿ãŸ</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2019 -
2025 Korean-man in Tokyo</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.20.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>