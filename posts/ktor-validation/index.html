<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='KotlinはJavaとの互換性があるので、Javaで構築した既存のシステムの一部を書き換えたり、言語だけを変えて新しいシステムを構築したりするケースが多いかなと思います。しかし、同じJVM上で動作するKotlinとJavaでも、フレームワークやライブラリの違いにより改善できる箇所もあります。
'><title>KtorのRequest処理を改善する</title><link rel=canonical href=https://retheviper.github.io/posts/ktor-validation/><link rel=stylesheet href=/scss/style.min.860dd2cdb2f2ca3d772cda81aa659d4c99fcffa6b8fd7a384c2f4ccecd8f6b9f.css><meta property='og:title' content='KtorのRequest処理を改善する'><meta property='og:description' content='KotlinはJavaとの互換性があるので、Javaで構築した既存のシステムの一部を書き換えたり、言語だけを変えて新しいシステムを構築したりするケースが多いかなと思います。しかし、同じJVM上で動作するKotlinとJavaでも、フレームワークやライブラリの違いにより改善できる箇所もあります。
'><meta property='og:url' content='https://retheviper.github.io/posts/ktor-validation/'><meta property='og:site_name' content='Korean-man in Tokyo'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='ktor'><meta property='article:tag' content='kotlin'><meta property='article:published_time' content='2025-06-28T00:00:00+00:00'><meta property='article:modified_time' content='2025-06-28T00:00:00+00:00'><meta property='og:image' content='https://retheviper.github.io/images/ktor.webp'><meta name=twitter:title content="KtorのRequest処理を改善する"><meta name=twitter:description content="KotlinはJavaとの互換性があるので、Javaで構築した既存のシステムの一部を書き換えたり、言語だけを変えて新しいシステムを構築したりするケースが多いかなと思います。しかし、同じJVM上で動作するKotlinとJavaでも、フレームワークやライブラリの違いにより改善できる箇所もあります。
"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://retheviper.github.io/images/ktor.webp'><link rel="shortcut icon" href=/favicon.ico><link rel=icon href=/favicon/favicon.ico><link rel=mask-icon href=safari-pinned-tab.svg color=black><link rel=manifest href=/favicon/manifest.json><script async src="https://www.googletagmanager.com/gtag/js?id=G-BYJBEJB6DX"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BYJBEJB6DX")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_5754c4c47ba5668d.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>👋</span></figure><div class=site-meta><h1 class=site-name><a href=/>Korean-man in Tokyo</a></h1><h2 class=site-description>一人前になりたいです</h2></div></header><ol class=social-menu><li><a href=https://www.credly.com/users/youngbin-kim.6d7122f1/badges target=_blank title=Certificates rel=me><svg class="icon icon-tabler icon-tabler-certificate" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="15" cy="15" r="3"/><path d="M13 17.5V22l2-1.5 2 1.5v-4.5"/><path d="M10 19H5a2 2 0 01-2-2V7c0-1.1.9-2 2-2h14a2 2 0 012 2v10a2 2 0 01-1 1.73"/><line x1="6" y1="9" x2="18" y2="9"/><line x1="6" y1="12" x2="9" y2="12"/><line x1="6" y1="15" x2="8" y2="15"/></svg></a></li><li><a href=https://github.com/retheviper target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/%E8%8B%B1%E6%96%8C-%E9%87%91-6736ba194/ target=_blank title=LinkedIn rel=me><svg class="icon icon-tabler icon-tabler-brand-linkedin" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="2"/><line x1="8" y1="11" x2="8" y2="16"/><line x1="8" y1="8" x2="8" y2="8.01"/><line x1="12" y1="16" x2="12" y2="11"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://retheviper.github.io/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://retheviper.github.io/ selected></option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#既存>既存</a></li><li><a href=#改善>改善</a><ol><li><a href=#ktorのrequest-validationを使用する>KtorのRequest Validationを使用する</a></li><li><a href=#モジュールの設定>モジュールの設定</a></li><li><a href=#kotlinx-serializationの使用>Kotlinx Serializationの使用</a></li><li><a href=#評価>評価</a></li></ol></li><li><a href=#改善内容のまとめ>改善内容のまとめ</a></li><li><a href=#最後に>最後に</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/ktor-validation/><img src=/images/ktor.webp loading=lazy alt="Featured image of post KtorのRequest処理を改善する"></a></div><div class=article-details><header class=article-category><a href=/categories/ktor/ style=background-color:#2a9d8f;color:#fff>ktor</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/ktor-validation/>KtorのRequest処理を改善する</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jun 28, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>11 minute read</time></div></footer></div></header><section class=article-content><p>KotlinはJavaとの互換性があるので、Javaで構築した既存のシステムの一部を書き換えたり、言語だけを変えて新しいシステムを構築したりするケースが多いかなと思います。しかし、同じJVM上で動作するKotlinとJavaでも、フレームワークやライブラリの違いにより改善できる箇所もあります。</p><p>Javaの歴史が長いこともあり、Javaのフレームワークやライブラリは非常に多くの機能を提供していますが、Kotlinではより簡潔で直感的なコードを書くことができる場合があります。また、その中ではKotlinの特性を活かした設計が可能だったり、性能の向上が期待できたりします。</p><p>今回はそのような改善の一例として、Ktorでのリクエストバリデーションの実装方法について紹介します。</p><h2 id=既存>既存</h2><p>実務では<a class=link href=https://ktor.io target=_blank rel=noopener>Ktor</a>、<a class=link href=https://www.jetbrains.com/ja-jp/exposed target=_blank rel=noopener>Exposed</a>といったKotlin用のフレームワークを採用しています。ただ一部ではJavaのライブラリに依存していて、直列化ではJackson、リクエストのバリデーションではjakarta.validationを使用していました。</p><p>JavaやKotlinでよく使われるSpring Bootの場合、これらのライブラリを使うのがとても簡単ですね。例えば、リクエストのバリデーションは<code>@Valid</code>や<code>@Validated</code>アノテーションで自動的に行うことができます。</p><p>しかし、Ktorではそうでもいきません。なので、Ktorのリクエストバリデーションは、手動で行う必要がありました。例えば、以下のようにしていました。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// リクエストのバリデーションを行う
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>object</span> <span style=color:#a6e22e>AnnotationValidator</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> validator: Validator = <span style=color:#a6e22e>Validation</span>.buildDefaultValidatorFactory().validator
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getViolationMessages</span>(model: Any?): List&lt;String&gt; {
</span></span><span style=display:flex><span>        model <span style=color:#f92672>?:</span> <span style=color:#66d9ef>return</span> emptyList()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> violations = validator.validate(model)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> violations.map { <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${it.propertyPath}</span><span style=color:#e6db74> </span><span style=color:#e6db74>${it.message}</span><span style=color:#e6db74>&#34;</span> }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// バリデーションを行うインターフェース
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Validatable</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>validate</span>(): List&lt;String&gt;
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// リクエストボディ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateLogRequest</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:NotNull
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:NotBlank
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:Size(max = <span style=color:#ae81ff>36</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:Pattern(regexp = <span style=color:#e6db74>&#34;^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JsonProperty</span>(<span style=color:#e6db74>&#34;user_id&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> userId: String?,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:NotNull
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:NotBlank
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:Size(max = <span style=color:#ae81ff>2048</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JsonProperty</span>(<span style=color:#e6db74>&#34;referral&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> referral: String?,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:NotNull
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:NotBlank
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@field</span>:Size(max = <span style=color:#ae81ff>2048</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JsonProperty</span>(<span style=color:#e6db74>&#34;user_agent&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> userAgent: String?
</span></span><span style=display:flex><span>) : Validatable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>validate</span>(): List&lt;String&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>AnnotationValidator</span>.getViolationMessages(<span style=color:#66d9ef>this</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// コントローラー
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LogController</span> : KoinComponent {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> logUseCase: sLogUseCase <span style=color:#66d9ef>by</span> inject()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>createLog</span>(request: CreateLogRequest): CreateLogResponse {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> validationErrors = request.validate()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (validationErrors.isNotEmpty()) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> BadRequestException(<span style=color:#e6db74>&#34;Validation failed: </span><span style=color:#e6db74>${validationErrors.joinToString(&#34;, &#34;)}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> logUseCase.createLog(request)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ここで自分が問題と思ったのは、以下のようなものがあります。</p><ol><li>リクエストのバリデーションを手動で行う必要があるため、コードが冗長になりやすい。</li><li>各コントローラーやリクエストに対して同じようなバリデーションコードを書く必要があるため、コードの重複が発生しやすい。</li><li>バリデーションと直列化でアノテーションに依存しているため、リフレクションによるパフォーマンスの低下や、アノテーションの変更が必要な場合にコードの修正が必要になる。</li><li>プロパティの型をアノテーションで指定するため、型安全なコードが書きにくい。</li></ol><p>なので、これらの問題を解決するために、Ktorのリクエストバリデーションを改善する方法を考えました。</p><h2 id=改善>改善</h2><p>自分で考えた改善策は以下のようなものです。</p><ol><li>Ktor公式の<a class=link href=https://ktor.io/docs/request-validation.html target=_blank rel=noopener>Request Validation</a>を使用して、アノテーションに依存しないバリデーションを実装する。</li><li>バリデーションのロジックを共通化できるようにする。</li><li>Jacksonから<a class=link href=https://kotlinlang.org/docs/serialization.html target=_blank rel=noopener>Kotlinx Serialization</a>に移行して、アノテーションをさらに減らしつつとパフォーマンスを向上させる。</li></ol><p>それぞれ分けると以下のような内容になります。</p><h3 id=ktorのrequest-validationを使用する>KtorのRequest Validationを使用する</h3><p>まずはValidatableControllerというインターフェースを作成して、それぞれのコントローラーで実装します。このインターフェースは、KtorのRequest Validationを使用してリクエストのバリデーションを行うためのもので、Ktorのプラグインに登録するためのメソッドを持っています。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ValidatableController</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>configureValidation</span>(validationConfig: RequestValidationConfig)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>そして、data classを修正します。jakarta.validationのアノテーションは削除し、Validatableというインターフェースも削除します。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateLogRequest</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JsonProperty</span>(<span style=color:#e6db74>&#34;user_id&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> userId: String?,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JsonProperty</span>(<span style=color:#e6db74>&#34;referral&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> referral: String?,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JsonProperty</span>(<span style=color:#e6db74>&#34;user_agent&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> userAgent: String?
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>次に、コントローラーを修正します。ValidatableControllerを継承させ、バリデーションのロジックを<code>configureValidation</code>メソッドに移動し、KtorのRequest Validationを使用してリクエストのバリデーションを行います。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LogController</span> : KoinComponent, ValidatableController {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> logUseCase: LogUseCase <span style=color:#66d9ef>by</span> inject()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>configureValidation</span>(validationConfig: RequestValidationConfig) {
</span></span><span style=display:flex><span>        validationConfig.validate&lt;CreateLogRequest&gt; { request <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>when</span> {
</span></span><span style=display:flex><span>                request.userId <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User ID must not be null&#34;</span>)
</span></span><span style=display:flex><span>                request.userId.isBlank() <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User ID must not be blank&#34;</span>)
</span></span><span style=display:flex><span>                request.userId.length &gt; <span style=color:#ae81ff>36</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User ID must not exceed 36 characters&#34;</span>)
</span></span><span style=display:flex><span>                !request.userId.matches(Regex(<span style=color:#e6db74>&#34;^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$&#34;</span>)) <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User ID must be a valid UUID format&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                request.referral <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;Referral must not be null&#34;</span>)
</span></span><span style=display:flex><span>                request.referral.isBlank() <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;Referral must not be blank&#34;</span>)
</span></span><span style=display:flex><span>                request.referral.length &gt; <span style=color:#ae81ff>2048</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;Referral must not exceed 2048 characters&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                request.userAgent <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User Agent must not be null&#34;</span>)
</span></span><span style=display:flex><span>                request.userAgent.isBlank() <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User Agent must not be blank&#34;</span>)
</span></span><span style=display:flex><span>                request.userAgent.length &gt; <span style=color:#ae81ff>2048</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User Agent must not exceed 2048 characters&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Valid
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>createLog</span>(request: CreateLogRequest): CreateLogResponse {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> logUseCase.createLog(request)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>このようにすることで、KtorのRequest Validationを使用してリクエストのバリデーションを行うことができます。これにより、アノテーションに依存せず、コードの冗長性を減らすことができます。</p><h3 id=モジュールの設定>モジュールの設定</h3><p>次は、ValidationControllerをKtorのモジュールとして設定します。インターフェースとして<code>ValidatableController</code>を定義した理由は、DIで使用している<a class=link href=https://insert-koin.io/ target=_blank rel=noopener>Koin</a>を使用して、すべてのコントローラーを取得し、KtorのRequest Validationに登録するためです。</p><p>まずKoinではinterfaceに対して実装クラスをバインディングするいくつかの方法があります。代表的には、以下のような方法があるでしょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> koinModule = module {
</span></span><span style=display:flex><span>    single&lt;ValidatableController&gt; { AccessLogController() }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>この方法では、<code>ValidatableController</code>インターフェースを実装したクラスを単一のインスタンスとして登録します。しかし、これでは複数の<code>ValidatableController</code>を登録することができません。</p><p>この場合、<code>get()</code>を使用して、1つの<code>ValidatableController</code>のみを取得することはできます。しかしここでやりたいことは、複数の<code>ValidatableController</code>を取得して、リクエストのバリデーションを共通化することなのでこの方法は適していません。</p><p>またの方法が、<a class=link href=https://insert-koin.io/docs/reference/koin-core/definitions/#additional-type-binding target=_blank rel=noopener>bind</a>を使用する方法です。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>val</span> koinModule = module {
</span></span><span style=display:flex><span>    single { LogController() } bind ValidatableController<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>single</span> { AnotherController() } bind ValidatableController<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span></code></pre></div><p>先ほどのコードとは違って、<code>bind</code>を使用することで、Koinはそのインターフェースを実装したすべてのクラスを取得できるようになります。なので、以下のようなコードで全てのコントローラーを取得することができます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>Application</span>.configureRequestValidation() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> validatableControllers: List&lt;ValidatableController&gt; = getKoin().getAll()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    install(RequestValidation) {
</span></span><span style=display:flex><span>        validatableControllers.forEach { controller <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>            controller.configureValidation(<span style=color:#66d9ef>this</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>こうすることでリクエストのバリデーションを共通化することができます。これからは新しいコントローラーを追加する際も、<code>ValidatableController</code>インターフェースを実装するだけで、KtorのRequest Validationに自動的に登録されるようになります。</p><h3 id=kotlinx-serializationの使用>Kotlinx Serializationの使用</h3><p>最後に、Kotlinx Serializationを使用して直列化を行います。これにより、アノテーションの使用を減らし、パフォーマンスを向上させることができます。</p><p>Kotlinx Serializationは、KSP（Kotlin Symbol Processing）を使用して、コンパイル時に直列化のコードを生成します。これにより、リフレクションを使用せずに直列化を行うことができ、パフォーマンスの向上が期待できまし、リクエストのバリデーションでも型安全なコードを書くことができるため、コードの可読性も向上します。</p><p>まず、Kotlinx Serializationを使用するために、既存のJacksonからKotlinx Serializationに移行します。以下のように、ContentNegotiationプラグインを使用してシリアライザを設定します。プロパティの命名規則をスネークケースに変更するために、<code>JsonNamingStrategy.SnakeCase</code>を使用することができます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>Application</span>.configureContentNegotiation() {
</span></span><span style=display:flex><span>    install(ContentNegotiation) {
</span></span><span style=display:flex><span>        json(
</span></span><span style=display:flex><span>            Json {
</span></span><span style=display:flex><span>                namingStrategy = <span style=color:#a6e22e>JsonNamingStrategy</span>.SnakeCase
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>次に、リクエストボディのデータクラスに<code>@Serializable</code>アノテーションを追加します。Kotlinx Serializationでは@Serializableだけでスネークケースへの変換も可能となり、プロパティ名にアノテーションが不要になります。また、プロパティはそのまま型を指定するだけです。型を指定することでNullチェックも自動になります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#a6e22e>@Serializable</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateLogRequest</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> userId: UUID,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> referral: String,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> userAgent: String
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>次に、コントローラのバリデーションを修正します。userIdの型が<code>String</code>から<code>UUID</code>に変更されたので、正規表現のチェックは不要になりました。かなりスッキリしましたね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LogController</span> : KoinComponent, ValidatableController {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> logUseCase: LogUseCase <span style=color:#66d9ef>by</span> inject()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>configureValidation</span>(validationConfig: RequestValidationConfig) {
</span></span><span style=display:flex><span>        validationConfig.validate&lt;CreateLogRequest&gt; { request <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>when</span> {
</span></span><span style=display:flex><span>                request.referral.isBlank() <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;Referral must not be blank&#34;</span>)
</span></span><span style=display:flex><span>                request.referral.length &gt; <span style=color:#ae81ff>2048</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;Referral must not exceed 2048 characters&#34;</span>)
</span></span><span style=display:flex><span>                request.userAgent.isBlank() <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User Agent must not be blank&#34;</span>)
</span></span><span style=display:flex><span>                request.userAgent.length &gt; <span style=color:#ae81ff>2048</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Invalid(<span style=color:#e6db74>&#34;User Agent must not exceed 2048 characters&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span> <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>ValidationResult</span>.Valid
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><h3 id=評価>評価</h3><p>結論的に以下のような改善ができたと思います。</p><ul><li>バリデーションと直列化のコードが簡潔になり、可読性が向上した</li><li>バリデーションと直列化でアノテーションを使用しなくなり、リフレクションによるパフォーマンスの低下を回避できた</li><li>バリデーションに対してビジネスロジック以外のチェックを減らすことができた</li></ul><p>また、サイドエフェクトとして以下のような点もあります。</p><ul><li>Regexが不要になっているか、共通化してインスタンスの使い回しができる</li><li>max, minなどのチェックが不要になっている</li><li>limit, offsetなど頻繁に使うパラメータのチェックを共通化できる</li></ul><p>ただ、以下のような懸念もあります。</p><ul><li>LocalDateTimeやLocalDateなどのKotlinx Serializationでサポートされていない型を使用する場合、独自のシリアライザを実装する必要がある</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// LocalDateTimeのシリアライザの例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>object</span> <span style=color:#a6e22e>LocalDateTimeSerializer</span> : KSerializer&lt;LocalDateTime&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>val</span> descriptor: SerialDescriptor = PrimitiveSerialDescriptor(<span style=color:#e6db74>&#34;java.time.LocalDateTime&#34;</span>, <span style=color:#a6e22e>PrimitiveKind</span>.STRING)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>serialize</span>(encoder: Encoder, <span style=color:#66d9ef>value</span>: LocalDateTime) {
</span></span><span style=display:flex><span>        encoder.encodeString(<span style=color:#66d9ef>value</span>.format(<span style=color:#a6e22e>DateTimeFormatter</span>.ISO_LOCAL_DATE_TIME))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>deserialize</span>(decoder: Decoder): LocalDateTime {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>LocalDateTime</span>.parse(decoder.decodeString(), <span style=color:#a6e22e>DateTimeFormatter</span>.ISO_LOCAL_DATE_TIME)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>Application</span>.configureSerialization() {
</span></span><span style=display:flex><span>    install(ContentNegotiation) {
</span></span><span style=display:flex><span>        json(
</span></span><span style=display:flex><span>            Json {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// LocalDateTimeのシリアライザを登録
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                serializersModule = SerializersModule {
</span></span><span style=display:flex><span>                    contextual(LocalDateTimeSerializer)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Serializable</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ExampleRequest</span>(
</span></span><span style=display:flex><span>    <span style=color:#75715e>// LocalDateTimeのフィールドでは、独自のシリアライザを使用する
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>@Contextual</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> timestamp: LocalDateTime
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><ul><li>Enumのようにコンパイル時に値が決まっている型を使用する場合も、独自のシリアライザを実装する必要がある</li><li>Kotlinx SerializationはまだJacksonほどの機能がないため、特定の機能が必要な場合はKotlinx Serializationでは実装できないことがある</li><li>Ktor Request Validationはリクエストボディのみのバリデーションをサポートしているため、クエリパラメータやヘッダのバリデーションは別途実装する必要がある</li></ul><p>なので、今回の対応は意図としては成功したと思いますが、まだまだ改善の余地はあるかなと思います。また、環境や要件によっては、このような改善が適さない場合もあるかもしれません。</p><h2 id=改善内容のまとめ>改善内容のまとめ</h2><p>以下の表に、改善前後の違いを簡潔にまとめました。</p><div class=table-wrapper><table><thead><tr><th>項目</th><th>改善前</th><th>改善後</th></tr></thead><tbody><tr><td>バリデーションの方法</td><td><code>jakarta.validation</code> + 手動呼び出し</td><td>Ktor公式のRequestValidationプラグイン</td></tr><tr><td>アノテーションの使用</td><td><code>@NotNull</code>, <code>@Pattern</code>, <code>@JsonProperty</code>など多数</td><td><code>@Serializable</code>のみ、基本的に不要</td></tr><tr><td>UUIDバリデーション</td><td>正規表現でチェック</td><td><code>UUID</code>型指定で型安全に</td></tr><tr><td>直列化ライブラリ</td><td>Jackson（リフレクションを使う）</td><td>kotlinx.serialization（KSP利用で高速）</td></tr><tr><td>バリデーションの共通化</td><td>各コントローラーで個別に記述</td><td><code>ValidatableController</code>で共通定義可能</td></tr><tr><td>Koinとの連携</td><td>取得や登録が煩雑もしくはしない</td><td><code>bind</code> + <code>getAll()</code> で一括取得</td></tr></tbody></table></div><h2 id=最後に>最後に</h2><p>今回はKtorのRequest処理を改善する方法について紹介しました。Kotlinの特性を活かし、KtorのRequest Validationを使用することで、リクエストのバリデーションを簡潔に行うことができました。また、Kotlinx Serializationを使用することで、直列化のパフォーマンスも向上させることができました。</p><p>このように、KotlinとKtorを使用することで、Javaのフレームワークやライブラリでは実現できないような改善が可能になることがあります。特に、Kotlinの特性を活かした設計や、パフォーマンスの向上が期待できる点は大きなメリットです。</p><p>今後もKotlinやKtorを使った開発において、より良い設計やパフォーマンスの向上を目指していきたいと思います。もし、他にもKtorやKotlinに関する改善点やアイデアがあれば、また共有していきたいと思います。</p><p>では、また！</p></section><footer class=article-footer><section class=article-tags><a href=/tags/ktor/>Ktor</a>
<a href=/tags/kotlin/>Kotlin</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/posts/image-resize-api/><div class=article-image><img src=/images/ktor.webp loading=lazy data-key data-hash=/images/ktor.webp></div><div class=article-details><h2 class=article-title>動的画像リサイズAPIを作る</h2></div></a></article><article class=has-image><a href=/posts/ktor-path-parameter-as-inline/><div class=article-image><img src=/images/ktor.webp loading=lazy data-key data-hash=/images/ktor.webp></div><div class=article-details><h2 class=article-title>Path ParameterをInline classで受け取る</h2></div></a></article><article class=has-image><a href=/posts/ktor-role-based-authorization/><div class=article-image><img src=/images/ktor.webp loading=lazy data-key data-hash=/images/ktor.webp></div><div class=article-details><h2 class=article-title>KtorでRole-based Authorizationを実装する</h2></div></a></article><article class=has-image><a href=/posts/ktor-first-impression/><div class=article-image><img src=/images/ktor.webp loading=lazy data-key data-hash=/images/ktor.webp></div><div class=article-details><h2 class=article-title>Ktorを触ってみた</h2></div></a></article><article class=has-image><a href=/posts/home-server/><div class=article-image><img src=/images/nginx.webp loading=lazy data-key data-hash=/images/nginx.webp></div><div class=article-details><h2 class=article-title>ホームサーバを作ってみた</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2019 -
2025 Korean-man in Tokyo</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.20.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>